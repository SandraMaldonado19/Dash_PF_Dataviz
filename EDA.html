

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Dash Anomalías de temperatura &#8212; Análisis de Anomalía de Temperatura de la Superficie Global</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=365ca57ee442770a23c6"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'EDA';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Análisis de Anomlaías de Temperatura en la Superficie Global" href="intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/Logouninorte.png" class="logo__image only-light" alt="Análisis de Anomalía de Temperatura de la Superficie Global - Home"/>
    <script>document.write(`<img src="_static/Logouninorte.png" class="logo__image only-dark" alt="Análisis de Anomalía de Temperatura de la Superficie Global - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Análisis de Anomlaías de Temperatura en la Superficie Global
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Dash Anomalías de temperatura</a></li>


</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/SandraMaldonado19/Dataviz_pf.git" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/SandraMaldonado19/Dataviz_pf.git/issues/new?title=Issue%20on%20page%20%2FEDA.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/EDA.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Dash Anomalías de temperatura</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Dash Anomalías de temperatura</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#manejo-de-la-base-de-datos">Manejo de la base de datos</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#construccion-del-dash">Construcción del dash</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-predictivo">Modelo predictivo</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#arima">ARIMA</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="dash-anomalias-de-temperatura">
<h1>Dash Anomalías de temperatura<a class="headerlink" href="#dash-anomalias-de-temperatura" title="Permalink to this heading">#</a></h1>
<p>La apliclación desplegada tiene como objetivo de visualización los cambios de temperatura cercana a la superficie en todo el mundo, entre 1850 a 2018. El archivo presenta anomalías mensuales promedio de temperatura cercana a la superficie, en relación con el período 1961–1990.</p>
<p>En general, este conjunto de datos muestra un aumento del calentamiento promedio global desde mediados del siglo 19 y en los últimos años, en consonancia con otros análisis. Este fenómeno se debe a múltiples factores, incluidos una mejor representación del calentamiento del Ártico y una mejor comprensión de los sesgos en evolución en las mediciones sobre la superficie del mar y la tierra.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Se cargan las libreias necesarias</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">mktime</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Temas para las figuras</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="s2">&quot;paper&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="manejo-de-la-base-de-datos">
<h2>Manejo de la base de datos<a class="headerlink" href="#manejo-de-la-base-de-datos" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Leer los datos</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/SandraMaldonado19/Dash_PF_Dataviz/main/originaldata_temp.csv&quot;</span>
<span class="n">df_temperature</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">df_temperature</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>january</th>
      <th>february</th>
      <th>march</th>
      <th>april</th>
      <th>may</th>
      <th>june</th>
      <th>july</th>
      <th>august</th>
      <th>september</th>
      <th>october</th>
      <th>november</th>
      <th>december</th>
      <th>yearmean</th>
      <th>Unnamed: 14</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1850</td>
      <td>-0.675</td>
      <td>-0.333</td>
      <td>-0.591</td>
      <td>-0.589</td>
      <td>-0.508</td>
      <td>-0.344</td>
      <td>-0.160</td>
      <td>-0.208</td>
      <td>-0.385</td>
      <td>-0.533</td>
      <td>-0.283</td>
      <td>-0.404</td>
      <td>-0.418</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1850</td>
      <td>53.000</td>
      <td>47.000</td>
      <td>44.000</td>
      <td>48.000</td>
      <td>49.000</td>
      <td>49.000</td>
      <td>52.000</td>
      <td>55.000</td>
      <td>57.000</td>
      <td>55.000</td>
      <td>58.000</td>
      <td>58.000</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1851</td>
      <td>-0.201</td>
      <td>-0.469</td>
      <td>-0.646</td>
      <td>-0.542</td>
      <td>-0.198</td>
      <td>-0.137</td>
      <td>-0.097</td>
      <td>-0.102</td>
      <td>-0.091</td>
      <td>-0.008</td>
      <td>-0.082</td>
      <td>-0.228</td>
      <td>-0.233</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1851</td>
      <td>58.000</td>
      <td>55.000</td>
      <td>56.000</td>
      <td>55.000</td>
      <td>54.000</td>
      <td>53.000</td>
      <td>54.000</td>
      <td>59.000</td>
      <td>47.000</td>
      <td>51.000</td>
      <td>48.000</td>
      <td>48.000</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1852</td>
      <td>-0.375</td>
      <td>-0.477</td>
      <td>-0.560</td>
      <td>-0.585</td>
      <td>-0.127</td>
      <td>-0.084</td>
      <td>0.005</td>
      <td>-0.136</td>
      <td>-0.002</td>
      <td>-0.172</td>
      <td>-0.305</td>
      <td>0.065</td>
      <td>-0.229</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Eliminar columna vacía</span>

<span class="n">df_temperature</span> <span class="o">=</span> <span class="n">df_temperature</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">df_temperature</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">df_temperature</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Unnamed&#39;</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df_temperature</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>january</th>
      <th>february</th>
      <th>march</th>
      <th>april</th>
      <th>may</th>
      <th>june</th>
      <th>july</th>
      <th>august</th>
      <th>september</th>
      <th>october</th>
      <th>november</th>
      <th>december</th>
      <th>yearmean</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1850</td>
      <td>-0.675</td>
      <td>-0.333</td>
      <td>-0.591</td>
      <td>-0.589</td>
      <td>-0.508</td>
      <td>-0.344</td>
      <td>-0.160</td>
      <td>-0.208</td>
      <td>-0.385</td>
      <td>-0.533</td>
      <td>-0.283</td>
      <td>-0.404</td>
      <td>-0.418</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1850</td>
      <td>53.000</td>
      <td>47.000</td>
      <td>44.000</td>
      <td>48.000</td>
      <td>49.000</td>
      <td>49.000</td>
      <td>52.000</td>
      <td>55.000</td>
      <td>57.000</td>
      <td>55.000</td>
      <td>58.000</td>
      <td>58.000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1851</td>
      <td>-0.201</td>
      <td>-0.469</td>
      <td>-0.646</td>
      <td>-0.542</td>
      <td>-0.198</td>
      <td>-0.137</td>
      <td>-0.097</td>
      <td>-0.102</td>
      <td>-0.091</td>
      <td>-0.008</td>
      <td>-0.082</td>
      <td>-0.228</td>
      <td>-0.233</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1851</td>
      <td>58.000</td>
      <td>55.000</td>
      <td>56.000</td>
      <td>55.000</td>
      <td>54.000</td>
      <td>53.000</td>
      <td>54.000</td>
      <td>59.000</td>
      <td>47.000</td>
      <td>51.000</td>
      <td>48.000</td>
      <td>48.000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1852</td>
      <td>-0.375</td>
      <td>-0.477</td>
      <td>-0.560</td>
      <td>-0.585</td>
      <td>-0.127</td>
      <td>-0.084</td>
      <td>0.005</td>
      <td>-0.136</td>
      <td>-0.002</td>
      <td>-0.172</td>
      <td>-0.305</td>
      <td>0.065</td>
      <td>-0.229</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Con este código logramos eliminar la columna que no representar información sobre los datos que se desean analizar</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Eliminar filas intermedias</span>
<span class="n">df_temperature</span> <span class="o">=</span> <span class="n">df_temperature</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">df_temperature</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_temperature</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>january</th>
      <th>february</th>
      <th>march</th>
      <th>april</th>
      <th>may</th>
      <th>june</th>
      <th>july</th>
      <th>august</th>
      <th>september</th>
      <th>october</th>
      <th>november</th>
      <th>december</th>
      <th>yearmean</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1850</td>
      <td>-0.675</td>
      <td>-0.333</td>
      <td>-0.591</td>
      <td>-0.589</td>
      <td>-0.508</td>
      <td>-0.344</td>
      <td>-0.160</td>
      <td>-0.208</td>
      <td>-0.385</td>
      <td>-0.533</td>
      <td>-0.283</td>
      <td>-0.404</td>
      <td>-0.418</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1851</td>
      <td>-0.201</td>
      <td>-0.469</td>
      <td>-0.646</td>
      <td>-0.542</td>
      <td>-0.198</td>
      <td>-0.137</td>
      <td>-0.097</td>
      <td>-0.102</td>
      <td>-0.091</td>
      <td>-0.008</td>
      <td>-0.082</td>
      <td>-0.228</td>
      <td>-0.233</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1852</td>
      <td>-0.375</td>
      <td>-0.477</td>
      <td>-0.560</td>
      <td>-0.585</td>
      <td>-0.127</td>
      <td>-0.084</td>
      <td>0.005</td>
      <td>-0.136</td>
      <td>-0.002</td>
      <td>-0.172</td>
      <td>-0.305</td>
      <td>0.065</td>
      <td>-0.229</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1853</td>
      <td>-0.233</td>
      <td>-0.404</td>
      <td>-0.280</td>
      <td>-0.386</td>
      <td>-0.268</td>
      <td>-0.142</td>
      <td>-0.083</td>
      <td>-0.057</td>
      <td>-0.250</td>
      <td>-0.392</td>
      <td>-0.411</td>
      <td>-0.337</td>
      <td>-0.270</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1854</td>
      <td>-0.381</td>
      <td>-0.361</td>
      <td>-0.243</td>
      <td>-0.334</td>
      <td>-0.291</td>
      <td>-0.299</td>
      <td>-0.179</td>
      <td>-0.239</td>
      <td>-0.217</td>
      <td>-0.095</td>
      <td>-0.410</td>
      <td>-0.450</td>
      <td>-0.292</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Este código se ejecutó para eliminar las filas que no son parte del estudio, con el objetivo de quedarnos con aquellas que aportan al desarrollo de este.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cambiar el formato del dataframe para que pueda tener variables identificadores de mi elección. </span>
<span class="c1">## vamos a cambiar las columnas que son valores de meses, a elementos de la columna month para cada año.</span>

<span class="c1"># Convertir a formato de serie de tiempo</span>

<span class="c1"># Crear las nuevas columnas &quot;month&quot;, &quot;year&quot; y &quot;value&quot;</span>
<span class="n">df_timeseries</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">])</span>

<span class="c1"># Iterar sobre las filas del DataFrame original</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_temperature</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">year</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">df_temperature</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>  <span class="c1"># Ignorar la primera columna (year) y la última (yearmean)</span>
        <span class="n">new_row</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">year</span><span class="p">],</span> <span class="s1">&#39;month&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">month</span><span class="p">],</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="n">month</span><span class="p">]]})</span>
        <span class="n">df_timeseries</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_timeseries</span><span class="p">,</span> <span class="n">new_row</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="c1"># Asegurarse de que los tipos de datos sean correctos</span>
<span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># Ver el nuevo DataFrame transformado</span>
<span class="n">df_timeseries</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>month</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1850</td>
      <td>january</td>
      <td>-0.675</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1850</td>
      <td>february</td>
      <td>-0.333</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1850</td>
      <td>march</td>
      <td>-0.591</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1850</td>
      <td>april</td>
      <td>-0.589</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1850</td>
      <td>may</td>
      <td>-0.508</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1850</td>
      <td>june</td>
      <td>-0.344</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1850</td>
      <td>july</td>
      <td>-0.160</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1850</td>
      <td>august</td>
      <td>-0.208</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1850</td>
      <td>september</td>
      <td>-0.385</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1850</td>
      <td>october</td>
      <td>-0.533</td>
    </tr>
    <tr>
      <th>10</th>
      <td>1850</td>
      <td>november</td>
      <td>-0.283</td>
    </tr>
    <tr>
      <th>11</th>
      <td>1850</td>
      <td>december</td>
      <td>-0.404</td>
    </tr>
    <tr>
      <th>12</th>
      <td>1851</td>
      <td>january</td>
      <td>-0.201</td>
    </tr>
    <tr>
      <th>13</th>
      <td>1851</td>
      <td>february</td>
      <td>-0.469</td>
    </tr>
    <tr>
      <th>14</th>
      <td>1851</td>
      <td>march</td>
      <td>-0.646</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Este código usa pandas para transformar un DataFrame llamado ‘df_temperature’ en una serie de tiempo representada por otro DataFrame llamado ‘df_timeseries’. Se crea un nuevo DataFrame con columnas ‘year’, ‘month’ y ‘value’. Luego, se retoma sobre las filas del DataFrame original para extraer el año y cada valor mensual, creando un nuevo registro por cada mes con su respectivo dato. Después, se asegura que el tipo de dato de la columna ‘year’ sea entero y se muestra una vista previa de las primeras 15 filas del nuevo DataFrame ‘df_timeseries’ que contiene la serie de tiempo transformada.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Crear la nueva columna de fecha en formato %Y-%m</span>
<span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%B&#39;</span><span class="p">)</span>

<span class="c1"># Formatear la fecha para que solo muestre mes y año</span>
<span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m&#39;</span><span class="p">)</span>

<span class="c1"># Ver el DataFrame final con la nueva columna de fecha</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_timeseries</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      year      month  value     date
0     1850    january -0.675  1850-01
1     1850   february -0.333  1850-02
2     1850      march -0.591  1850-03
3     1850      april -0.589  1850-04
4     1850        may -0.508  1850-05
...    ...        ...    ...      ...
2083  2023     august  1.199  2023-08
2084  2023  september  1.347  2023-09
2085  2023    october -9.999  2023-10
2086  2023   november -9.999  2023-11
2087  2023   december -9.999  2023-12

[2088 rows x 4 columns]
</pre></div>
</div>
</div>
</div>
<p>Este código transforma el formato de fecha que se tiene de los datos originales con el fin de tener los datos en el formato requerido para la serie de tiempo.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Eliminar las últimas tres filas</span>
<span class="n">df_timeseries</span> <span class="o">=</span> <span class="n">df_timeseries</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>

<span class="c1"># Ver el DataFrame después de eliminar las filas</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_timeseries</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      year      month  value     date
0     1850    january -0.675  1850-01
1     1850   february -0.333  1850-02
2     1850      march -0.591  1850-03
3     1850      april -0.589  1850-04
4     1850        may -0.508  1850-05
...    ...        ...    ...      ...
2080  2023        may  0.871  2023-05
2081  2023       june  1.052  2023-06
2082  2023       july  1.150  2023-07
2083  2023     august  1.199  2023-08
2084  2023  september  1.347  2023-09

[2085 rows x 4 columns]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_timeseries</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;df_timeseries.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="construccion-del-dash">
<h1>Construcción del dash<a class="headerlink" href="#construccion-del-dash" title="Permalink to this heading">#</a></h1>
<ul class="simple">
<li><p>Antes de iniciar el análisis exploratorio de datos, primero importamos las bibliotecas necesarias, incluyendo <code class="docutils literal notranslate"><span class="pre">dash</span></code>, <code class="docutils literal notranslate"><span class="pre">plotly</span></code>, <code class="docutils literal notranslate"><span class="pre">pandas</span></code> y <code class="docutils literal notranslate"><span class="pre">numpy</span></code>. Luego, se carga el conjunto de datos de series temporales desde una URL específica en un DataFrame de pandas. Finalmente, muestra las primeras filas del DataFrame para verificar que los datos se hayan cargado correctamente.</p></li>
</ul>
<div class="highlight-PowerShell notranslate"><div class="highlight"><pre><span></span><span class="n">import</span> <span class="n">dash</span>
<span class="n">from</span> <span class="n">dash</span> <span class="n">import</span> <span class="n">dcc</span>
<span class="n">from</span> <span class="n">dash</span> <span class="n">import</span> <span class="n">html</span>
<span class="n">from</span> <span class="n">dash</span><span class="p">.</span><span class="n">dependencies</span> <span class="n">import</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Output</span>
<span class="n">import</span> <span class="n">plotly</span><span class="p">.</span><span class="n">express</span> <span class="n">as</span> <span class="n">px</span>
<span class="n">import</span> <span class="n">plotly</span><span class="p">.</span><span class="n">graph_objects</span> <span class="n">as</span> <span class="n">go</span>
<span class="n">import</span> <span class="n">pandas</span> <span class="n">as</span> <span class="n">pd</span>
<span class="n">import</span> <span class="n">numpy</span> <span class="n">as</span> <span class="n">np</span>
<span class="n">from</span> <span class="n">datetime</span> <span class="n">import</span> <span class="n">datetime</span>

<span class="c">#____ Cargue de datos_________________________________________________________________________________________</span>

<span class="n">timeseries_URL</span> <span class="p">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/SandraMaldonado19/Dash_PF_Dataviz/main/df_timeseries.csv&quot;</span>
<span class="n">df_tseries</span> <span class="p">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">timeseries_URL</span><span class="p">)</span>
<span class="n">df_tseries</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Luego, graficamos la serie de tiempo con una media móvil de 12 meses. Definimos una función para calcular la media móvil y el intervalo de confianza de los datos. Además, una función de devolución de llamada que se activa cuando el usuario pasa el ratón sobre el gráfico. Esta función actualiza el gráfico para mostrar la serie temporal original, la media móvil y el intervalo de confianza.</p></li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dash</span>
<span class="kn">from</span> <span class="nn">dash</span> <span class="kn">import</span>  <span class="n">dcc</span><span class="p">,</span> <span class="n">html</span><span class="p">,</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Output</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>


<span class="n">timeseries_URL</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/SandraMaldonado19/Dash_PF_Dataviz/main/df_timeseries.csv&quot;</span>
<span class="n">df_tseries</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">timeseries_URL</span><span class="p">)</span>


<span class="c1"># Definimos la función encargada de calcular la media móvil y el intervalo de </span>
<span class="c1">## En este código &#39;1.96&#39; es el valor z para un intervalo de confianza del 95%.</span>

<span class="c1"># Función para calcular la media móvil y el intervalo de confianza</span>
<span class="k">def</span> <span class="nf">calculate_rolling_mean</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">num_of_std</span><span class="o">=</span><span class="mf">1.96</span><span class="p">):</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rolling_mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window_size</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rolling_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window_size</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;upper_band&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rolling_mean&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rolling_std&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_of_std</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;lower_band&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rolling_mean&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rolling_std&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_of_std</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="c1"># Crear la aplicación Dash</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">dash</span><span class="o">.</span><span class="n">Dash</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># Diseño de la aplicación</span>
<span class="n">app</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
    <span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="s1">&#39;Análisis de Anomalía de Temperatura Global &#39;</span><span class="p">,</span>
                <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;display&#39;</span><span class="p">:</span> <span class="s1">&#39;inline&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;float&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;2.65em&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;margin-left&#39;</span><span class="p">:</span> <span class="s1">&#39;7px&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;font-weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bolder&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;font-family&#39;</span><span class="p">:</span> <span class="s1">&#39;Product Sans&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s2">&quot;rgba(117, 117, 117, 0.95)&quot;</span><span class="p">,</span>
                       <span class="s1">&#39;margin-top&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;margin-bottom&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span>
                       <span class="p">}),</span>
    <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;timeseries-graph&#39;</span><span class="p">),</span>
<span class="p">])</span>

<span class="c1"># Definir la función callback</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="s1">&#39;timeseries-graph&#39;</span><span class="p">,</span> <span class="s1">&#39;figure&#39;</span><span class="p">),</span>
              <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s1">&#39;timeseries-graph&#39;</span><span class="p">,</span> <span class="s1">&#39;hoverData&#39;</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">update_graph</span><span class="p">(</span><span class="n">hoverData</span><span class="p">):</span>
    <span class="c1"># Calcular la media móvil y el intervalo de confianza</span>
    <span class="n">df_timeseries</span> <span class="o">=</span> <span class="n">calculate_rolling_mean</span><span class="p">(</span><span class="n">df_tseries</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>  <span class="c1"># Asegúrate de tener una copia del DataFrame original</span>
    <span class="n">trace_data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Agregar la serie temporal original</span>
    <span class="n">trace_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span>
        <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;line&#39;</span><span class="p">,</span>
        <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;lines&#39;</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Original Data&#39;</span><span class="p">,</span>
        <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">}</span>
    <span class="p">})</span>

    <span class="c1"># Agregar la media móvil</span>
    <span class="n">trace_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span>
        <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;rolling_mean&#39;</span><span class="p">],</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;line&#39;</span><span class="p">,</span>
        <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;lines&#39;</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;12-Month Rolling Mean&#39;</span><span class="p">,</span>
        <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">}</span>
    <span class="p">})</span>

    <span class="c1"># Agregar el intervalo de confianza</span>
    <span class="n">trace_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span>
        <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;upper_band&#39;</span><span class="p">],</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;line&#39;</span><span class="p">,</span>
        <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;lines&#39;</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Upper Band&#39;</span><span class="p">,</span>
        <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;dash&#39;</span><span class="p">:</span> <span class="s1">&#39;dash&#39;</span><span class="p">}</span>
    <span class="p">})</span>

    <span class="n">trace_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span>
        <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;lower_band&#39;</span><span class="p">],</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;line&#39;</span><span class="p">,</span>
        <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;lines&#39;</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Lower Band&#39;</span><span class="p">,</span>
        <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;dash&#39;</span><span class="p">:</span> <span class="s1">&#39;dash&#39;</span><span class="p">}</span>
    <span class="p">})</span>

    <span class="c1"># Marcar la media correspondiente al año cuando se pasa el ratón sobre la gráfica</span>
    <span class="k">if</span> <span class="n">hoverData</span><span class="p">:</span>
        <span class="n">year_hovered</span> <span class="o">=</span> <span class="n">hoverData</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">mean_value</span> <span class="o">=</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">year_hovered</span><span class="p">)][</span><span class="s1">&#39;rolling_mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">trace_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">hoverData</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mean_value</span><span class="p">],</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;scatter&#39;</span><span class="p">,</span>
            <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;markers&#39;</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Mean </span><span class="si">{</span><span class="n">year_hovered</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
            <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Mean </span><span class="si">{</span><span class="n">year_hovered</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="p">})</span>

    <span class="n">figure</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">trace_data</span><span class="p">,</span>
        <span class="s1">&#39;layout&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Media Móvil de 12 Meses con Intervalo de Confianza&#39;</span><span class="p">,</span>
            <span class="s1">&#39;xaxis&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Fecha&#39;</span><span class="p">},</span>
            <span class="s1">&#39;yaxis&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Valor&#39;</span><span class="p">},</span>
            <span class="s1">&#39;margin&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">},</span>
            <span class="s1">&#39;legend&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">figure</span>

<span class="c1"># Ejecutar la aplicación</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run_server</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Ahora creamos un boxplot para cada mes y una línea de tendencia que representa la media multianual</p></li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dash</span>
<span class="kn">from</span> <span class="nn">dash</span> <span class="kn">import</span> <span class="n">dcc</span><span class="p">,</span> <span class="n">html</span>
<span class="kn">from</span> <span class="nn">dash.dependencies</span> <span class="kn">import</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Output</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Lectura de datos</span>
<span class="n">df_tseries</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./df_timeseries.csv&#39;</span><span class="p">)</span>

<span class="c1"># Crear la aplicación Dash</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">dash</span><span class="o">.</span><span class="n">Dash</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># Definir el diseño de la aplicación</span>
<span class="n">app</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
    <span class="n">html</span><span class="o">.</span><span class="n">H1</span><span class="p">(</span><span class="s2">&quot;Boxplot Multianual por Mes&quot;</span><span class="p">),</span>

    <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;boxplot&#39;</span><span class="p">),</span>

    <span class="c1"># Puedes agregar más componentes de diseño según sea necesario</span>
<span class="p">])</span>

<span class="c1"># Definir la función para actualizar el gráfico</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="s1">&#39;boxplot&#39;</span><span class="p">,</span> <span class="s1">&#39;figure&#39;</span><span class="p">),</span>
              <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s1">&#39;boxplot&#39;</span><span class="p">,</span> <span class="s1">&#39;hoverData&#39;</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">update_boxplot</span><span class="p">(</span><span class="n">hoverData</span><span class="p">):</span>
    <span class="c1"># Crear el boxplot con Plotly Graph Objects</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

    <span class="c1"># Agregar boxplots para cada mes</span>
    <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[</span><span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">month</span><span class="p">]</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="n">month</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">))</span>

    <span class="c1"># Agregar la línea de tendencia (media multianual)</span>
    <span class="n">trend_line</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">)[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    
    <span class="c1"># Ordenar los datos por el orden de los meses</span>
    <span class="n">ordered_months</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;january&#39;</span><span class="p">,</span> <span class="s1">&#39;february&#39;</span><span class="p">,</span> <span class="s1">&#39;march&#39;</span><span class="p">,</span> <span class="s1">&#39;april&#39;</span><span class="p">,</span> <span class="s1">&#39;may&#39;</span><span class="p">,</span> <span class="s1">&#39;june&#39;</span><span class="p">,</span> <span class="s1">&#39;july&#39;</span><span class="p">,</span> <span class="s1">&#39;august&#39;</span><span class="p">,</span> <span class="s1">&#39;september&#39;</span><span class="p">,</span> <span class="s1">&#39;october&#39;</span><span class="p">,</span> <span class="s1">&#39;november&#39;</span><span class="p">,</span> <span class="s1">&#39;december&#39;</span><span class="p">]</span>
    <span class="n">trend_line</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">trend_line</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">],</span> <span class="n">categories</span><span class="o">=</span><span class="n">ordered_months</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">trend_line</span> <span class="o">=</span> <span class="n">trend_line</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">trend_line</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">trend_line</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
                             <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">dash</span><span class="o">=</span><span class="s1">&#39;dash&#39;</span><span class="p">),</span>
                             <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Media Multianual&#39;</span><span class="p">))</span>

    <span class="c1"># Ajustar el diseño del gráfico</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">xaxis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Mes&#39;</span><span class="p">},</span> <span class="n">yaxis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Anomalía de Temperatura&#39;</span><span class="p">},</span>
                      <span class="n">boxmode</span><span class="o">=</span><span class="s1">&#39;group&#39;</span><span class="p">)</span>  <span class="c1"># Para agrupar los boxplots en el eje x</span>

    <span class="k">return</span> <span class="n">fig</span>

<span class="c1"># Ejecutar la aplicación</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run_server</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dash</span>
<span class="kn">from</span> <span class="nn">dash</span> <span class="kn">import</span> <span class="n">dcc</span>
<span class="kn">from</span> <span class="nn">dash</span> <span class="kn">import</span> <span class="n">html</span>
<span class="kn">from</span> <span class="nn">dash.dependencies</span> <span class="kn">import</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Output</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="n">timeseries_URL</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/SandraMaldonado19/Dash_PF_Dataviz/main/df_timeseries.csv&quot;</span>
<span class="n">df_tseries</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">timeseries_URL</span><span class="p">)</span>
<span class="n">df_tseries</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>


<span class="c1"># Definimos la función encargada de calcular la media móvil y el intervalo de </span>
<span class="c1">## En este código &#39;1.96&#39; es el valor z para un intervalo de confianza del 95%.</span>

<span class="c1"># Función para calcular la media móvil y el intervalo de confianza</span>
<span class="k">def</span> <span class="nf">calculate_rolling_mean</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">num_of_std</span><span class="o">=</span><span class="mf">1.96</span><span class="p">):</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rolling_mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window_size</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rolling_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window_size</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;upper_band&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rolling_mean&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rolling_std&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_of_std</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;lower_band&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rolling_mean&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rolling_std&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_of_std</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="c1"># Orden de los meses</span>
<span class="n">month_order</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;january&#39;</span><span class="p">,</span> <span class="s1">&#39;february&#39;</span><span class="p">,</span> <span class="s1">&#39;march&#39;</span><span class="p">,</span> <span class="s1">&#39;april&#39;</span><span class="p">,</span> <span class="s1">&#39;may&#39;</span><span class="p">,</span> <span class="s1">&#39;june&#39;</span><span class="p">,</span> <span class="s1">&#39;july&#39;</span><span class="p">,</span> <span class="s1">&#39;august&#39;</span><span class="p">,</span> <span class="s1">&#39;september&#39;</span><span class="p">,</span> <span class="s1">&#39;october&#39;</span><span class="p">,</span> <span class="s1">&#39;november&#39;</span><span class="p">,</span> <span class="s1">&#39;december&#39;</span><span class="p">]</span>
<span class="c1"># Pivotar los datos para tener años en el eje x, meses en el eje y</span>
<span class="n">heatmap_data</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
<span class="c1"># Configurar el orden de los meses en el eje y</span>
<span class="n">heatmap_data</span> <span class="o">=</span> <span class="n">heatmap_data</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">month_order</span><span class="p">)</span>


<span class="c1"># Convertir la columna &#39;date&#39; a tipo datetime si aún no lo está</span>
<span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>
<span class="c1"># Agregar una columna &#39;decade&#39; para agrupar por década</span>
<span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;decade&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">//</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span>
<span class="c1"># Agregar una columna &#39;color&#39; basada en la condición de la anomalía</span>
<span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>

<span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
<span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>
<span class="c1"># Encuentra los tres años más cálidos, excluyendo el año actual</span>
<span class="n">current_year</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span>
<span class="n">top_years</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[</span><span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">current_year</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>
<span class="c1"># Encuentra los valores máximos para cada mes</span>
<span class="n">max_values</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">)[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>



<span class="n">app</span> <span class="o">=</span> <span class="n">dash</span><span class="o">.</span><span class="n">Dash</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">suppress_callback_exceptions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">app</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
    <span class="n">dcc</span><span class="o">.</span><span class="n">Location</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">html</span><span class="o">.</span><span class="n">Main</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;display&#39;</span><span class="p">:</span><span class="s1">&#39;grid&#39;</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">:</span><span class="s1">&#39;100%&#39;</span><span class="p">,</span><span class="s1">&#39;minHeight&#39;</span><span class="p">:</span><span class="s1">&#39;100vh&#39;</span><span class="p">,</span><span class="s1">&#39;gridTemplateColumns&#39;</span><span class="p">:</span> <span class="s1">&#39;50vh 1fr&#39;</span><span class="p">,</span> <span class="s1">&#39;gridTemplateRows&#39;</span><span class="p">:</span> <span class="s1">&#39;50px 1fr 30px&#39;</span><span class="p">,</span> <span class="p">},</span> <span class="n">children</span><span class="o">=</span><span class="p">[</span>
       
        <span class="n">html</span><span class="o">.</span><span class="n">Nav</span><span class="p">(</span><span class="n">className</span><span class="o">=</span><span class="s1">&#39;nav&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;display&#39;</span><span class="p">:</span><span class="s1">&#39;fixed&#39;</span><span class="p">,</span><span class="s1">&#39;gridArea&#39;</span><span class="p">:</span><span class="s1">&#39;nav&#39;</span><span class="p">,</span> <span class="s1">&#39;gridColumnStart&#39;</span><span class="p">:</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;gridColumnEnd&#39;</span><span class="p">:</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;gridRowStart&#39;</span><span class="p">:</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;gridRowEnd&#39;</span><span class="p">:</span><span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="s1">&#39;border&#39;</span><span class="p">:</span><span class="s1">&#39;1px solid #cbc4ad&#39;</span><span class="p">,</span> <span class="s1">&#39;borderRadius&#39;</span><span class="p">:</span><span class="s1">&#39;5px&#39;</span><span class="p">,</span> <span class="s1">&#39;padding&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">},</span> <span class="n">children</span><span class="o">=</span><span class="p">[</span>
            <span class="n">html</span><span class="o">.</span><span class="n">H1</span><span class="p">(</span><span class="s1">&#39;Anomalia de Temperatura de Superficie Global&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;marginBottom&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span> <span class="s1">&#39;fontSize&#39;</span><span class="p">:</span><span class="s1">&#39;1.5rem&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span><span class="s1">&#39;center&#39;</span><span class="p">}),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="s1">&#39;¿Cuáles han sido las variaciones más significativas de la temperatura de la superficie global a lo largo del tiempo?&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;marginBottom&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span> <span class="s1">&#39;fontSize&#39;</span><span class="p">:</span><span class="s1">&#39;1rem&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span><span class="s1">&#39;left&#39;</span><span class="p">}),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">H3</span><span class="p">(</span><span class="s1">&#39;¿Aumentará la temperatura los próximos meses?&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#de3100&#39;</span><span class="p">,</span> <span class="s1">&#39;marginBottom&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span> <span class="s1">&#39;fontSize&#39;</span><span class="p">:</span><span class="s1">&#39;1rem&#39;</span><span class="p">,</span><span class="s1">&#39;fontWeight&#39;</span><span class="p">:</span><span class="s1">&#39;900&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span><span class="s1">&#39;left&#39;</span><span class="p">}),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">Ul</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;display&#39;</span><span class="p">:</span> <span class="s1">&#39;flex&#39;</span><span class="p">,</span> <span class="s1">&#39;justifyContent&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="s1">&#39;flexDirection&#39;</span><span class="p">:</span><span class="s1">&#39;column&#39;</span><span class="p">,</span> <span class="s1">&#39;alignItems&#39;</span><span class="p">:</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span><span class="s1">&#39;100%&#39;</span><span class="p">,</span><span class="s1">&#39;margin&#39;</span><span class="p">:</span><span class="s1">&#39;10px 0&#39;</span><span class="p">,</span><span class="s1">&#39;padding&#39;</span><span class="p">:</span><span class="s1">&#39;0&#39;</span><span class="p">},</span><span class="n">children</span> <span class="o">=</span><span class="p">[</span>
                <span class="n">dcc</span><span class="o">.</span><span class="n">Link</span><span class="p">(</span><span class="s1">&#39;Inicio&#39;</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="s1">&#39;fontSize&#39;</span><span class="p">:</span> <span class="s1">&#39;15px&#39;</span><span class="p">,</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;80%&#39;</span><span class="p">,</span><span class="s1">&#39;marginBottom&#39;</span><span class="p">:</span><span class="s1">&#39;8px&#39;</span><span class="p">,</span> <span class="s1">&#39;textDecoration&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;padding&#39;</span><span class="p">:</span> <span class="s1">&#39;10px&#39;</span><span class="p">,</span> <span class="s1">&#39;borderRadius&#39;</span><span class="p">:</span> <span class="s1">&#39;5px&#39;</span><span class="p">,</span> <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;#ffa888&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">}),</span>
                <span class="n">dcc</span><span class="o">.</span><span class="n">Link</span><span class="p">(</span><span class="s1">&#39;Serie de tiempo&#39;</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="s1">&#39;/time-series&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;80%&#39;</span><span class="p">,</span><span class="s1">&#39;marginBottom&#39;</span><span class="p">:</span><span class="s1">&#39;8px&#39;</span><span class="p">,</span>  <span class="s1">&#39;fontSize&#39;</span><span class="p">:</span> <span class="s1">&#39;15px&#39;</span><span class="p">,</span> <span class="s1">&#39;textDecoration&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;padding&#39;</span><span class="p">:</span> <span class="s1">&#39;10px&#39;</span><span class="p">,</span> <span class="s1">&#39;borderRadius&#39;</span><span class="p">:</span> <span class="s1">&#39;5px&#39;</span><span class="p">,</span> <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;#ffa888&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">}),</span>
                <span class="n">dcc</span><span class="o">.</span><span class="n">Link</span><span class="p">(</span><span class="s1">&#39;Modelo Predictivo&#39;</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="s1">&#39;/predictive-model&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;80%&#39;</span><span class="p">,</span><span class="s1">&#39;marginBottom&#39;</span><span class="p">:</span><span class="s1">&#39;8px&#39;</span><span class="p">,</span>  <span class="s1">&#39;fontSize&#39;</span><span class="p">:</span> <span class="s1">&#39;15px&#39;</span><span class="p">,</span> <span class="s1">&#39;textDecoration&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;padding&#39;</span><span class="p">:</span> <span class="s1">&#39;10px&#39;</span><span class="p">,</span> <span class="s1">&#39;borderRadius&#39;</span><span class="p">:</span> <span class="s1">&#39;5px&#39;</span><span class="p">,</span> <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;#ffa888&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">}),</span>

            <span class="p">]),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;explain-content&#39;</span><span class="p">)</span>
        <span class="p">]),</span>

        <span class="n">html</span><span class="o">.</span><span class="n">Section</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;page-content&#39;</span><span class="p">,</span> <span class="n">className</span><span class="o">=</span><span class="s1">&#39;section&#39;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;gridArea&#39;</span><span class="p">:</span><span class="s1">&#39;section&#39;</span><span class="p">,</span> <span class="s1">&#39;gridColumnStart&#39;</span><span class="p">:</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;gridColumnEnd&#39;</span><span class="p">:</span><span class="s1">&#39;4&#39;</span><span class="p">,</span><span class="s1">&#39;gridRowStart&#39;</span><span class="p">:</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;gridRowEnd&#39;</span><span class="p">:</span><span class="s1">&#39;5&#39;</span><span class="p">,</span><span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="s1">&#39;border&#39;</span><span class="p">:</span><span class="s1">&#39;1px solid #cbc4ad&#39;</span><span class="p">,</span> <span class="s1">&#39;borderRadius&#39;</span><span class="p">:</span><span class="s1">&#39;5px&#39;</span><span class="p">,</span> <span class="s1">&#39;padding&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">}),</span>
    <span class="p">]),</span>
<span class="p">])</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="s1">&#39;explain-content&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
              <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="s1">&#39;pathname&#39;</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">display_page</span><span class="p">(</span><span class="n">pathname</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">pathname</span> <span class="o">==</span> <span class="s1">&#39;/time-series&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">()</span> 
    <span class="k">elif</span> <span class="n">pathname</span> <span class="o">==</span> <span class="s1">&#39;/predictive-model&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">)</span>
      
<span class="c1"># Update the index</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="s1">&#39;page-content&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
              <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="s1">&#39;pathname&#39;</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">display_page</span><span class="p">(</span><span class="n">pathname</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">pathname</span> <span class="o">==</span> <span class="s1">&#39;/time-series&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
                 <span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="s1">&#39;Serie de tiempo - Anomalía de Temperatura Global (1850 - 2023)&#39;</span><span class="p">),</span>
                <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;timeseries-graph&#39;</span><span class="p">),</span>
                <span class="p">]),</span>
                <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
                    <span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="s2">&quot; Boxplot - Variación mensual multianual (1850 - 2023)&quot;</span><span class="p">,),</span>
                    <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;boxplot&#39;</span><span class="p">)]),</span>
                <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
                    <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
                        <span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="s2">&quot;Heatmap- Exploración de patrones y tendencias&quot;</span><span class="p">),</span>
                        <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;heatmap&#39;</span><span class="p">),]),</span>
                    <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
                        <span class="n">html</span><span class="o">.</span><span class="n">H1</span><span class="p">(</span><span class="s2">&quot;Barplot - Promedios Decenales de Anomalías de Temperatura&quot;</span><span class="p">),</span>
                        <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;bar-chart&#39;</span><span class="p">),</span>
                    <span class="p">])</span>
                <span class="p">]),</span>
                <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
                    <span class="n">dcc</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
                        <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;year-picker&#39;</span><span class="p">,</span>
                        <span class="n">options</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()],</span>
                        <span class="n">value</span><span class="o">=</span><span class="p">[</span><span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span>
                        <span class="n">multi</span><span class="o">=</span><span class="kc">True</span>
                    <span class="p">),</span>
                     <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;temperature-graph&#39;</span><span class="p">)</span>
                <span class="p">])</span>
            <span class="p">)</span>
    <span class="k">elif</span> <span class="n">pathname</span> <span class="o">==</span> <span class="s1">&#39;/predictive-model&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
            <span class="n">html</span><span class="o">.</span><span class="n">H3</span><span class="p">(</span><span class="s1">&#39;Estás en la página del modelo predictivo&#39;</span><span class="p">)</span>
        <span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">html</span><span class="o">.</span><span class="n">H4</span><span class="p">(</span><span class="s1">&#39;Sobre el conjunto de datos&#39;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontSize&#39;</span><span class="p">:</span><span class="s1">&#39;1rem&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span><span class="s1">&#39;left&#39;</span><span class="p">}),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="s1">&#39;Presentamos el análisis de un conjunto de datos llamado HadCRUT5, que mide los cambios de temperatura cercana a la superficie en todo el mundo, entre 1850 a 2018. HadCRUT5 presenta anomalías mensuales promedio de temperatura cercana a la superficie, en relación con el período 1961–1990.&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontSize&#39;</span><span class="p">:</span><span class="s1">&#39;0.8rem&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="s1">&#39;lineHeight&#39;</span><span class="p">:</span><span class="s1">&#39;150%&#39;</span><span class="p">}),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="s1">&#39;En general, este conjunto de datos muestra un aumento del calentamiento promedio global desde mediados del siglo 19 y en los últimos años, en consonancia con otros análisis. Este fenómeno se debe a múltiples factores, incluidos una mejor representación del calentamiento del Ártico y una mejor comprensión de los sesgos en evolución en las mediciones sobre la superficie del mar y la tierra.&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontSize&#39;</span><span class="p">:</span><span class="s1">&#39;0.8rem&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="s1">&#39;lineHeight&#39;</span><span class="p">:</span><span class="s1">&#39;150%&#39;</span><span class="p">}),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="s1">&#39;Para revisar a detalle el proceso de obtención y procesamiento de los datos, visite la información de referencia. &#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontSize&#39;</span><span class="p">:</span><span class="s1">&#39;0.8rem&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="s1">&#39;lineHeight&#39;</span><span class="p">:</span><span class="s1">&#39;150%&#39;</span><span class="p">}),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="s1">&#39;Morice, C. P., Kennedy, J. J., Rayner, N. A., Winn, J. P., Hogan, E., Killick, R. E., Dunn, R. J. H., Osborn, T. J., Jones, P. D., &amp; Simpson, I. R. (2021). An Updated Assessment of Near-Surface Temperature Change From 1850: The HadCRUT5 Data Set. Journal of Geophysical Research: Atmospheres, 126(3), e2019JD032361. https://doi.org/10.1029/2019JD032361&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontSize&#39;</span><span class="p">:</span><span class="s1">&#39;0.8rem&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="s1">&#39;lineHeight&#39;</span><span class="p">:</span><span class="s1">&#39;150%&#39;</span><span class="p">}),</span>
        <span class="p">)</span>


<span class="c1"># Definir la función callback</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="s1">&#39;timeseries-graph&#39;</span><span class="p">,</span> <span class="s1">&#39;figure&#39;</span><span class="p">),</span>
              <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s1">&#39;timeseries-graph&#39;</span><span class="p">,</span> <span class="s1">&#39;hoverData&#39;</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">update_graph</span><span class="p">(</span><span class="n">hoverData</span><span class="p">):</span>
    <span class="c1"># Calcular la media móvil y el intervalo de confianza</span>
    <span class="n">df_timeseries</span> <span class="o">=</span> <span class="n">calculate_rolling_mean</span><span class="p">(</span><span class="n">df_tseries</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>  <span class="c1"># Asegúrate de tener una copia del DataFrame original</span>
    <span class="n">trace_data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Agregar la serie temporal original</span>
    <span class="n">trace_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span>
        <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;line&#39;</span><span class="p">,</span>
        <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;lines&#39;</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Serie de tiempo&#39;</span><span class="p">,</span>
        <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">}</span>
    <span class="p">})</span>

    <span class="c1"># Agregar la media móvil</span>
    <span class="n">trace_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span>
        <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;rolling_mean&#39;</span><span class="p">],</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;line&#39;</span><span class="p">,</span>
        <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;lines&#39;</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Media móvil de 12 meses&#39;</span><span class="p">,</span>
        <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">}</span>
    <span class="p">})</span>

    <span class="c1"># Agregar el intervalo de confianza</span>
    <span class="n">trace_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span>
        <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;upper_band&#39;</span><span class="p">],</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;line&#39;</span><span class="p">,</span>
        <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;lines&#39;</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;IC - 95%&#39;</span><span class="p">,</span>
        <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;dash&#39;</span><span class="p">:</span> <span class="s1">&#39;dash&#39;</span><span class="p">}</span>
    <span class="p">})</span>

    <span class="n">trace_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span>
        <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;lower_band&#39;</span><span class="p">],</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;line&#39;</span><span class="p">,</span>
        <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;lines&#39;</span><span class="p">,</span>
        <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;dash&#39;</span><span class="p">:</span> <span class="s1">&#39;dash&#39;</span><span class="p">}</span>
    <span class="p">})</span>

    <span class="c1"># Marcar la media correspondiente al año cuando se pasa el ratón sobre la gráfica</span>
    <span class="k">if</span> <span class="n">hoverData</span><span class="p">:</span>
        <span class="n">year_hovered</span> <span class="o">=</span> <span class="n">hoverData</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">mean_value</span> <span class="o">=</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">year_hovered</span><span class="p">)][</span><span class="s1">&#39;rolling_mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">trace_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">hoverData</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mean_value</span><span class="p">],</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;scatter&#39;</span><span class="p">,</span>
            <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;markers&#39;</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Mean </span><span class="si">{</span><span class="n">year_hovered</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
            <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Mean </span><span class="si">{</span><span class="n">year_hovered</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="p">})</span>

    <span class="n">figure</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">trace_data</span><span class="p">,</span>
        <span class="s1">&#39;layout&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;xaxis&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Fecha&#39;</span><span class="p">},</span>
            <span class="s1">&#39;yaxis&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Anomalía de temperatura (°C)&#39;</span><span class="p">},</span>
            <span class="s1">&#39;margin&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">},</span>
            <span class="s1">&#39;legend&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">figure</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="s1">&#39;boxplot&#39;</span><span class="p">,</span> <span class="s1">&#39;figure&#39;</span><span class="p">),</span>
              <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s1">&#39;boxplot&#39;</span><span class="p">,</span> <span class="s1">&#39;hoverData&#39;</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">update_boxplot</span><span class="p">(</span><span class="n">hoverData</span><span class="p">):</span>
    <span class="c1"># Crear el boxplot con Plotly Graph Objects</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

    <span class="c1"># Agregar boxplots para cada mes</span>
    <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[</span><span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">month</span><span class="p">]</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">month</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">))</span>

    <span class="c1"># Agregar la línea de tendencia (media multianual)</span>
    <span class="n">trend_line</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">)[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    
    <span class="c1"># Ordenar los datos por el orden de los meses</span>
    <span class="n">ordered_months</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;january&#39;</span><span class="p">,</span> <span class="s1">&#39;february&#39;</span><span class="p">,</span> <span class="s1">&#39;march&#39;</span><span class="p">,</span> <span class="s1">&#39;april&#39;</span><span class="p">,</span> <span class="s1">&#39;may&#39;</span><span class="p">,</span> <span class="s1">&#39;june&#39;</span><span class="p">,</span> <span class="s1">&#39;july&#39;</span><span class="p">,</span> <span class="s1">&#39;august&#39;</span><span class="p">,</span> <span class="s1">&#39;september&#39;</span><span class="p">,</span> <span class="s1">&#39;october&#39;</span><span class="p">,</span> <span class="s1">&#39;november&#39;</span><span class="p">,</span> <span class="s1">&#39;december&#39;</span><span class="p">]</span>
    <span class="n">trend_line</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">trend_line</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">],</span> <span class="n">categories</span><span class="o">=</span><span class="n">ordered_months</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">trend_line</span> <span class="o">=</span> <span class="n">trend_line</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">trend_line</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">trend_line</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
                             <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">dash</span><span class="o">=</span><span class="s1">&#39;dash&#39;</span><span class="p">),</span>
                             <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Media Multianual&#39;</span><span class="p">))</span>

    <span class="c1"># Ajustar el diseño del gráfico</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">xaxis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Mes&#39;</span><span class="p">},</span> <span class="n">yaxis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Anomalía de Temperatura (°C)&#39;</span><span class="p">},</span>
                      <span class="n">boxmode</span><span class="o">=</span><span class="s1">&#39;group&#39;</span><span class="p">)</span>  <span class="c1"># Para agrupar los boxplots en el eje x</span>

    <span class="k">return</span> <span class="n">fig</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="s1">&#39;heatmap&#39;</span><span class="p">,</span> <span class="s1">&#39;figure&#39;</span><span class="p">),</span>
              <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s1">&#39;heatmap&#39;</span><span class="p">,</span> <span class="s1">&#39;hoverData&#39;</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">update_heatmap</span><span class="p">(</span><span class="n">hoverData</span><span class="p">):</span>
    <span class="c1"># Crear el mapa de calor con Plotly Graph Objects</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

    <span class="c1"># Añadir el mapa de calor</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">heatmap_data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">heatmap_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">heatmap_data</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                             <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Anomalía de Temperatura&#39;</span><span class="p">),</span> <span class="n">reversescale</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="c1"># Ajustar el diseño del gráfico</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">xaxis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Año&#39;</span><span class="p">},</span> <span class="n">yaxis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Mes&#39;</span><span class="p">,</span> <span class="s1">&#39;categoryorder&#39;</span><span class="p">:</span> <span class="s1">&#39;array&#39;</span><span class="p">,</span> <span class="s1">&#39;categoryarray&#39;</span><span class="p">:</span> <span class="n">month_order</span><span class="p">})</span>

    <span class="k">return</span> <span class="n">fig</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="s1">&#39;bar-chart&#39;</span><span class="p">,</span> <span class="s1">&#39;figure&#39;</span><span class="p">),</span>
              <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s1">&#39;bar-chart&#39;</span><span class="p">,</span> <span class="s1">&#39;hoverData&#39;</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">update_bar_chart</span><span class="p">(</span><span class="n">hoverData</span><span class="p">):</span>
    <span class="c1"># Calcular los promedios decenales</span>
    <span class="n">decade_means</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;decade&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;first&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

    <span class="c1"># Crear el gráfico de barras con Plotly Express</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">decade_means</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;decade&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;color&#39;</span><span class="p">,</span>
                 <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;Anomalía de Temperatura (°C)&#39;</span><span class="p">},</span> 
                 <span class="n">color_discrete_map</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;red&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">})</span>

    <span class="c1"># Modificar las etiquetas de los ticks en el eje x</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">tickmode</span><span class="o">=</span><span class="s1">&#39;array&#39;</span><span class="p">,</span>
            <span class="n">tickvals</span><span class="o">=</span><span class="n">decade_means</span><span class="p">[</span><span class="s1">&#39;decade&#39;</span><span class="p">],</span>
            <span class="n">ticktext</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">decade</span><span class="si">}</span><span class="s2">s&quot;</span> <span class="k">for</span> <span class="n">decade</span> <span class="ow">in</span> <span class="n">decade_means</span><span class="p">[</span><span class="s1">&#39;decade&#39;</span><span class="p">]]</span>
        <span class="p">),</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;temperature-graph&#39;</span><span class="p">,</span> <span class="s1">&#39;figure&#39;</span><span class="p">),</span>
    <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s1">&#39;year-picker&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)]</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">update_figure</span><span class="p">(</span><span class="n">selected_years</span><span class="p">):</span>
    <span class="n">traces</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">markers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;circle&#39;</span><span class="p">,</span> <span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="s1">&#39;diamond&#39;</span><span class="p">,</span> <span class="s1">&#39;cross&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">]</span>

    <span class="c1"># Añade las líneas para los años más cálidos</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">top_years</span><span class="p">):</span>
        <span class="n">df_year</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[</span><span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">year</span><span class="p">]</span>
        <span class="n">traces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">df_year</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">],</span>
            <span class="n">y</span><span class="o">=</span><span class="n">df_year</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines+markers&#39;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">),</span>
            <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">symbol</span><span class="o">=</span><span class="n">markers</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">markers</span><span class="p">)],</span>
                <span class="n">size</span><span class="o">=</span><span class="mi">10</span>
            <span class="p">)</span>
        <span class="p">))</span>

    <span class="c1"># Añade las líneas para los años seleccionados</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">selected_year</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">selected_years</span><span class="p">):</span>
        <span class="n">df_selected</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[</span><span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">selected_year</span><span class="p">]</span>
        <span class="n">traces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">df_selected</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">],</span>
            <span class="n">y</span><span class="o">=</span><span class="n">df_selected</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines+markers&#39;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">selected_year</span><span class="p">),</span>
            <span class="n">line</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
            <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">symbol</span><span class="o">=</span><span class="n">markers</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">top_years</span><span class="p">))</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">markers</span><span class="p">)],</span>
                <span class="n">size</span><span class="o">=</span><span class="mi">10</span>
            <span class="p">)</span>
        <span class="p">))</span>

    <span class="c1"># Añade la línea para los valores máximos</span>
    <span class="n">traces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">max_values</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Máximo histórico (1850 - 2022)&#39;</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;darkgrey&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">}</span>
    <span class="p">))</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">traces</span><span class="p">,</span>
        <span class="s1">&#39;layout&#39;</span><span class="p">:</span> <span class="n">go</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
            <span class="n">xaxis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Mes&#39;</span><span class="p">,</span> <span class="s1">&#39;tickvals&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">)),</span> <span class="s1">&#39;ticktext&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Enero&#39;</span><span class="p">,</span> <span class="s1">&#39;Febrero&#39;</span><span class="p">,</span> <span class="s1">&#39;Marzo&#39;</span><span class="p">,</span> <span class="s1">&#39;Abril&#39;</span><span class="p">,</span> <span class="s1">&#39;Mayo&#39;</span><span class="p">,</span> <span class="s1">&#39;Junio&#39;</span><span class="p">,</span> <span class="s1">&#39;Julio&#39;</span><span class="p">,</span> <span class="s1">&#39;Agosto&#39;</span><span class="p">,</span> <span class="s1">&#39;Septiembre&#39;</span><span class="p">,</span> <span class="s1">&#39;Octubre&#39;</span><span class="p">,</span> <span class="s1">&#39;Noviembre&#39;</span><span class="p">,</span> <span class="s1">&#39;Diciembre&#39;</span><span class="p">]},</span>
            <span class="n">yaxis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Anomalía de temperatura (°C)&#39;</span><span class="p">},</span>
            <span class="n">hovermode</span><span class="o">=</span><span class="s1">&#39;closest&#39;</span>
        <span class="p">)</span>
    <span class="p">}</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1">#app.run_server(debug=True) # &lt;- For testing purposes</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run_server</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">9000</span><span class="p">)</span> <span class="c1"># &lt;- To Dockerize the Dash</span>
    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">OSError</span><span class="g g-Whitespace">                                   </span>Traceback (most recent call last)
<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\site-packages\urllib3\connection.py:203,</span> in <span class="ni">HTTPConnection._new_conn</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">202</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">203</span>     <span class="n">sock</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">204</span>         <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dns_host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">205</span>         <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">206</span>         <span class="n">source_address</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">source_address</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">207</span>         <span class="n">socket_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">socket_options</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">208</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">209</span> <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">gaierror</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\site-packages\urllib3\util\connection.py:85,</span> in <span class="ni">create_connection</span><span class="nt">(address, timeout, source_address, socket_options)</span>
<span class="g g-Whitespace">     </span><span class="mi">84</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">85</span>     <span class="k">raise</span> <span class="n">err</span>
<span class="g g-Whitespace">     </span><span class="mi">86</span> <span class="k">finally</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">87</span>     <span class="c1"># Break explicitly a reference cycle</span>

<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\site-packages\urllib3\util\connection.py:73,</span> in <span class="ni">create_connection</span><span class="nt">(address, timeout, source_address, socket_options)</span>
<span class="g g-Whitespace">     </span><span class="mi">72</span>     <span class="n">sock</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">source_address</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">73</span> <span class="n">sock</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">sa</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">74</span> <span class="c1"># Break explicitly a reference cycle</span>

<span class="ne">OSError</span>: [WinError 10049] La dirección solicitada no es válida en este contexto

<span class="n">The</span> <span class="n">above</span> <span class="n">exception</span> <span class="n">was</span> <span class="n">the</span> <span class="n">direct</span> <span class="n">cause</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">exception</span><span class="p">:</span>

<span class="ne">NewConnectionError</span><span class="g g-Whitespace">                        </span>Traceback (most recent call last)
<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\site-packages\urllib3\connectionpool.py:791,</span> in <span class="ni">HTTPConnectionPool.urlopen</span><span class="nt">(self, method, url, body, headers, retries, redirect, assert_same_host, timeout, pool_timeout, release_conn, chunked, body_pos, preload_content, decode_content, **response_kw)</span>
<span class="g g-Whitespace">    </span><span class="mi">790</span> <span class="c1"># Make the request on the HTTPConnection object</span>
<span class="ne">--&gt; </span><span class="mi">791</span> <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_request</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">792</span>     <span class="n">conn</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">793</span>     <span class="n">method</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">794</span>     <span class="n">url</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">795</span>     <span class="n">timeout</span><span class="o">=</span><span class="n">timeout_obj</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">796</span>     <span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">797</span>     <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">798</span>     <span class="n">chunked</span><span class="o">=</span><span class="n">chunked</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">799</span>     <span class="n">retries</span><span class="o">=</span><span class="n">retries</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">800</span>     <span class="n">response_conn</span><span class="o">=</span><span class="n">response_conn</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">801</span>     <span class="n">preload_content</span><span class="o">=</span><span class="n">preload_content</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">802</span>     <span class="n">decode_content</span><span class="o">=</span><span class="n">decode_content</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">803</span>     <span class="o">**</span><span class="n">response_kw</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">804</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">806</span> <span class="c1"># Everything went great!</span>

<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\site-packages\urllib3\connectionpool.py:497,</span> in <span class="ni">HTTPConnectionPool._make_request</span><span class="nt">(self, conn, method, url, body, headers, retries, timeout, chunked, response_conn, preload_content, decode_content, enforce_content_length)</span>
<span class="g g-Whitespace">    </span><span class="mi">496</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">497</span>     <span class="n">conn</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">498</span>         <span class="n">method</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">499</span>         <span class="n">url</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">500</span>         <span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">501</span>         <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">502</span>         <span class="n">chunked</span><span class="o">=</span><span class="n">chunked</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">503</span>         <span class="n">preload_content</span><span class="o">=</span><span class="n">preload_content</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">504</span>         <span class="n">decode_content</span><span class="o">=</span><span class="n">decode_content</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">505</span>         <span class="n">enforce_content_length</span><span class="o">=</span><span class="n">enforce_content_length</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">506</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">508</span> <span class="c1"># We are swallowing BrokenPipeError (errno.EPIPE) since the server is</span>
<span class="g g-Whitespace">    </span><span class="mi">509</span> <span class="c1"># legitimately able to close the connection after sending a valid response.</span>
<span class="g g-Whitespace">    </span><span class="mi">510</span> <span class="c1"># With this behaviour, the received response is still readable.</span>

<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\site-packages\urllib3\connection.py:395,</span> in <span class="ni">HTTPConnection.request</span><span class="nt">(self, method, url, body, headers, chunked, preload_content, decode_content, enforce_content_length)</span>
<span class="g g-Whitespace">    </span><span class="mi">394</span>     <span class="bp">self</span><span class="o">.</span><span class="n">putheader</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">395</span> <span class="bp">self</span><span class="o">.</span><span class="n">endheaders</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">397</span> <span class="c1"># If we&#39;re given a body we start sending that in chunks.</span>

<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\http\client.py:1280,</span> in <span class="ni">HTTPConnection.endheaders</span><span class="nt">(self, message_body, encode_chunked)</span>
<span class="g g-Whitespace">   </span><span class="mi">1279</span>     <span class="k">raise</span> <span class="n">CannotSendHeader</span><span class="p">()</span>
<span class="ne">-&gt; </span><span class="mi">1280</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_output</span><span class="p">(</span><span class="n">message_body</span><span class="p">,</span> <span class="n">encode_chunked</span><span class="o">=</span><span class="n">encode_chunked</span><span class="p">)</span>

<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\http\client.py:1040,</span> in <span class="ni">HTTPConnection._send_output</span><span class="nt">(self, message_body, encode_chunked)</span>
<span class="g g-Whitespace">   </span><span class="mi">1039</span> <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="p">[:]</span>
<span class="ne">-&gt; </span><span class="mi">1040</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1042</span> <span class="k">if</span> <span class="n">message_body</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1043</span> 
<span class="g g-Whitespace">   </span><span class="mi">1044</span>     <span class="c1"># create a consistent interface to message_body</span>

<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\http\client.py:980,</span> in <span class="ni">HTTPConnection.send</span><span class="nt">(self, data)</span>
<span class="g g-Whitespace">    </span><span class="mi">979</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_open</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">980</span>     <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">981</span> <span class="k">else</span><span class="p">:</span>

<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\site-packages\urllib3\connection.py:243,</span> in <span class="ni">HTTPConnection.connect</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">242</span> <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">243</span>     <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_conn</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">244</span>     <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tunnel_host</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">245</span>         <span class="c1"># If we&#39;re tunneling it means we&#39;re connected to our proxy.</span>

<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\site-packages\urllib3\connection.py:218,</span> in <span class="ni">HTTPConnection._new_conn</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">217</span> <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">218</span>     <span class="k">raise</span> <span class="n">NewConnectionError</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">219</span>         <span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Failed to establish a new connection: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">220</span>     <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
<span class="g g-Whitespace">    </span><span class="mi">222</span> <span class="c1"># Audit hooks are only available in Python 3.8+</span>

<span class="ne">NewConnectionError</span>: &lt;urllib3.connection.HTTPConnection object at 0x000002188BDF9130&gt;: Failed to establish a new connection: [WinError 10049] La dirección solicitada no es válida en este contexto

<span class="n">The</span> <span class="n">above</span> <span class="n">exception</span> <span class="n">was</span> <span class="n">the</span> <span class="n">direct</span> <span class="n">cause</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">exception</span><span class="p">:</span>

<span class="ne">MaxRetryError</span><span class="g g-Whitespace">                             </span>Traceback (most recent call last)
<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\site-packages\requests\adapters.py:486,</span> in <span class="ni">HTTPAdapter.send</span><span class="nt">(self, request, stream, timeout, verify, cert, proxies)</span>
<span class="g g-Whitespace">    </span><span class="mi">485</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">486</span>     <span class="n">resp</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">487</span>         <span class="n">method</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">488</span>         <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">489</span>         <span class="n">body</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">490</span>         <span class="n">headers</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">491</span>         <span class="n">redirect</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">492</span>         <span class="n">assert_same_host</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">493</span>         <span class="n">preload_content</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">494</span>         <span class="n">decode_content</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">495</span>         <span class="n">retries</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">496</span>         <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">497</span>         <span class="n">chunked</span><span class="o">=</span><span class="n">chunked</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">498</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">500</span> <span class="k">except</span> <span class="p">(</span><span class="n">ProtocolError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>

<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\site-packages\urllib3\connectionpool.py:845,</span> in <span class="ni">HTTPConnectionPool.urlopen</span><span class="nt">(self, method, url, body, headers, retries, redirect, assert_same_host, timeout, pool_timeout, release_conn, chunked, body_pos, preload_content, decode_content, **response_kw)</span>
<span class="g g-Whitespace">    </span><span class="mi">843</span>     <span class="n">new_e</span> <span class="o">=</span> <span class="n">ProtocolError</span><span class="p">(</span><span class="s2">&quot;Connection aborted.&quot;</span><span class="p">,</span> <span class="n">new_e</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">845</span> <span class="n">retries</span> <span class="o">=</span> <span class="n">retries</span><span class="o">.</span><span class="n">increment</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">846</span>     <span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">new_e</span><span class="p">,</span> <span class="n">_pool</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">_stacktrace</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">847</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">848</span> <span class="n">retries</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>

<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\site-packages\urllib3\util\retry.py:515,</span> in <span class="ni">Retry.increment</span><span class="nt">(self, method, url, response, error, _pool, _stacktrace)</span>
<span class="g g-Whitespace">    </span><span class="mi">514</span>     <span class="n">reason</span> <span class="o">=</span> <span class="n">error</span> <span class="ow">or</span> <span class="n">ResponseError</span><span class="p">(</span><span class="n">cause</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">515</span>     <span class="k">raise</span> <span class="n">MaxRetryError</span><span class="p">(</span><span class="n">_pool</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">reason</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">reason</span>  <span class="c1"># type: ignore[arg-type]</span>
<span class="g g-Whitespace">    </span><span class="mi">517</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Incremented Retry for (url=&#39;</span><span class="si">%s</span><span class="s2">&#39;): </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">new_retry</span><span class="p">)</span>

<span class="ne">MaxRetryError</span>: HTTPConnectionPool(host=&#39;0.0.0.0&#39;, port=9000): Max retries exceeded with url: /_alive_9fac62bc-d431-4318-8d9a-f440f80d6a53 (Caused by NewConnectionError(&#39;&lt;urllib3.connection.HTTPConnection object at 0x000002188BDF9130&gt;: Failed to establish a new connection: [WinError 10049] La dirección solicitada no es válida en este contexto&#39;))

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="ne">ConnectionError</span><span class="g g-Whitespace">                           </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="n">line</span> <span class="mi">328</span>
<span class="g g-Whitespace">    </span><span class="mi">317</span>     <span class="k">return</span> <span class="p">{</span>
<span class="g g-Whitespace">    </span><span class="mi">318</span>         <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">traces</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">319</span>         <span class="s1">&#39;layout&#39;</span><span class="p">:</span> <span class="n">go</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">323</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">324</span>     <span class="p">}</span>
<span class="g g-Whitespace">    </span><span class="mi">326</span> <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">327</span>     <span class="c1">#app.run_server(debug=True) # &lt;- For testing purposes</span>
<span class="ne">--&gt; </span><span class="mi">328</span>     <span class="n">app</span><span class="o">.</span><span class="n">run_server</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">9000</span><span class="p">)</span> <span class="c1"># &lt;- To Dockerize the Dash</span>

<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\site-packages\dash\dash.py:2175,</span> in <span class="ni">Dash.run_server</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">2169</span> <span class="k">def</span> <span class="nf">run_server</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">2170</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;`run_server` is a deprecated alias of `run` and may be removed in a</span>
<span class="g g-Whitespace">   </span><span class="mi">2171</span><span class="sd">     future version. We recommend using `app.run` instead.</span>
<span class="g g-Whitespace">   </span><span class="mi">2172</span><span class="sd"> </span>
<span class="g g-Whitespace">   </span><span class="mi">2173</span><span class="sd">     See `app.run` for usage information.</span>
<span class="g g-Whitespace">   </span><span class="mi">2174</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">-&gt; </span><span class="mi">2175</span>     <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\site-packages\dash\dash.py:2066,</span> in <span class="ni">Dash.run</span><span class="nt">(self, host, port, proxy, debug, jupyter_mode, jupyter_width, jupyter_height, jupyter_server_url, dev_tools_ui, dev_tools_props_check, dev_tools_serve_dev_bundles, dev_tools_hot_reload, dev_tools_hot_reload_interval, dev_tools_hot_reload_watch_interval, dev_tools_hot_reload_max_retry, dev_tools_silence_routes_logging, dev_tools_prune_errors, **flask_run_options)</span>
<span class="g g-Whitespace">   </span><span class="mi">2063</span>             <span class="n">extra_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2065</span> <span class="k">if</span> <span class="n">jupyter_dash</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">2066</span>     <span class="n">jupyter_dash</span><span class="o">.</span><span class="n">run_app</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">2067</span>         <span class="bp">self</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2068</span>         <span class="n">mode</span><span class="o">=</span><span class="n">jupyter_mode</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2069</span>         <span class="n">width</span><span class="o">=</span><span class="n">jupyter_width</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2070</span>         <span class="n">height</span><span class="o">=</span><span class="n">jupyter_height</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2071</span>         <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2072</span>         <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2073</span>         <span class="n">server_url</span><span class="o">=</span><span class="n">jupyter_server_url</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2074</span>     <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2075</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2076</span>     <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span> <span class="o">**</span><span class="n">flask_run_options</span><span class="p">)</span>

<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\site-packages\dash\_jupyter.py:401,</span> in <span class="ni">JupyterDash.run_app</span><span class="nt">(self, app, mode, width, height, host, port, server_url)</span>
<span class="g g-Whitespace">    </span><span class="mi">399</span>     <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">400</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">401</span>     <span class="k">raise</span> <span class="n">final_error</span>

<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\site-packages\dash\_jupyter.py:388,</span> in <span class="ni">JupyterDash.run_app</span><span class="nt">(self, app, mode, width, height, host, port, server_url)</span>
<span class="g g-Whitespace">    </span><span class="mi">385</span>         <span class="k">raise</span> <span class="n">err</span>
<span class="g g-Whitespace">    </span><span class="mi">387</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">388</span>     <span class="n">wait_for_app</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">390</span>     <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_colab</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">391</span>         <span class="n">JupyterDash</span><span class="o">.</span><span class="n">_display_in_colab</span><span class="p">(</span><span class="n">dashboard_url</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>

<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\site-packages\retrying.py:56,</span> in <span class="ni">retry.&lt;locals&gt;.wrap.&lt;locals&gt;.wrapped_f</span><span class="nt">(*args, **kw)</span>
<span class="g g-Whitespace">     </span><span class="mi">54</span> <span class="nd">@six</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">55</span> <span class="k">def</span> <span class="nf">wrapped_f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">56</span>     <span class="k">return</span> <span class="n">Retrying</span><span class="p">(</span><span class="o">*</span><span class="n">dargs</span><span class="p">,</span> <span class="o">**</span><span class="n">dkw</span><span class="p">)</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\site-packages\retrying.py:266,</span> in <span class="ni">Retrying.call</span><span class="nt">(self, fn, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">263</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">attempt_number</span><span class="p">,</span> <span class="n">delay_since_first_attempt_ms</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">264</span>     <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_exception</span> <span class="ow">and</span> <span class="n">attempt</span><span class="o">.</span><span class="n">has_exception</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">265</span>         <span class="c1"># get() on an attempt with an exception should cause it to be raised, but raise just in case</span>
<span class="ne">--&gt; </span><span class="mi">266</span>         <span class="k">raise</span> <span class="n">attempt</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">267</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">268</span>         <span class="k">raise</span> <span class="n">RetryError</span><span class="p">(</span><span class="n">attempt</span><span class="p">)</span>

<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\site-packages\retrying.py:301,</span> in <span class="ni">Attempt.get</span><span class="nt">(self, wrap_exception)</span>
<span class="g g-Whitespace">    </span><span class="mi">299</span>         <span class="k">raise</span> <span class="n">RetryError</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">300</span>     <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">301</span>         <span class="n">six</span><span class="o">.</span><span class="n">reraise</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="g g-Whitespace">    </span><span class="mi">302</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">303</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\site-packages\six.py:719,</span> in <span class="ni">reraise</span><span class="nt">(tp, value, tb)</span>
<span class="g g-Whitespace">    </span><span class="mi">717</span>     <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">__traceback__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">tb</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">718</span>         <span class="k">raise</span> <span class="n">value</span><span class="o">.</span><span class="n">with_traceback</span><span class="p">(</span><span class="n">tb</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">719</span>     <span class="k">raise</span> <span class="n">value</span>
<span class="g g-Whitespace">    </span><span class="mi">720</span> <span class="k">finally</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">721</span>     <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>

<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\site-packages\retrying.py:251,</span> in <span class="ni">Retrying.call</span><span class="nt">(self, fn, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">248</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_before_attempts</span><span class="p">(</span><span class="n">attempt_number</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">250</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">251</span>     <span class="n">attempt</span> <span class="o">=</span> <span class="n">Attempt</span><span class="p">(</span><span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="n">attempt_number</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">252</span> <span class="k">except</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">253</span>     <span class="n">tb</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>

<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\site-packages\dash\_jupyter.py:385,</span> in <span class="ni">JupyterDash.run_app.&lt;locals&gt;.wait_for_app</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">383</span> <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">384</span>     <span class="n">_get_error</span><span class="p">()</span>
<span class="ne">--&gt; </span><span class="mi">385</span>     <span class="k">raise</span> <span class="n">err</span>

<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\site-packages\dash\_jupyter.py:372,</span> in <span class="ni">JupyterDash.run_app.&lt;locals&gt;.wait_for_app</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">370</span> <span class="n">_get_error</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">371</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">372</span>     <span class="n">req</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">alive_url</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">373</span>     <span class="n">res</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">374</span>     <span class="k">if</span> <span class="n">req</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>

<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\site-packages\requests\api.py:73,</span> in <span class="ni">get</span><span class="nt">(url, params, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">62</span> <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">63</span><span class="w">     </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Sends a GET request.</span>
<span class="g g-Whitespace">     </span><span class="mi">64</span><span class="sd"> </span>
<span class="g g-Whitespace">     </span><span class="mi">65</span><span class="sd">     :param url: URL for the new :class:`Request` object.</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span><span class="sd">     :rtype: requests.Response</span>
<span class="g g-Whitespace">     </span><span class="mi">71</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">---&gt; </span><span class="mi">73</span>     <span class="k">return</span> <span class="n">request</span><span class="p">(</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\site-packages\requests\api.py:59,</span> in <span class="ni">request</span><span class="nt">(method, url, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">55</span> <span class="c1"># By using the &#39;with&#39; statement we are sure the session is closed, thus we</span>
<span class="g g-Whitespace">     </span><span class="mi">56</span> <span class="c1"># avoid leaving sockets open which can trigger a ResourceWarning in some</span>
<span class="g g-Whitespace">     </span><span class="mi">57</span> <span class="c1"># cases, and look like a memory leak in others.</span>
<span class="g g-Whitespace">     </span><span class="mi">58</span> <span class="k">with</span> <span class="n">sessions</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">59</span>     <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\site-packages\requests\sessions.py:589,</span> in <span class="ni">Session.request</span><span class="nt">(self, method, url, params, data, headers, cookies, files, auth, timeout, allow_redirects, proxies, hooks, stream, verify, cert, json)</span>
<span class="g g-Whitespace">    </span><span class="mi">584</span> <span class="n">send_kwargs</span> <span class="o">=</span> <span class="p">{</span>
<span class="g g-Whitespace">    </span><span class="mi">585</span>     <span class="s2">&quot;timeout&quot;</span><span class="p">:</span> <span class="n">timeout</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">586</span>     <span class="s2">&quot;allow_redirects&quot;</span><span class="p">:</span> <span class="n">allow_redirects</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">587</span> <span class="p">}</span>
<span class="g g-Whitespace">    </span><span class="mi">588</span> <span class="n">send_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">589</span> <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">prep</span><span class="p">,</span> <span class="o">**</span><span class="n">send_kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">591</span> <span class="k">return</span> <span class="n">resp</span>

<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\site-packages\requests\sessions.py:703,</span> in <span class="ni">Session.send</span><span class="nt">(self, request, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">700</span> <span class="n">start</span> <span class="o">=</span> <span class="n">preferred_clock</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">702</span> <span class="c1"># Send the request</span>
<span class="ne">--&gt; </span><span class="mi">703</span> <span class="n">r</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">705</span> <span class="c1"># Total elapsed time of the request (approximately)</span>
<span class="g g-Whitespace">    </span><span class="mi">706</span> <span class="n">elapsed</span> <span class="o">=</span> <span class="n">preferred_clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\site-packages\requests\adapters.py:519,</span> in <span class="ni">HTTPAdapter.send</span><span class="nt">(self, request, stream, timeout, verify, cert, proxies)</span>
<span class="g g-Whitespace">    </span><span class="mi">515</span>     <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">reason</span><span class="p">,</span> <span class="n">_SSLError</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">516</span>         <span class="c1"># This branch is for urllib3 v1.22 and later.</span>
<span class="g g-Whitespace">    </span><span class="mi">517</span>         <span class="k">raise</span> <span class="n">SSLError</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">519</span>     <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">521</span> <span class="k">except</span> <span class="n">ClosedPoolError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">522</span>     <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>

<span class="ne">ConnectionError</span>: HTTPConnectionPool(host=&#39;0.0.0.0&#39;, port=9000): Max retries exceeded with url: /_alive_9fac62bc-d431-4318-8d9a-f440f80d6a53 (Caused by NewConnectionError(&#39;&lt;urllib3.connection.HTTPConnection object at 0x000002188BDF9130&gt;: Failed to establish a new connection: [WinError 10049] La dirección solicitada no es válida en este contexto&#39;))
</pre></div>
</div>
</div>
</div>
<p>Este código inicia de forma sencilla con el cargue de los datos.
Seguido, el código crea una función llamada calculate_rolling_mean que trabaja con los datos para calcular la media móvil y establecer límites de confianza. Luego, basándose en estos cálculos, la función añade nuevas características al conjunto de datos: una para representar la media de esos valores y dos más para mostrar un rango de valores que son más o menos estándar, todo esto usando la idea de “desviación estándar” y un número específico que indica cuánto extender esos límites (por defecto, 1.96). Al final, devuelve el conjunto de datos actualizado, ahora con estos números adicionales que muestran cómo los valores varían a lo largo del tiempo.</p>
<p>Luego, se realiza una transformación de los datos almacenados en el DataFrame df_tseries para generar un mapa de calor (heatmap_data). Esta transformación reorganiza los datos para representar los años en el eje horizontal (X) y los meses en el eje vertical (Y). Despues, crea una nueva columna llamada ‘decade’ que agrupa los años por década para un análisis más general. Además, introduce una columna llamada ‘color’, que asigna un color (‘rojo’ o ‘azul’) basado en la condición de anomalía de los valores. Posteriormente, se generan columnas adicionales para el año y el mes, lo que permite un fácil acceso y manipulación de estos datos temporales.</p>
<p>También se identifica los tres años más cálidos almacenándolos en la variable top_years. También encuentra los valores máximos de temperatura para cada mes, guardándolos en la variable max_values.</p>
<p>Seguido, se establece la estructura de la interfaz de usuario de una aplicación Dash, dividida en dos secciones: una barra de navegación y un área de contenido. La barra de navegación tiene enlaces para dirigirse a diferentes secciones de la aplicación. Dos funciones de callback se encargan de cambiar el contenido de la página según la URL seleccionada, mostrando gráficos y texto relevante. Además, se incluye información descriptiva sobre el conjunto de datos HadCRUT5 para contextualizar el análisis de la temperatura global. Este código permite una experiencia de usuario interactiva y dinámica.</p>
<p>Posteriormente, se presenta una función de callback diseñada para actualizar un gráfico en una aplicación Dash cuando se detecta un evento de “hover” (pasar el ratón por encima) en dicho gráfico. Al activarse el evento de “hoverData”, la función realiza varias acciones: primero, calcula la media móvil y los límites del intervalo de confianza utilizando la función calculate_rolling_mean. Luego, crea una lista llamada trace_data para almacenar los datos del gráfico, incluyendo la serie temporal original, la media móvil, y los límites superior e inferior del intervalo de confianza, cada uno representado por líneas de colores distintos. Además, cuando se pasa el ratón sobre el gráfico, la función identifica el año correspondiente al punto en el que está posicionado el ratón y marca la media de dicho año en el gráfico con un punto negro.</p>
<p>Siguiendo la misma linea, tenemos dos bloques de código que presentan funciones de callback. La primera función, update_boxplot, genera un gráfico de cajas (boxplot) utilizando Plotly Graph Objects. Esta función itera sobre cada mes en el conjunto de datos y agrega un boxplot correspondiente a cada mes, representando la distribución de las anomalías de temperatura en ese mes específico. Además, añade una línea de tendencia que muestra la media multianual de las anomalías de temperatura para cada mes. El diseño del gráfico se ajusta para mostrar en el eje x los meses y en el eje y las anomalías de temperatura en grados Celsius.</p>
<p>La segunda función, update_heatmap, crea un gráfico de mapa de calor con Plotly Graph Objects. Este mapa de calor representa las anomalías de temperatura a lo largo de los años y meses. Se utiliza un heatmap para visualizar las variaciones de temperatura a lo largo del tiempo. La función agrega el heatmap utilizando los datos ya preparados en la variable heatmap_data y ajusta el diseño del gráfico para mostrar los años en el eje x y los meses en el eje y, manteniendo el orden específico de los meses.</p>
<p>Los últimos bloques de código son : update_bar_chart, genera un gráfico de barras que muestra los promedios decenales de las anomalías de temperatura. Calcula estos promedios agrupando los datos por década y luego utiliza Plotly Express para crear el gráfico de barras, donde cada barra representa el promedio de temperatura de una década particular. Modifica las etiquetas en el eje x para mostrar décadas y colores que representan las tendencias de temperaturas más cálidas o más frías.</p>
<p>La segunda función, update_figure, actualiza un gráfico de líneas dinámico. Esta función utiliza los años seleccionados para representar las anomalías de temperatura a lo largo de los meses. Genera líneas para los años más cálidos, los años seleccionados y también agrega una línea que muestra los valores máximos históricos de anomalías de temperatura para cada mes. Ajusta el diseño del gráfico para mostrar los meses en el eje x y las anomalías de temperatura en grados Celsius en el eje y, permitiendo que el usuario explore las variaciones de temperatura a lo largo de los años.</p>
<p>La condición if <strong>name</strong> == ‘<strong>main</strong>’: permite ejecutar la aplicación Dash, ya sea en modo de depuración (debug=True) para pruebas o configurado para ser utilizado en un entorno Docker (host=’0.0.0.0’, port=9000). Estas funciones de callback son fundamentales para actualizar y renderizar gráficos dinámicos en función de la interacción del usuario en la aplicación Dash.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="modelo-predictivo">
<h1>Modelo predictivo<a class="headerlink" href="#modelo-predictivo" title="Permalink to this heading">#</a></h1>
<section id="arima">
<h2>ARIMA<a class="headerlink" href="#arima" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Para la construcción del modelo ARIMA, inicialmente utilizaremos una prueba estadística para verificar si la serie de tiempo es estacionaria o no. Esta prueba es la de Dickey-Fuller. Para hacer uso de esta prueba importamos la función adfuller de la clase statsmodels.tsa.stattools. Para aplicar el test pasamos los datos de la anomalía de temperatura, serie de tiempo de interés, usando df_tseries. Éste será el argumento de la función adfuller encargada de realizar el test de Dickey-Fuller. La hipótesis nula asume que los datos no son estacionarios. Esto implica que la media de los datos puede cambiar con el tiempo, lo que significa que la diferenciación podría ser un paso razonable para tratar de hacer que los datos sean estacionarios.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">timeseries_URL</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/SandraMaldonado19/Dash_PF_Dataviz/main/df_timeseries.csv&quot;</span>
<span class="n">df_tseries</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">timeseries_URL</span><span class="p">)</span>
<span class="n">df_tseries</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>month</th>
      <th>value</th>
      <th>date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1850</td>
      <td>january</td>
      <td>-0.675</td>
      <td>1850-01</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1850</td>
      <td>february</td>
      <td>-0.333</td>
      <td>1850-02</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1850</td>
      <td>march</td>
      <td>-0.591</td>
      <td>1850-03</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1850</td>
      <td>april</td>
      <td>-0.589</td>
      <td>1850-04</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1850</td>
      <td>may</td>
      <td>-0.508</td>
      <td>1850-05</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">adfuller</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ADF Statistic: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;p-value: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ADF Statistic: -0.094270
p-value: 0.950006
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Como el estadístico ADF, que es -0.0943, es mayor que los valores críticos de -2.5, -3.4 y -2.8 (correspondientes a los intervalos de confianza del 1%, 5% y 10%, respectivamente), se concluye que la hipótesis nula es aceptada. Esto sugiere que la serie de tiempo no es estacionaria. Del mismo modo,  el valor p de 0.95 &gt; 0.05, reforzando la conclusión de que la serie de tiempo no es estacionaria.</p></li>
</ul>
<ul class="simple">
<li><p>Ahora crearemos gráficos de autocorrelación para confirmar la estacionariedad de la serie temporal y determinar el orden de integración necesario para transformar nuestra serie temporal no estacionaria en estacionaria. Para ello, utilizaremos la función plot_acf de Python, que toma como argumentos la serie temporal de interés y el número de rezagos que deseamos considerar en el gráfico. Es importante tener en cuenta que utilizamos la función .diff() para diferenciar nuestras series temporales y eliminar las tendencias. Además, se elimina cualquier valor NaN que pueda surgir durante este proceso, ya que el gráfico consiste en representar gráficamente todos los valores definidos previamente, evitando cualquier denominador nulo. Crearemos tres gráficos: uno para la autocorrelación de la serie original, otro para la serie diferenciada de primer orden y otro para la serie diferenciada de segundo orden.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span><span class="o">,</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_acf</span><span class="p">,</span> <span class="n">plot_pacf</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">)})</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="p">);</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original Series&#39;</span><span class="p">)</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lags</span> <span class="o">=</span> <span class="mi">2080</span><span class="p">);</span>
<span class="c1">#plot_pacf(df_tseries.value, ax=axes[0, 2], lags = 1040);</span>


<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">diff</span><span class="p">());</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;1st Order Differencing&#39;</span><span class="p">)</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lags</span> <span class="o">=</span> <span class="mi">2080</span><span class="p">);</span>
<span class="c1">#plot_pacf(df_tseries.value, ax=axes[1, 2], lags = 1040);</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">());</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;2nd Order Differencing&#39;</span><span class="p">)</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lags</span> <span class="o">=</span> <span class="mi">2080</span><span class="p">);</span>
<span class="c1">#plot_pacf(df_tseries.value, ax=axes[2, 2], lags = 100);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8ad5a1f2783ac244224b0b512ce54a7ef857724e65e9a62e085d220557092e54.png" src="_images/8ad5a1f2783ac244224b0b512ce54a7ef857724e65e9a62e085d220557092e54.png" />
</div>
</div>
<ul class="simple">
<li><p>La primera figura de autocorrelación muestra un decaimiento geométrico en la parte positiva con una tendencia lineal, lo que indica no estacionariedad, como confirma la prueba de Dickey-Fuller. Los intervalos de confianza se muestran en forma de cono, fijados por defecto en el 95%. El gráfico de autocorrelación de la segunda diferenciación entra rápidamente en la zona negativa, lo que sugiere una posible sobrediferenciación.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Comprobación de estacionariedad con una diferenciación.</span>
<span class="n">df_dff</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
<span class="n">df_dff</span> <span class="o">=</span> <span class="n">df_dff</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span> 

<span class="n">result</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">df_dff</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ADF Statistic: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;p-value: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ADF Statistic: -15.697771
p-value: 0.000000
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Como el estadístico ADF, que es -15.7, es menor que los valores críticos de -2.5, -3.4 y -2.8 (correspondientes a los intervalos de confianza del 1%, 5% y 10%, respectivamente), se concluye que la hipótesis nula se rechaza. Esto sugiere que la serie de tiempo es estacionaria con una diferenciación. Del mismo modo,  el valor p de 0.000 &lt; 0.05, reforzando la conclusión de que la serie de tiempo es estacionaria.</p></li>
</ul>
<ul class="simple">
<li><p>Definimos ahora nuestro conjuntos de entrenamiento y testeo para el modelo ARIMA, en éste caso nuestro test corresponde a los últimos 21 meses, correspondientes a los 12 meses del 2022 y los 9 meses del 2023. El train corresponde a la serie de tiempo original menos estos 21 meses.  El mejor modelo será obtenido mediante uso de los datos de entrenamiento y el criterio de Akaike y de inferencia Bayesiana el cual penaliza la suma de los residuos al cuadrado por incluir parámetros adicionales en el modelo, los modelos que tienen valores pequeños del AIC o BIC se consideran buenos modelos.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_temp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="p">);</span> <span class="n">n_test</span> <span class="o">=</span> <span class="mi">21</span> 
<span class="n">train_size</span> <span class="o">=</span> <span class="n">n_temp</span> <span class="o">-</span> <span class="n">n_test</span>

<span class="n">train</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">dates_train</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">test_21month</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span> 
<span class="n">dates_21month</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span> 
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;train:&quot;</span><span class="p">,</span> <span class="n">train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;test_1w:&quot;</span><span class="p">,</span> <span class="n">test_21month</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>train: (2064,)
test_1w: (21,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[[</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">test_21month_df</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[[</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span> 
</pre></div>
</div>
</div>
</div>
<p>Utlizamos ahora el modelo ARIMA importado desde la librería statsmodels de Python para obetener distintos ARIMA de ordenes
. Consideramos method = ‘mle’ para el cálculo de la verosimilitud exacta a través del filtro de Kalman. Como ejercicio puede reescribir estas líneas de código en una función que dependa sólo del input train y retorne los ordenes
asociados al criterio AIC de bondad de ajuste</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dash</span>
<span class="kn">import</span> <span class="nn">dash_bootstrap_components</span> <span class="k">as</span> <span class="nn">dbc</span>
<span class="kn">from</span> <span class="nn">dash</span> <span class="kn">import</span> <span class="n">html</span><span class="p">,</span> <span class="n">dcc</span>
<span class="kn">from</span> <span class="nn">dash.dependencies</span> <span class="kn">import</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Output</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">adfuller</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objs</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">acf</span>
<span class="kn">from</span> <span class="nn">plotly.subplots</span> <span class="kn">import</span> <span class="n">make_subplots</span>


<span class="c1">#____ Cargue de datos___________________________________________________________________________________________________________</span>

<span class="n">timeseries_URL</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/SandraMaldonado19/Dash_PF_Dataviz/main/df_timeseries.csv&quot;</span>
<span class="n">df_tseries</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">timeseries_URL</span><span class="p">)</span>

<span class="c1">#____Cálculos y funciones________________________________________________________________________________________________________</span>

<span class="c1">#----Definimos el conjunto de prueba y de entrenamiento--------------------------------------------------------------------------</span>
<span class="n">n_temp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="p">);</span> <span class="n">n_test</span> <span class="o">=</span> <span class="mi">21</span> 
<span class="n">train_size</span> <span class="o">=</span> <span class="n">n_temp</span> <span class="o">-</span> <span class="n">n_test</span>

<span class="n">train</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">dates_train</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">test_21month</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span> 
<span class="n">dates_21month</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span> 

<span class="n">train_df</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[[</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">test_21month_df</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[[</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span> 


<span class="c1">#____ Configuramos la aplicación__________________________________________________________________________________________________</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">dash</span><span class="o">.</span><span class="n">Dash</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">external_stylesheets</span><span class="o">=</span><span class="p">[</span><span class="n">dbc</span><span class="o">.</span><span class="n">themes</span><span class="o">.</span><span class="n">BOOTSTRAP</span><span class="p">])</span>

<span class="n">app</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
    <span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="s1">&#39;Datos de entrenamiento&#39;</span><span class="p">),</span>
    <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;traindata-graph&#39;</span><span class="p">)</span>
<span class="p">])</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="s1">&#39;traindata-graph&#39;</span><span class="p">,</span> <span class="s1">&#39;figure&#39;</span><span class="p">),</span>
              <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s1">&#39;traindata-graph&#39;</span><span class="p">,</span> <span class="s1">&#39;hoverData&#39;</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">update_graph</span><span class="p">(</span><span class="n">hoverData</span><span class="p">):</span>
    <span class="n">trace_data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Agregar la serie de entrenamiento</span>
    <span class="n">trace_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">dates_train</span><span class="p">,</span>
        <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">train</span><span class="p">,</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;line&#39;</span><span class="p">,</span>
        <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;lines&#39;</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Entrenamiento&#39;</span><span class="p">,</span>
        <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;purple&#39;</span><span class="p">}</span>
    <span class="p">})</span>

    <span class="c1"># Agregar la serie de prueba</span>
    <span class="n">trace_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">dates_21month</span><span class="p">,</span>
        <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">test_21month</span><span class="p">,</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;line&#39;</span><span class="p">,</span>
        <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;lines&#39;</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Prueba&#39;</span><span class="p">,</span>
        <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;orange&#39;</span><span class="p">}</span>
    <span class="p">})</span>

    <span class="c1"># Marcar la media correspondiente al año cuando se pasa el ratón sobre la gráfica</span>
    <span class="k">if</span> <span class="n">hoverData</span><span class="p">:</span>
        <span class="n">year_hovered</span> <span class="o">=</span> <span class="n">hoverData</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">mean_value</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[</span><span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">year_hovered</span><span class="p">)][</span><span class="s1">&#39;rolling_mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">trace_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">hoverData</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mean_value</span><span class="p">],</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;scatter&#39;</span><span class="p">,</span>
            <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;markers&#39;</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Media </span><span class="si">{</span><span class="n">year_hovered</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
            <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Media </span><span class="si">{</span><span class="n">year_hovered</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="p">})</span>

    <span class="n">figure</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">trace_data</span><span class="p">,</span>
        <span class="s1">&#39;layout&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;xaxis&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Fecha&#39;</span><span class="p">},</span>
            <span class="s1">&#39;yaxis&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Anomalía de temperatura (°C)&#39;</span><span class="p">},</span>
            <span class="s1">&#39;margin&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">},</span>
            <span class="s1">&#39;legend&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">figure</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run_server</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Utilizaremos el modelo ARIMA importado desde la librería statsmodels de Python para obetener distintos ARIMA de ordenes
. Consideramos method = ‘mle’ para el cálculo de la verosimilitud exacta a través del filtro de Kalman. Como ejercicio puede reescribir estas líneas de código en una función que dependa sólo del input train y retorne los ordenes
asociados al criterio AIC de bondad de ajuste.</p></li>
</ul>
<ul class="simple">
<li><p>Este código es una aplicación de Dash que utiliza un modelo ARIMA para predecir la anomalía de temperatura. Primero, importa las bibliotecas necesarias y carga un conjunto de datos de series temporales desde una URL. Luego, divide los datos en conjuntos de entrenamiento y prueba. Después, selecciona el mejor modelo ARIMA basándose en el criterio de información de Akaike (AIC). Una vez seleccionado el modelo, se ajusta a los datos de entrenamiento y se utilizan las predicciones para generar un gráfico interactivo. Este gráfico muestra los datos de entrenamiento, las predicciones del modelo y los límites de confianza de las predicciones. Todo esto se presenta en una interfaz de usuario de Dash</p></li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dash</span>
<span class="kn">from</span> <span class="nn">dash</span> <span class="kn">import</span> <span class="n">html</span><span class="p">,</span> <span class="n">dcc</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objs</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.arima.model</span> <span class="kn">import</span> <span class="n">ARIMA</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>


<span class="c1">#____ Cargue de datos___________________________________________________________________________________________________________</span>

<span class="n">timeseries_URL</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/SandraMaldonado19/Dash_PF_Dataviz/main/df_timeseries.csv&quot;</span>
<span class="n">df_tseries</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">timeseries_URL</span><span class="p">)</span>

<span class="c1">#____Cálculos y funciones________________________________________________________________________________________________________</span>

<span class="c1">#----Definimos el conjunto de prueba y de entrenamiento--------------------------------------------------------------------------</span>
<span class="n">n_temp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="p">);</span> <span class="n">n_test</span> <span class="o">=</span> <span class="mi">21</span> 
<span class="n">train_size</span> <span class="o">=</span> <span class="n">n_temp</span> <span class="o">-</span> <span class="n">n_test</span>

<span class="n">train</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">dates_train</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">test_21month</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span> 
<span class="n">dates_21month</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span> 

<span class="n">train_df</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[[</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">test_21month_df</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[[</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span> 


<span class="c1">#----Función para seleccionar el mejor modelo------------------------------------------------------------------------------------</span>
<span class="n">best_aic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
<span class="n">best_bic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

<span class="n">best_order</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_mdl</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">pq_rng</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">d_rng</span>  <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pq_rng</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">d_rng</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">pq_rng</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># print(i, d, j)</span>
                <span class="n">tmp_mdl</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">j</span><span class="p">))</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
                <span class="n">tmp_aic</span> <span class="o">=</span> <span class="n">tmp_mdl</span><span class="o">.</span><span class="n">aic</span>
                <span class="k">if</span> <span class="n">tmp_aic</span> <span class="o">&lt;</span> <span class="n">best_aic</span><span class="p">:</span>
                    <span class="n">best_aic</span> <span class="o">=</span> <span class="n">tmp_aic</span>
                    <span class="n">best_order</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                    <span class="n">best_mdl</span> <span class="o">=</span> <span class="n">tmp_mdl</span>
            <span class="k">except</span><span class="p">:</span> <span class="k">continue</span>

<span class="c1">#----Ajustar el modelo ARIMA y obtener el pronóstico------------------------------------------------------------------------------</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">best_order</span><span class="p">)</span>
<span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">get_prediction</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">),</span> <span class="n">dynamic</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">pred_conf</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">conf_int</span><span class="p">()</span>

<span class="c1">#____ Configuramos la aplicación__________________________________________________________________________________________________</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">dash</span><span class="o">.</span><span class="n">Dash</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">app</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
    <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span>
        <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;graph&#39;</span><span class="p">,</span>
        <span class="n">figure</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">dates_train</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
                    <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Datos de entrenamiento&#39;</span>
                <span class="p">),</span>
                <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">dates_train</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">predictions</span><span class="p">,</span>
                    <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Predicciones&#39;</span>
                <span class="p">),</span>
               <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">dates_train</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">pred_conf</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Límite inferior del intervalo de confianza&#39;</span><span class="p">,</span>
                    <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;rgb(255,165,0)&#39;</span><span class="p">)</span>
                <span class="p">),</span>
                <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">dates_train</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">pred_conf</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
                    <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;tonexty&#39;</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Límite superior del intervalo de confianza&#39;</span><span class="p">,</span>
                    <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;rgb(255,165,0)&#39;</span><span class="p">)</span>
                <span class="p">)</span> 
            <span class="p">],</span>
            <span class="s1">&#39;layout&#39;</span><span class="p">:</span> <span class="n">go</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Rendimiento del modelo&#39;</span><span class="p">,</span>
                <span class="n">xaxis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Año&#39;</span><span class="p">},</span>
                <span class="n">yaxis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Anomalía de temperatura (°C)&#39;</span><span class="p">},</span>
                <span class="n">autosize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">width</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span>
                <span class="n">height</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">}</span>
    <span class="p">)</span>
<span class="p">])</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run_server</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Para medir el error de predicción cometido en las predicciones, utilizaremos las métricas usuales en análisis de series de tiempo: MAPE, MAE, RMSE, MSE</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">forecast_accuracy</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span> <span class="n">str_name</span><span class="p">):</span>
    
    <span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">actual</span><span class="p">))</span> <span class="c1"># MAPE</span>
    <span class="n">mae</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">))</span>                 <span class="c1"># MAE</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">.5</span>               <span class="c1"># RMSE</span>
    <span class="n">mse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>                    <span class="c1"># MSE</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">actual</span><span class="p">)</span>
    
    <span class="n">df_acc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mae</span><span class="p">],</span>
                           <span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mse</span><span class="p">],</span>
                           <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mape</span><span class="p">],</span>
                           <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmse</span><span class="p">],</span>
                           <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">r2</span><span class="p">]},</span>
                          <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">str_name</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">df_acc</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Realizamos ahora predicciones utlilizando rolling forecasting. El rolling forecast entrega reportes que utilizan datos históricos para predecir cifras futuras de forma continua durante un periodo de tiempo. Las previsiones continuas se utilizan a menudo en los reportes financieros, la gestión de la cadena de suministro, la planificación y la elaboración de presupuestos. El rolling forecast es una ayuda esencial para tomar decisiones empresariales acertadas. Gracias a su capacidad de respuesta, las previsiones continuas ayudan a las empresas a responder más rápidamente a las condiciones cambiantes del mercado. Si se utilizan con eficacia, las previsiones continuas pueden ayudar a identificar las deficiencias de rendimiento, acortar los ciclos de planificación y tomar la mejor decisión para los resultados. Para nuestros ejemplos, nuestro horizonte de predicción será de un día</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">arima_rolling</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">test</span><span class="p">):</span>
    
    <span class="n">predictions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">best_order</span><span class="p">)</span>
        <span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">()</span>
        <span class="n">yhat</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yhat</span><span class="p">)</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;predicted=</span><span class="si">%f</span><span class="s1">, expected=</span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">yhat</span><span class="p">,</span> <span class="n">obs</span><span class="p">))</span>
        
    <span class="k">return</span> <span class="n">predictions</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_1wl</span> <span class="o">=</span> <span class="n">test_1w</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">yhat_1w</span>  <span class="o">=</span> <span class="n">arima_rolling</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">test_1wl</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Utilizaremos ahora las funciónes creadas anteriormente para calcular el error de predicción y linpeplot para graficarle junto a la serie de tiempo orginal de test</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">test_1wl</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yhat_1w</span><span class="p">),</span> <span class="s2">&quot;week 1&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dates_train</span><span class="p">[</span><span class="o">-</span><span class="mi">120</span><span class="p">:],</span> <span class="n">y</span><span class="o">=</span><span class="n">train</span><span class="p">[</span><span class="o">-</span><span class="mi">120</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Train&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dates_1w</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">test_1wl</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dates_1w</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">yhat_1w</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Forecast&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">freq</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">xtix</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xtix</span><span class="p">[::</span><span class="n">freq</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">50</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Análisis de Anomlaías de Temperatura en la Superficie Global</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Dash Anomalías de temperatura</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#manejo-de-la-base-de-datos">Manejo de la base de datos</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#construccion-del-dash">Construcción del dash</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-predictivo">Modelo predictivo</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#arima">ARIMA</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Sandra Maldonado - Sherine Menco
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>