

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Dash Anomalías de temperatura &#8212; Análisis de Anomalía de Temperatura de la Superficie Global</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=365ca57ee442770a23c6"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'timeseries';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Análisis de Anomlaías de Temperatura en la Superficie Global" href="intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/Logouninorte.png" class="logo__image only-light" alt="Análisis de Anomalía de Temperatura de la Superficie Global - Home"/>
    <script>document.write(`<img src="_static/Logouninorte.png" class="logo__image only-dark" alt="Análisis de Anomalía de Temperatura de la Superficie Global - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Análisis de Anomlaías de Temperatura en la Superficie Global
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Dash Anomalías de temperatura</a></li>





</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/SandraMaldonado19/Dataviz_pf.git" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/SandraMaldonado19/Dataviz_pf.git/issues/new?title=Issue%20on%20page%20%2Ftimeseries.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/timeseries.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Dash Anomalías de temperatura</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Dash Anomalías de temperatura</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#manejo-de-la-base-de-datos">Manejo de la base de datos</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#construccion-del-dash">Construcción del dash</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#media-movil-de-12-meses">Media móvil de 12 meses</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#media-mensual-multianual-y-distribucion-de-datos-boxplot">Media mensual multianual y distribución de datos: Boxplot</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#anomalias-mensual-anual-mapa-de-calor">Anomalías mensual-anual: mapa de calor</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#promedio-decenal">Promedio decenal</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#este-ano-hasta-ahora">Este año hasta ahora</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#verificacion-de-la-estacionariedad-de-la-serie">Verificación de la estacionariedad de la serie</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelos-predictivos">Modelos predictivos</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-arima">Modelo ARIMA</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#suavizacion-exponencial">Suavización exponencial</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#regresion-polinomica">Regresión polinómica</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#codigo-unificado">Código unificado</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="dash-anomalias-de-temperatura">
<h1>Dash Anomalías de temperatura<a class="headerlink" href="#dash-anomalias-de-temperatura" title="Permalink to this heading">#</a></h1>
<p>La apliclación desplegada tiene como objetivo de visualización los cambios de temperatura cercana a la superficie en todo el mundo, entre 1850 a 2018. El archivo presenta anomalías mensuales promedio de temperatura cercana a la superficie, en relación con el período 1961–1990.</p>
<p>En general, este conjunto de datos muestra un aumento del calentamiento promedio global desde mediados del siglo 19 y en los últimos años, en consonancia con otros análisis. Este fenómeno se debe a múltiples factores, incluidos una mejor representación del calentamiento del Ártico y una mejor comprensión de los sesgos en evolución en las mediciones sobre la superficie del mar y la tierra. Para revisar a detalle el proceso de obtención y procesamiento de los datos, visite la información de referencia al final de este documento.</p>
<p>El presente informe se encuentra estructurado por secciones, siguiendo el orden de construcción de la aplicación, explicando a detalle las herramientas utilizadas. Inicia con el procesamiento de la base de datos, continúa con el análisis exploratorio de datos y finaliza con el desarrollo de 3 modelos de pronósticos para la serie de Anomalías de Temperatura. Al final de este reporte se encuentra el código completo de la aplicación Dash.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importanción de librerías</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">mktime</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pickle</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Temas para las figuras</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="s2">&quot;paper&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="manejo-de-la-base-de-datos">
<h2>Manejo de la base de datos<a class="headerlink" href="#manejo-de-la-base-de-datos" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Previo a la construcción de la aplicación, es necesario procesar la base de datos. En este caso, utilizamos la librería pandas para leer los datos y configurar la estructura para que esté acorde con el formato de series de tiempo.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Leer los datos</span>

<span class="n">df_temperature</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./data/originaldata_temp.csv&#39;</span><span class="p">)</span>
<span class="n">df_temperature</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Leer los datos</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">df_temperature</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./data/originaldata_temp.csv&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">df_temperature</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\site-packages\pandas\io\parsers\readers.py:948,</span> in <span class="ni">read_csv</span><span class="nt">(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, date_format, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, encoding_errors, dialect, on_bad_lines, delim_whitespace, low_memory, memory_map, float_precision, storage_options, dtype_backend)</span>
<span class="g g-Whitespace">    </span><span class="mi">935</span> <span class="n">kwds_defaults</span> <span class="o">=</span> <span class="n">_refine_defaults_read</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">936</span>     <span class="n">dialect</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">937</span>     <span class="n">delimiter</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">944</span>     <span class="n">dtype_backend</span><span class="o">=</span><span class="n">dtype_backend</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">945</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">946</span> <span class="n">kwds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds_defaults</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">948</span> <span class="k">return</span> <span class="n">_read</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>

<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\site-packages\pandas\io\parsers\readers.py:611,</span> in <span class="ni">_read</span><span class="nt">(filepath_or_buffer, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">608</span> <span class="n">_validate_names</span><span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;names&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">610</span> <span class="c1"># Create the parser.</span>
<span class="ne">--&gt; </span><span class="mi">611</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">TextFileReader</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">613</span> <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">or</span> <span class="n">iterator</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">614</span>     <span class="k">return</span> <span class="n">parser</span>

<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\site-packages\pandas\io\parsers\readers.py:1448,</span> in <span class="ni">TextFileReader.__init__</span><span class="nt">(self, f, engine, **kwds)</span>
<span class="g g-Whitespace">   </span><span class="mi">1445</span>     <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">1447</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">:</span> <span class="n">IOHandles</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="ne">-&gt; </span><span class="mi">1448</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_engine</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>

<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\site-packages\pandas\io\parsers\readers.py:1705,</span> in <span class="ni">TextFileReader._make_engine</span><span class="nt">(self, f, engine)</span>
<span class="g g-Whitespace">   </span><span class="mi">1703</span>     <span class="k">if</span> <span class="s2">&quot;b&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1704</span>         <span class="n">mode</span> <span class="o">+=</span> <span class="s2">&quot;b&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1705</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="o">=</span> <span class="n">get_handle</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1706</span>     <span class="n">f</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1707</span>     <span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1708</span>     <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1709</span>     <span class="n">compression</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;compression&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1710</span>     <span class="n">memory_map</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_map&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1711</span>     <span class="n">is_text</span><span class="o">=</span><span class="n">is_text</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1712</span>     <span class="n">errors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding_errors&quot;</span><span class="p">,</span> <span class="s2">&quot;strict&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1713</span>     <span class="n">storage_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;storage_options&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1714</span> <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1715</span> <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">   </span><span class="mi">1716</span> <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="o">.</span><span class="n">handle</span>

<span class="nn">File c:\Users\Sandra\anaconda3\envs\dataviz_venv\lib\site-packages\pandas\io\common.py:863,</span> in <span class="ni">get_handle</span><span class="nt">(path_or_buf, mode, encoding, compression, memory_map, is_text, errors, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">858</span> <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">859</span>     <span class="c1"># Check whether the filename is to be opened in binary mode.</span>
<span class="g g-Whitespace">    </span><span class="mi">860</span>     <span class="c1"># Binary mode does not support &#39;encoding&#39; and &#39;newline&#39;.</span>
<span class="g g-Whitespace">    </span><span class="mi">861</span>     <span class="k">if</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span> <span class="ow">and</span> <span class="s2">&quot;b&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">862</span>         <span class="c1"># Encoding</span>
<span class="ne">--&gt; </span><span class="mi">863</span>         <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">864</span>             <span class="n">handle</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">865</span>             <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">866</span>             <span class="n">encoding</span><span class="o">=</span><span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">867</span>             <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">868</span>             <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">869</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">870</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">871</span>         <span class="c1"># Binary mode</span>
<span class="g g-Whitespace">    </span><span class="mi">872</span>         <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;./data/originaldata_temp.csv&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Eliminar columna vacía</span>

<span class="n">df_temperature</span> <span class="o">=</span> <span class="n">df_temperature</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">df_temperature</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">df_temperature</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Unnamed&#39;</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df_temperature</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>january</th>
      <th>february</th>
      <th>march</th>
      <th>april</th>
      <th>may</th>
      <th>june</th>
      <th>july</th>
      <th>august</th>
      <th>september</th>
      <th>october</th>
      <th>november</th>
      <th>december</th>
      <th>yearmean</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1850</td>
      <td>-0.675</td>
      <td>-0.333</td>
      <td>-0.591</td>
      <td>-0.589</td>
      <td>-0.508</td>
      <td>-0.344</td>
      <td>-0.160</td>
      <td>-0.208</td>
      <td>-0.385</td>
      <td>-0.533</td>
      <td>-0.283</td>
      <td>-0.404</td>
      <td>-0.418</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1850</td>
      <td>53.000</td>
      <td>47.000</td>
      <td>44.000</td>
      <td>48.000</td>
      <td>49.000</td>
      <td>49.000</td>
      <td>52.000</td>
      <td>55.000</td>
      <td>57.000</td>
      <td>55.000</td>
      <td>58.000</td>
      <td>58.000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1851</td>
      <td>-0.201</td>
      <td>-0.469</td>
      <td>-0.646</td>
      <td>-0.542</td>
      <td>-0.198</td>
      <td>-0.137</td>
      <td>-0.097</td>
      <td>-0.102</td>
      <td>-0.091</td>
      <td>-0.008</td>
      <td>-0.082</td>
      <td>-0.228</td>
      <td>-0.233</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1851</td>
      <td>58.000</td>
      <td>55.000</td>
      <td>56.000</td>
      <td>55.000</td>
      <td>54.000</td>
      <td>53.000</td>
      <td>54.000</td>
      <td>59.000</td>
      <td>47.000</td>
      <td>51.000</td>
      <td>48.000</td>
      <td>48.000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1852</td>
      <td>-0.375</td>
      <td>-0.477</td>
      <td>-0.560</td>
      <td>-0.585</td>
      <td>-0.127</td>
      <td>-0.084</td>
      <td>0.005</td>
      <td>-0.136</td>
      <td>-0.002</td>
      <td>-0.172</td>
      <td>-0.305</td>
      <td>0.065</td>
      <td>-0.229</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Eliminar filas intermedias</span>
<span class="n">df_temperature</span> <span class="o">=</span> <span class="n">df_temperature</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">df_temperature</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_temperature</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>january</th>
      <th>february</th>
      <th>march</th>
      <th>april</th>
      <th>may</th>
      <th>june</th>
      <th>july</th>
      <th>august</th>
      <th>september</th>
      <th>october</th>
      <th>november</th>
      <th>december</th>
      <th>yearmean</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1850</td>
      <td>-0.675</td>
      <td>-0.333</td>
      <td>-0.591</td>
      <td>-0.589</td>
      <td>-0.508</td>
      <td>-0.344</td>
      <td>-0.160</td>
      <td>-0.208</td>
      <td>-0.385</td>
      <td>-0.533</td>
      <td>-0.283</td>
      <td>-0.404</td>
      <td>-0.418</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1851</td>
      <td>-0.201</td>
      <td>-0.469</td>
      <td>-0.646</td>
      <td>-0.542</td>
      <td>-0.198</td>
      <td>-0.137</td>
      <td>-0.097</td>
      <td>-0.102</td>
      <td>-0.091</td>
      <td>-0.008</td>
      <td>-0.082</td>
      <td>-0.228</td>
      <td>-0.233</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1852</td>
      <td>-0.375</td>
      <td>-0.477</td>
      <td>-0.560</td>
      <td>-0.585</td>
      <td>-0.127</td>
      <td>-0.084</td>
      <td>0.005</td>
      <td>-0.136</td>
      <td>-0.002</td>
      <td>-0.172</td>
      <td>-0.305</td>
      <td>0.065</td>
      <td>-0.229</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1853</td>
      <td>-0.233</td>
      <td>-0.404</td>
      <td>-0.280</td>
      <td>-0.386</td>
      <td>-0.268</td>
      <td>-0.142</td>
      <td>-0.083</td>
      <td>-0.057</td>
      <td>-0.250</td>
      <td>-0.392</td>
      <td>-0.411</td>
      <td>-0.337</td>
      <td>-0.270</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1854</td>
      <td>-0.381</td>
      <td>-0.361</td>
      <td>-0.243</td>
      <td>-0.334</td>
      <td>-0.291</td>
      <td>-0.299</td>
      <td>-0.179</td>
      <td>-0.239</td>
      <td>-0.217</td>
      <td>-0.095</td>
      <td>-0.410</td>
      <td>-0.450</td>
      <td>-0.292</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Aquí colocamos los meses que se encuentra en las filas como variables independientes en una sola columna, con su respectivo valor de anomalía, usando la función melt.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convertir a formato de serie de tiempo</span>
<span class="n">df_timeseries</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">df_temperature</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">])</span>

<span class="c1"># Eliminar filas donde la columna &#39;variable&#39; sea igual a &#39;yearmean&#39;</span>
<span class="n">df_timeseries</span> <span class="o">=</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;yearmean&#39;</span><span class="p">]</span>

<span class="c1"># Cambiar el nombre de la columna &#39;variable&#39; a &#39;month&#39;</span>
<span class="n">df_timeseries</span> <span class="o">=</span> <span class="n">df_timeseries</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;variable&#39;</span><span class="p">:</span><span class="s1">&#39;month&#39;</span><span class="p">})</span>

<span class="n">df_timeseries</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>month</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1850</td>
      <td>january</td>
      <td>-0.675</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1851</td>
      <td>january</td>
      <td>-0.201</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1852</td>
      <td>january</td>
      <td>-0.375</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1853</td>
      <td>january</td>
      <td>-0.233</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1854</td>
      <td>january</td>
      <td>-0.381</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Crear la nueva columna de fecha en formato %Y-%m</span>
<span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%B&#39;</span><span class="p">)</span>

<span class="c1"># Formatear la fecha para que solo muestre mes y año</span>
<span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m&#39;</span><span class="p">)</span>
<span class="n">df_timeseries</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>month</th>
      <th>value</th>
      <th>date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1850</td>
      <td>january</td>
      <td>-0.675</td>
      <td>1850-01</td>
    </tr>
    <tr>
      <th>174</th>
      <td>1850</td>
      <td>february</td>
      <td>-0.333</td>
      <td>1850-02</td>
    </tr>
    <tr>
      <th>348</th>
      <td>1850</td>
      <td>march</td>
      <td>-0.591</td>
      <td>1850-03</td>
    </tr>
    <tr>
      <th>522</th>
      <td>1850</td>
      <td>april</td>
      <td>-0.589</td>
      <td>1850-04</td>
    </tr>
    <tr>
      <th>696</th>
      <td>1850</td>
      <td>may</td>
      <td>-0.508</td>
      <td>1850-05</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>869</th>
      <td>2023</td>
      <td>may</td>
      <td>0.871</td>
      <td>2023-05</td>
    </tr>
    <tr>
      <th>1043</th>
      <td>2023</td>
      <td>june</td>
      <td>1.052</td>
      <td>2023-06</td>
    </tr>
    <tr>
      <th>1217</th>
      <td>2023</td>
      <td>july</td>
      <td>1.150</td>
      <td>2023-07</td>
    </tr>
    <tr>
      <th>1391</th>
      <td>2023</td>
      <td>august</td>
      <td>1.199</td>
      <td>2023-08</td>
    </tr>
    <tr>
      <th>1565</th>
      <td>2023</td>
      <td>september</td>
      <td>1.347</td>
      <td>2023-09</td>
    </tr>
  </tbody>
</table>
<p>2085 rows × 4 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_timeseries</span> <span class="o">=</span> <span class="n">df_timeseries</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>

<span class="c1"># Eliminar las últimas tres filas</span>
<span class="n">df_timeseries</span> <span class="o">=</span> <span class="n">df_timeseries</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
<span class="n">df_timeseries</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>month</th>
      <th>value</th>
      <th>date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1850</td>
      <td>january</td>
      <td>-0.675</td>
      <td>1850-01</td>
    </tr>
    <tr>
      <th>174</th>
      <td>1850</td>
      <td>february</td>
      <td>-0.333</td>
      <td>1850-02</td>
    </tr>
    <tr>
      <th>348</th>
      <td>1850</td>
      <td>march</td>
      <td>-0.591</td>
      <td>1850-03</td>
    </tr>
    <tr>
      <th>522</th>
      <td>1850</td>
      <td>april</td>
      <td>-0.589</td>
      <td>1850-04</td>
    </tr>
    <tr>
      <th>696</th>
      <td>1850</td>
      <td>may</td>
      <td>-0.508</td>
      <td>1850-05</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>869</th>
      <td>2023</td>
      <td>may</td>
      <td>0.871</td>
      <td>2023-05</td>
    </tr>
    <tr>
      <th>1043</th>
      <td>2023</td>
      <td>june</td>
      <td>1.052</td>
      <td>2023-06</td>
    </tr>
    <tr>
      <th>1217</th>
      <td>2023</td>
      <td>july</td>
      <td>1.150</td>
      <td>2023-07</td>
    </tr>
    <tr>
      <th>1391</th>
      <td>2023</td>
      <td>august</td>
      <td>1.199</td>
      <td>2023-08</td>
    </tr>
    <tr>
      <th>1565</th>
      <td>2023</td>
      <td>september</td>
      <td>1.347</td>
      <td>2023-09</td>
    </tr>
  </tbody>
</table>
<p>2085 rows × 4 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_timeseries</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;df_timeseries.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="construccion-del-dash">
<h1>Construcción del dash<a class="headerlink" href="#construccion-del-dash" title="Permalink to this heading">#</a></h1>
<ul class="simple">
<li><p>El dashboard está dividido en dos secciones principales: la sección de <strong>navegación</strong> a la izquierda y la sección de <strong>contenido</strong> a la derecha.</p></li>
<li><p><strong>Sección de navegación:</strong>
Esta sección, ubicada a la izquierda, contiene tres botones interactivos que permiten cambiar la visualización de la información en la sección de contenido. Los botones están diseñados con una tipografía clara y legible, como Arial o Helvetica, y están espaciados uniformemente para facilitar la navegación. Cada botón tiene un título descriptivo correspondiente a su función: “Incio”, “Análisis exploratorio de datos (EDA)” y “Modelos predictivos”.</p></li>
<li><p><strong>Sección de contenido:</strong>
Esta sección, ubicada a la derecha, muestra la información correspondiente al botón seleccionado en la sección de navegación.</p>
<ol class="arabic simple">
<li><p><strong>Inicio:</strong> Esta ventana proporciona una visión general del conjunto de datos, proporcionando su información de acceso.</p></li>
<li><p><strong>Serie de tiempo (EDA):</strong> Esta ventana presenta un análisis de los datos. Incluye gráficos de la serie de tiempo en diversas escalas temporales (mensual, anual, decenal), gráficos de línea, gráficos de caja y bigotes, mapas de calor, proporcionando información sobre patrones y tendencias de la variable objetivo (Anomalía de temperatura (°C)) de forma interactiva. Asimismo, se explora la estacionariedad de la serie, información base para la construcción de modelos predictivos.</p></li>
<li><p><strong>Modelos predictivos:</strong> Aquí presenta los resultados de tres modelos predictivos: ARIMA, suavización exponencial y regresión polinómica. Cada modelo se presenta en un gráfico separado que muestra los datos históricos y las predicciones del modelo. También se proporcionan medidas de precisión del modelo, como el error cuadrático medio (MSE) y el coeficiente de determinación (R^2).</p></li>
</ol>
</li>
<li><p>El primer paso para la construcción del dash fue la creación de la plantilla de trabajo separando el dash en dos secciones principales: navegación y contenido:</p></li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dash</span>
<span class="kn">from</span> <span class="nn">dash</span> <span class="kn">import</span> <span class="n">dcc</span>
<span class="kn">from</span> <span class="nn">dash</span> <span class="kn">import</span> <span class="n">html</span>
<span class="kn">from</span> <span class="nn">dash.dependencies</span> <span class="kn">import</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Output</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="n">timeseries_URL</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/SandraMaldonado19/Dash_PF_Dataviz/main/df_timeseries.csv&quot;</span>
<span class="n">df_tseries</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">timeseries_URL</span><span class="p">)</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">dash</span><span class="o">.</span><span class="n">Dash</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">suppress_callback_exceptions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="n">app</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
    <span class="n">dcc</span><span class="o">.</span><span class="n">Location</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">html</span><span class="o">.</span><span class="n">Main</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;display&#39;</span><span class="p">:</span><span class="s1">&#39;grid&#39;</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">:</span><span class="s1">&#39;100%&#39;</span><span class="p">,</span><span class="s1">&#39;minHeight&#39;</span><span class="p">:</span><span class="s1">&#39;100vh&#39;</span><span class="p">,</span><span class="s1">&#39;gridTemplateColumns&#39;</span><span class="p">:</span> <span class="s1">&#39;50vh 1fr&#39;</span><span class="p">,</span> <span class="s1">&#39;gridTemplateRows&#39;</span><span class="p">:</span> <span class="s1">&#39;50px 1fr 30px&#39;</span><span class="p">,</span> <span class="p">},</span> <span class="n">children</span><span class="o">=</span><span class="p">[</span>
       
        <span class="n">html</span><span class="o">.</span><span class="n">Nav</span><span class="p">(</span><span class="n">className</span><span class="o">=</span><span class="s1">&#39;nav&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;display&#39;</span><span class="p">:</span><span class="s1">&#39;fixed&#39;</span><span class="p">,</span><span class="s1">&#39;gridArea&#39;</span><span class="p">:</span><span class="s1">&#39;nav&#39;</span><span class="p">,</span> <span class="s1">&#39;gridColumnStart&#39;</span><span class="p">:</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;gridColumnEnd&#39;</span><span class="p">:</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;gridRowStart&#39;</span><span class="p">:</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;gridRowEnd&#39;</span><span class="p">:</span><span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="s1">&#39;border&#39;</span><span class="p">:</span><span class="s1">&#39;1px solid #cbc4ad&#39;</span><span class="p">,</span> <span class="s1">&#39;borderRadius&#39;</span><span class="p">:</span><span class="s1">&#39;5px&#39;</span><span class="p">,</span> <span class="s1">&#39;padding&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">},</span> <span class="n">children</span><span class="o">=</span><span class="p">[</span>
            <span class="n">html</span><span class="o">.</span><span class="n">H1</span><span class="p">(</span><span class="s1">&#39;Anomalia de Temperatura de Superficie Global&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;marginBottom&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span> <span class="s1">&#39;fontSize&#39;</span><span class="p">:</span><span class="s1">&#39;1.5rem&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span><span class="s1">&#39;center&#39;</span><span class="p">}),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="s1">&#39;¿Cuáles han sido las variaciones más significativas de la temperatura de la superficie global a lo largo del tiempo?&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;marginBottom&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span> <span class="s1">&#39;fontSize&#39;</span><span class="p">:</span><span class="s1">&#39;1rem&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span><span class="s1">&#39;left&#39;</span><span class="p">}),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">H3</span><span class="p">(</span><span class="s1">&#39;¿Aumentará la temperatura los próximos meses?&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#de3100&#39;</span><span class="p">,</span> <span class="s1">&#39;marginBottom&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span> <span class="s1">&#39;fontSize&#39;</span><span class="p">:</span><span class="s1">&#39;1rem&#39;</span><span class="p">,</span><span class="s1">&#39;fontWeight&#39;</span><span class="p">:</span><span class="s1">&#39;900&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span><span class="s1">&#39;left&#39;</span><span class="p">}),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">Ul</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;display&#39;</span><span class="p">:</span> <span class="s1">&#39;flex&#39;</span><span class="p">,</span> <span class="s1">&#39;justifyContent&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="s1">&#39;flexDirection&#39;</span><span class="p">:</span><span class="s1">&#39;column&#39;</span><span class="p">,</span> <span class="s1">&#39;alignItems&#39;</span><span class="p">:</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span><span class="s1">&#39;100%&#39;</span><span class="p">,</span><span class="s1">&#39;margin&#39;</span><span class="p">:</span><span class="s1">&#39;10px 0&#39;</span><span class="p">,</span><span class="s1">&#39;padding&#39;</span><span class="p">:</span><span class="s1">&#39;0&#39;</span><span class="p">},</span><span class="n">children</span> <span class="o">=</span><span class="p">[</span>
                <span class="n">dcc</span><span class="o">.</span><span class="n">Link</span><span class="p">(</span><span class="s1">&#39;Inicio&#39;</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="s1">&#39;fontSize&#39;</span><span class="p">:</span> <span class="s1">&#39;15px&#39;</span><span class="p">,</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;80%&#39;</span><span class="p">,</span><span class="s1">&#39;marginBottom&#39;</span><span class="p">:</span><span class="s1">&#39;8px&#39;</span><span class="p">,</span> <span class="s1">&#39;textDecoration&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;padding&#39;</span><span class="p">:</span> <span class="s1">&#39;10px&#39;</span><span class="p">,</span> <span class="s1">&#39;borderRadius&#39;</span><span class="p">:</span> <span class="s1">&#39;5px&#39;</span><span class="p">,</span> <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;#ffa888&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">}),</span>
                <span class="n">dcc</span><span class="o">.</span><span class="n">Link</span><span class="p">(</span><span class="s1">&#39;Serie de tiempo (EDA)&#39;</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="s1">&#39;/time-series&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;80%&#39;</span><span class="p">,</span><span class="s1">&#39;marginBottom&#39;</span><span class="p">:</span><span class="s1">&#39;8px&#39;</span><span class="p">,</span>  <span class="s1">&#39;fontSize&#39;</span><span class="p">:</span> <span class="s1">&#39;15px&#39;</span><span class="p">,</span> <span class="s1">&#39;textDecoration&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;padding&#39;</span><span class="p">:</span> <span class="s1">&#39;10px&#39;</span><span class="p">,</span> <span class="s1">&#39;borderRadius&#39;</span><span class="p">:</span> <span class="s1">&#39;5px&#39;</span><span class="p">,</span> <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;#ffa888&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">}),</span>
                <span class="n">dcc</span><span class="o">.</span><span class="n">Link</span><span class="p">(</span><span class="s1">&#39;Modelo Predictivo&#39;</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="s1">&#39;/predictive-model&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;80%&#39;</span><span class="p">,</span><span class="s1">&#39;marginBottom&#39;</span><span class="p">:</span><span class="s1">&#39;8px&#39;</span><span class="p">,</span>  <span class="s1">&#39;fontSize&#39;</span><span class="p">:</span> <span class="s1">&#39;15px&#39;</span><span class="p">,</span> <span class="s1">&#39;textDecoration&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;padding&#39;</span><span class="p">:</span> <span class="s1">&#39;10px&#39;</span><span class="p">,</span> <span class="s1">&#39;borderRadius&#39;</span><span class="p">:</span> <span class="s1">&#39;5px&#39;</span><span class="p">,</span> <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;#ffa888&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">}),</span>

            <span class="p">]),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;explain-content&#39;</span><span class="p">)</span>
        <span class="p">]),</span>

        <span class="n">html</span><span class="o">.</span><span class="n">Section</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;page-content&#39;</span><span class="p">,</span> <span class="n">className</span><span class="o">=</span><span class="s1">&#39;section&#39;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;gridArea&#39;</span><span class="p">:</span><span class="s1">&#39;section&#39;</span><span class="p">,</span> <span class="s1">&#39;gridColumnStart&#39;</span><span class="p">:</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;gridColumnEnd&#39;</span><span class="p">:</span><span class="s1">&#39;4&#39;</span><span class="p">,</span><span class="s1">&#39;gridRowStart&#39;</span><span class="p">:</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;gridRowEnd&#39;</span><span class="p">:</span><span class="s1">&#39;5&#39;</span><span class="p">,</span><span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="s1">&#39;border&#39;</span><span class="p">:</span><span class="s1">&#39;1px solid #cbc4ad&#39;</span><span class="p">,</span> <span class="s1">&#39;borderRadius&#39;</span><span class="p">:</span><span class="s1">&#39;5px&#39;</span><span class="p">,</span> <span class="s1">&#39;padding&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">}),</span>
    <span class="p">]),</span>
<span class="p">])</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="s1">&#39;explain-content&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
              <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="s1">&#39;pathname&#39;</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">display_page</span><span class="p">(</span><span class="n">pathname</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">pathname</span> <span class="o">==</span> <span class="s1">&#39;/time-series&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">()</span> 
    <span class="k">elif</span> <span class="n">pathname</span> <span class="o">==</span> <span class="s1">&#39;/predictive-model&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">)</span>
      
<span class="c1"># Update the index</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="s1">&#39;page-content&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
              <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="s1">&#39;pathname&#39;</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">display_page</span><span class="p">(</span><span class="n">pathname</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">pathname</span> <span class="o">==</span> <span class="s1">&#39;/time-series&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
                 <span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="s1">&#39;Estás en la página del análisis exploratorio de la serie de tiempo&#39;</span><span class="p">)</span>
                <span class="p">])</span>
            <span class="p">)</span>
    <span class="k">elif</span> <span class="n">pathname</span> <span class="o">==</span> <span class="s1">&#39;/predictive-model&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
            <span class="n">html</span><span class="o">.</span><span class="n">H3</span><span class="p">(</span><span class="s1">&#39;Estás en la página del modelo predictivo&#39;</span><span class="p">)</span>
        <span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">html</span><span class="o">.</span><span class="n">H4</span><span class="p">(</span><span class="s1">&#39;Sobre el conjunto de datos&#39;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontSize&#39;</span><span class="p">:</span><span class="s1">&#39;1rem&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span><span class="s1">&#39;left&#39;</span><span class="p">}),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="s1">&#39;Presentamos el análisis de un conjunto de datos llamado HadCRUT5, que mide los cambios de temperatura cercana a la superficie en todo el mundo, entre 1850 a 2018. HadCRUT5 presenta anomalías mensuales promedio de temperatura cercana a la superficie, en relación con el período 1961–1990.&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontSize&#39;</span><span class="p">:</span><span class="s1">&#39;0.8rem&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="s1">&#39;lineHeight&#39;</span><span class="p">:</span><span class="s1">&#39;150%&#39;</span><span class="p">}),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="s1">&#39;En general, este conjunto de datos muestra un aumento del calentamiento promedio global desde mediados del siglo 19 y en los últimos años, en consonancia con otros análisis. Este fenómeno se debe a múltiples factores, incluidos una mejor representación del calentamiento del Ártico y una mejor comprensión de los sesgos en evolución en las mediciones sobre la superficie del mar y la tierra.&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontSize&#39;</span><span class="p">:</span><span class="s1">&#39;0.8rem&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="s1">&#39;lineHeight&#39;</span><span class="p">:</span><span class="s1">&#39;150%&#39;</span><span class="p">}),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="s1">&#39;Para revisar a detalle el proceso de obtención y procesamiento de los datos, visite la información de referencia. &#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontSize&#39;</span><span class="p">:</span><span class="s1">&#39;0.8rem&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="s1">&#39;lineHeight&#39;</span><span class="p">:</span><span class="s1">&#39;150%&#39;</span><span class="p">}),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="s1">&#39;Morice, C. P., Kennedy, J. J., Rayner, N. A., Winn, J. P., Hogan, E., Killick, R. E., Dunn, R. J. H., Osborn, T. J., Jones, P. D., &amp; Simpson, I. R. (2021). An Updated Assessment of Near-Surface Temperature Change From 1850: The HadCRUT5 Data Set. Journal of Geophysical Research: Atmospheres, 126(3), e2019JD032361. https://doi.org/10.1029/2019JD032361&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontSize&#39;</span><span class="p">:</span><span class="s1">&#39;0.8rem&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="s1">&#39;lineHeight&#39;</span><span class="p">:</span><span class="s1">&#39;150%&#39;</span><span class="p">}),</span>
        <span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run_server</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># &lt;- For testing purposes</span>
    <span class="c1">#app.run_server(debug=True, host=&#39;0.0.0.0&#39;, port=9000) # &lt;- To Dockerize the Dash</span>
    
</pre></div>
</div>
<ul class="simple">
<li><p>Este código, luego de importar bibliotecas y cargar los datos, crea una instancia de la aplicación dash. Dentro de esa instancia, define el diseño de la aplicación utilizando componentes HTML y Dash. Los Callbacks que se ejecutan en respuesta a cambio de los inputs, actualiza el contenido de la sección principal de la página en función del ‘url’ actual. Se crea el contenido de la página de inicio correspondiente a un texto describiendo el conjunto de datos. Asimismo, se realizan ajustes de forma y presentación de títulos, colores, localización, etc.</p></li>
</ul>
<ul class="simple">
<li><p>Una vez configurada la plantilla, se procede a desarrollar la sección de análisis exploratorio. A continuación, se decriben cada uno de los componentes.</p></li>
</ul>
<section id="media-movil-de-12-meses">
<h2>Media móvil de 12 meses<a class="headerlink" href="#media-movil-de-12-meses" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>El código inicia importando las bibliotecas necesarias y cargando un conjunto de datos desde un repositorio en github. Luego, define una función para calcular la media móvil y el intervalo de confianza de los datos. La aplicación Dash se crea y se diseña con un título y el gráfico de la serie de tiempo. Una función callback se define para actualizar el gráfico cuando el usuario coloca el cursor sobre él con la función ‘hover’, mostrando la media móvil, el intervalo de confianza y la media del año seleccionado. Finalmente, la aplicación se ejecuta.</p></li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convertir la columna &#39;date&#39; a un objeto de fecha y hora</span>
<span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>

<span class="c1"># Ordenar el DataFrame por la columna &#39;date&#39; (si aún no está ordenado)</span>
<span class="n">df_timeseries</span> <span class="o">=</span> <span class="n">df_timeseries</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dash</span>
<span class="kn">from</span> <span class="nn">dash</span> <span class="kn">import</span>  <span class="n">dcc</span><span class="p">,</span> <span class="n">html</span><span class="p">,</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Output</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>


<span class="n">timeseries_URL</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/SandraMaldonado19/Dash_PF_Dataviz/main/df_timeseries.csv&quot;</span>
<span class="n">df_tseries</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">timeseries_URL</span><span class="p">)</span>


<span class="c1"># Definimos la función encargada de calcular la media móvil y el intervalo de </span>
<span class="c1">## En este código &#39;1.96&#39; es el valor z para un intervalo de confianza del 95%.</span>

<span class="c1"># Función para calcular la media móvil y el intervalo de confianza</span>
<span class="k">def</span> <span class="nf">calculate_rolling_mean</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">num_of_std</span><span class="o">=</span><span class="mf">1.96</span><span class="p">):</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rolling_mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window_size</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rolling_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window_size</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;upper_band&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rolling_mean&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rolling_std&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_of_std</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;lower_band&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rolling_mean&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rolling_std&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_of_std</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="c1"># Crear la aplicación Dash</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">dash</span><span class="o">.</span><span class="n">Dash</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># Diseño de la aplicación</span>
<span class="n">app</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
    <span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="s1">&#39;Serie de tiempo - Anomalía de Temperatura Global (1850 - 2023)&#39;</span><span class="p">,</span>
                <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;display&#39;</span><span class="p">:</span> <span class="s1">&#39;inline&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;float&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;2.65em&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;margin-left&#39;</span><span class="p">:</span> <span class="s1">&#39;7px&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;font-weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bolder&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;font-family&#39;</span><span class="p">:</span> <span class="s1">&#39;Product Sans&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s2">&quot;rgba(117, 117, 117, 0.95)&quot;</span><span class="p">,</span>
                       <span class="s1">&#39;margin-top&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;margin-bottom&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span>
                       <span class="p">}),</span>
    <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;timeseries-graph&#39;</span><span class="p">),</span>
<span class="p">])</span>

<span class="c1"># Definir la función callback</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="s1">&#39;timeseries-graph&#39;</span><span class="p">,</span> <span class="s1">&#39;figure&#39;</span><span class="p">),</span>
              <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s1">&#39;timeseries-graph&#39;</span><span class="p">,</span> <span class="s1">&#39;hoverData&#39;</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">update_graph</span><span class="p">(</span><span class="n">hoverData</span><span class="p">):</span>
    <span class="c1"># Calcular la media móvil y el intervalo de confianza</span>
    <span class="n">df_timeseries</span> <span class="o">=</span> <span class="n">calculate_rolling_mean</span><span class="p">(</span><span class="n">df_tseries</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>  <span class="c1"># Asegúrate de tener una copia del DataFrame original</span>
    <span class="n">trace_data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Agregar la serie temporal original</span>
    <span class="n">trace_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span>
        <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;line&#39;</span><span class="p">,</span>
        <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;lines&#39;</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Original Data&#39;</span><span class="p">,</span>
        <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">}</span>
    <span class="p">})</span>

    <span class="c1"># Agregar la media móvil</span>
    <span class="n">trace_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span>
        <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;rolling_mean&#39;</span><span class="p">],</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;line&#39;</span><span class="p">,</span>
        <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;lines&#39;</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;12-Month Rolling Mean&#39;</span><span class="p">,</span>
        <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">}</span>
    <span class="p">})</span>

    <span class="c1"># Agregar el intervalo de confianza</span>
    <span class="n">trace_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span>
        <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;upper_band&#39;</span><span class="p">],</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;line&#39;</span><span class="p">,</span>
        <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;lines&#39;</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Upper Band&#39;</span><span class="p">,</span>
        <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;dash&#39;</span><span class="p">:</span> <span class="s1">&#39;dash&#39;</span><span class="p">}</span>
    <span class="p">})</span>

    <span class="n">trace_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span>
        <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;lower_band&#39;</span><span class="p">],</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;line&#39;</span><span class="p">,</span>
        <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;lines&#39;</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Lower Band&#39;</span><span class="p">,</span>
        <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;dash&#39;</span><span class="p">:</span> <span class="s1">&#39;dash&#39;</span><span class="p">}</span>
    <span class="p">})</span>

    <span class="c1"># Marcar la media correspondiente al año cuando se pasa el ratón sobre la gráfica</span>
    <span class="k">if</span> <span class="n">hoverData</span><span class="p">:</span>
        <span class="n">year_hovered</span> <span class="o">=</span> <span class="n">hoverData</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">mean_value</span> <span class="o">=</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">year_hovered</span><span class="p">)][</span><span class="s1">&#39;rolling_mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">trace_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">hoverData</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mean_value</span><span class="p">],</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;scatter&#39;</span><span class="p">,</span>
            <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;markers&#39;</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Mean </span><span class="si">{</span><span class="n">year_hovered</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
            <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Mean </span><span class="si">{</span><span class="n">year_hovered</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="p">})</span>

    <span class="n">figure</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">trace_data</span><span class="p">,</span>
        <span class="s1">&#39;layout&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Media Móvil de 12 Meses con Intervalo de Confianza&#39;</span><span class="p">,</span>
            <span class="s1">&#39;xaxis&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Fecha&#39;</span><span class="p">},</span>
            <span class="s1">&#39;yaxis&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Valor&#39;</span><span class="p">},</span>
            <span class="s1">&#39;margin&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">},</span>
            <span class="s1">&#39;legend&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">figure</span>

<span class="c1"># Ejecutar la aplicación</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run_server</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Se puede observar una tendencia de aumento en la serie luego de la etapa pre-industrial, lo que sugiere que la serie tiene un comportamiento no estacionario, con medias variables y en aumento para intervalos de 12 meses.</p></li>
</ul>
</section>
<section id="media-mensual-multianual-y-distribucion-de-datos-boxplot">
<h2>Media mensual multianual y distribución de datos: Boxplot<a class="headerlink" href="#media-mensual-multianual-y-distribucion-de-datos-boxplot" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Se graficó un boxplot Multianual por mes, que se utiliza para visualizar la distribución de los datos de Anomalías de Temperatura a lo largo de los meses del año. Cada caja en el gráfico representa un mes específico y muestra la variabilidad de los datos para ese mes a lo largo de varios años. El gráfico está diseñado de tal manera que cada caja (o ‘boxplot’) muestra la mediana (la línea en el medio de la caja), los cuartiles superior e inferior (los bordes superior e inferior de la caja), y los valores atípicos (los puntos por encima y por debajo de las líneas que se extienden desde la caja). Esto proporciona una visión clara de la distribución de los datos, permitiendo identificar tendencias y anomalías.</p></li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dash</span>
<span class="kn">from</span> <span class="nn">dash</span> <span class="kn">import</span> <span class="n">dcc</span><span class="p">,</span> <span class="n">html</span>
<span class="kn">from</span> <span class="nn">dash.dependencies</span> <span class="kn">import</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Output</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Lectura de datos</span>
<span class="n">timeseries_URL</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/SandraMaldonado19/Dash_PF_Dataviz/main/df_timeseries.csv&quot;</span>
<span class="n">df_tseries</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">timeseries_URL</span><span class="p">)</span>

<span class="c1"># Crear la aplicación Dash</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">dash</span><span class="o">.</span><span class="n">Dash</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># Definir el diseño de la aplicación</span>
<span class="n">app</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
    <span class="n">html</span><span class="o">.</span><span class="n">H1</span><span class="p">(</span><span class="s2">&quot;Boxplot Multianual por Mes&quot;</span><span class="p">),</span>

    <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;boxplot&#39;</span><span class="p">),</span>

    <span class="c1"># Puedes agregar más componentes de diseño según sea necesario</span>
<span class="p">])</span>

<span class="c1"># Definir la función para actualizar el gráfico</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="s1">&#39;boxplot&#39;</span><span class="p">,</span> <span class="s1">&#39;figure&#39;</span><span class="p">),</span>
              <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s1">&#39;boxplot&#39;</span><span class="p">,</span> <span class="s1">&#39;hoverData&#39;</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">update_boxplot</span><span class="p">(</span><span class="n">hoverData</span><span class="p">):</span>
    <span class="c1"># Crear el boxplot con Plotly Graph Objects</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

    <span class="c1"># Agregar boxplots para cada mes</span>
    <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[</span><span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">month</span><span class="p">]</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="n">month</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">))</span>

    <span class="c1"># Agregar la línea de tendencia (media multianual)</span>
    <span class="n">trend_line</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">)[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    
    <span class="c1"># Ordenar los datos por el orden de los meses</span>
    <span class="n">ordered_months</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;january&#39;</span><span class="p">,</span> <span class="s1">&#39;february&#39;</span><span class="p">,</span> <span class="s1">&#39;march&#39;</span><span class="p">,</span> <span class="s1">&#39;april&#39;</span><span class="p">,</span> <span class="s1">&#39;may&#39;</span><span class="p">,</span> <span class="s1">&#39;june&#39;</span><span class="p">,</span> <span class="s1">&#39;july&#39;</span><span class="p">,</span> <span class="s1">&#39;august&#39;</span><span class="p">,</span> <span class="s1">&#39;september&#39;</span><span class="p">,</span> <span class="s1">&#39;october&#39;</span><span class="p">,</span> <span class="s1">&#39;november&#39;</span><span class="p">,</span> <span class="s1">&#39;december&#39;</span><span class="p">]</span>
    <span class="n">trend_line</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">trend_line</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">],</span> <span class="n">categories</span><span class="o">=</span><span class="n">ordered_months</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">trend_line</span> <span class="o">=</span> <span class="n">trend_line</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">trend_line</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">trend_line</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
                             <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">dash</span><span class="o">=</span><span class="s1">&#39;dash&#39;</span><span class="p">),</span>
                             <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Media Multianual&#39;</span><span class="p">))</span>

    <span class="c1"># Ajustar el diseño del gráfico</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">xaxis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Mes&#39;</span><span class="p">},</span> <span class="n">yaxis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Anomalía de Temperatura&#39;</span><span class="p">},</span>
                      <span class="n">boxmode</span><span class="o">=</span><span class="s1">&#39;group&#39;</span><span class="p">)</span>  <span class="c1"># Para agrupar los boxplots en el eje x</span>

    <span class="k">return</span> <span class="n">fig</span>

<span class="c1"># Ejecutar la aplicación</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run_server</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>El análisis de Anomalías de temperatura por meses indica que, por lo menos el 50% de los datos para todos los meses, se mantiene por debajo de las temperaturas preindustriales, con magnitudes que varían entre -0.22°C y -0.09°C, siendo el mes de octubre el que presenta temperaturas más similares a este período de referencia. Se conoce que, por lo menos el 25% superior de los datos presenta aumentos de temperatura para todos los meses.</p></li>
</ul>
</section>
<section id="anomalias-mensual-anual-mapa-de-calor">
<h2>Anomalías mensual-anual: mapa de calor<a class="headerlink" href="#anomalias-mensual-anual-mapa-de-calor" title="Permalink to this heading">#</a></h2>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dash</span>
<span class="kn">from</span> <span class="nn">dash</span> <span class="kn">import</span> <span class="n">dcc</span><span class="p">,</span> <span class="n">html</span>
<span class="kn">from</span> <span class="nn">dash.dependencies</span> <span class="kn">import</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Output</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Lectura de datos</span>
<span class="n">timeseries_URL</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/SandraMaldonado19/Dash_PF_Dataviz/main/df_timeseries.csv&quot;</span>
<span class="n">df_tseries</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">timeseries_URL</span><span class="p">)</span>


<span class="c1"># Crear la aplicación Dash</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">dash</span><span class="o">.</span><span class="n">Dash</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># Orden de los meses</span>
<span class="n">month_order</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;january&#39;</span><span class="p">,</span> <span class="s1">&#39;february&#39;</span><span class="p">,</span> <span class="s1">&#39;march&#39;</span><span class="p">,</span> <span class="s1">&#39;april&#39;</span><span class="p">,</span> <span class="s1">&#39;may&#39;</span><span class="p">,</span> <span class="s1">&#39;june&#39;</span><span class="p">,</span> <span class="s1">&#39;july&#39;</span><span class="p">,</span> <span class="s1">&#39;august&#39;</span><span class="p">,</span> <span class="s1">&#39;september&#39;</span><span class="p">,</span> <span class="s1">&#39;october&#39;</span><span class="p">,</span> <span class="s1">&#39;november&#39;</span><span class="p">,</span> <span class="s1">&#39;december&#39;</span><span class="p">]</span>

<span class="c1"># Pivotar los datos para tener años en el eje x, meses en el eje y</span>
<span class="n">heatmap_data</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>

<span class="c1"># Configurar el orden de los meses en el eje y</span>
<span class="n">heatmap_data</span> <span class="o">=</span> <span class="n">heatmap_data</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">month_order</span><span class="p">)</span>

<span class="c1"># Crear la aplicación Dash</span>
<span class="n">app</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
    <span class="n">html</span><span class="o">.</span><span class="n">H1</span><span class="p">(</span><span class="s2">&quot;Mapa de Calor de Anomalías de Temperatura&quot;</span><span class="p">),</span>

    <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;heatmap&#39;</span><span class="p">),</span>

    <span class="c1"># Puedes agregar más componentes de diseño según sea necesario</span>
<span class="p">])</span>

<span class="c1"># Definir la función para actualizar el gráfico de mapa de calor</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="s1">&#39;heatmap&#39;</span><span class="p">,</span> <span class="s1">&#39;figure&#39;</span><span class="p">),</span>
              <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s1">&#39;heatmap&#39;</span><span class="p">,</span> <span class="s1">&#39;hoverData&#39;</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">update_heatmap</span><span class="p">(</span><span class="n">hoverData</span><span class="p">):</span>
    <span class="c1"># Crear el mapa de calor con Plotly Graph Objects</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

    <span class="c1"># Añadir el mapa de calor</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">heatmap_data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">heatmap_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">heatmap_data</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                             <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Anomalía de Temperatura&#39;</span><span class="p">),</span> <span class="n">reversescale</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="c1"># Ajustar el diseño del gráfico</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">xaxis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Año&#39;</span><span class="p">},</span> <span class="n">yaxis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Mes&#39;</span><span class="p">,</span> <span class="s1">&#39;categoryorder&#39;</span><span class="p">:</span> <span class="s1">&#39;array&#39;</span><span class="p">,</span> <span class="s1">&#39;categoryarray&#39;</span><span class="p">:</span> <span class="n">month_order</span><span class="p">},</span>
                      <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Mapa de Calor de Anomalías de Temperatura&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span>

<span class="c1"># Ejecutar la aplicación</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run_server</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>A partir de este mapa de calor se han identificado tendencias significativas en los datos de temperatura. Tras la Revolución Industrial, que tuvo lugar a finales del siglo XIX, se ha registrado un incremento progresivo en las temperaturas hasta el cierre del siglo XX. Con el inicio del nuevo milenio, se ha observado una aceleración notable en este incremento de temperatura. Estos patrones globales coinciden con fenómenos de gran escala como la proliferación de la industrialización y el auge y desarrollo de las áreas urbanas, que son los principales contribuyentes a la emisión de gases de efecto invernadero (GEI) a gran escala. Estos gases son los causantes primordiales del calentamiento global debido a su producción intensiva.</p></li>
</ul>
</section>
<section id="promedio-decenal">
<h2>Promedio decenal<a class="headerlink" href="#promedio-decenal" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>A continuación, se crea un gráfico de barras. Se define una función de devolución de llamada que se activa cuando el usuario interactúa con el gráfico de barras. Esta función calcula los promedios decenales y actualiza el gráfico de barras.</p></li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dash</span>
<span class="kn">from</span> <span class="nn">dash</span> <span class="kn">import</span> <span class="n">dcc</span><span class="p">,</span> <span class="n">html</span>
<span class="kn">from</span> <span class="nn">dash.dependencies</span> <span class="kn">import</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Output</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Leer el DataFrame</span>
<span class="c1"># Lectura de datos</span>
<span class="n">timeseries_URL</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/SandraMaldonado19/Dash_PF_Dataviz/main/df_timeseries.csv&quot;</span>
<span class="n">df_tseries</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">timeseries_URL</span><span class="p">)</span>

<span class="c1"># Convertir la columna &#39;date&#39; a tipo datetime si aún no lo está</span>
<span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>

<span class="c1"># Agregar una columna &#39;decade&#39; para agrupar por década</span>
<span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;decade&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">//</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span>

<span class="c1"># Agregar una columna &#39;color&#39; basada en la condición de la anomalía</span>
<span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>

<span class="c1"># Crear la aplicación Dash</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">dash</span><span class="o">.</span><span class="n">Dash</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># Crear la aplicación Dash</span>
<span class="n">app</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
    <span class="n">html</span><span class="o">.</span><span class="n">H1</span><span class="p">(</span><span class="s2">&quot;Promedios Decenales de Anomalías de Temperatura&quot;</span><span class="p">),</span>

    <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;bar-chart&#39;</span><span class="p">),</span>

    <span class="c1"># Puedes agregar más componentes de diseño según sea necesario</span>
<span class="p">])</span>

<span class="c1"># Definir la función para actualizar el gráfico de barras</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="s1">&#39;bar-chart&#39;</span><span class="p">,</span> <span class="s1">&#39;figure&#39;</span><span class="p">),</span>
              <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s1">&#39;bar-chart&#39;</span><span class="p">,</span> <span class="s1">&#39;hoverData&#39;</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">update_bar_chart</span><span class="p">(</span><span class="n">hoverData</span><span class="p">):</span>
    <span class="c1"># Calcular los promedios decenales</span>
    <span class="n">decade_means</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;decade&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;first&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

    <span class="c1"># Crear el gráfico de barras con Plotly Express</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">decade_means</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;decade&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;color&#39;</span><span class="p">,</span>
                 <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;Anomalía de Temperatura&#39;</span><span class="p">},</span> 
                 <span class="n">color_discrete_map</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;red&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">},</span>
                 <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Promedios Decenales de Anomalías de Temperatura&#39;</span><span class="p">)</span>

    <span class="c1"># Modificar las etiquetas de los ticks en el eje x</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">tickmode</span><span class="o">=</span><span class="s1">&#39;array&#39;</span><span class="p">,</span>
            <span class="n">tickvals</span><span class="o">=</span><span class="n">decade_means</span><span class="p">[</span><span class="s1">&#39;decade&#39;</span><span class="p">],</span>
            <span class="n">ticktext</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">decade</span><span class="si">}</span><span class="s2">s&quot;</span> <span class="k">for</span> <span class="n">decade</span> <span class="ow">in</span> <span class="n">decade_means</span><span class="p">[</span><span class="s1">&#39;decade&#39;</span><span class="p">]]</span>
        <span class="p">),</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span>

<span class="c1"># Ejecutar la aplicación</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run_server</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>La gráfica es consistente con el mapa de calor anterior, mostrando durante el siglo XX, especialmente entre 1940 y 1980, se empiezan a ver estas tendencias de aumento de la temperatura.</p></li>
</ul>
</section>
<section id="este-ano-hasta-ahora">
<h2>Este año hasta ahora<a class="headerlink" href="#este-ano-hasta-ahora" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>El siguiente gráfico agrega líneas con la tendencia mensual de la temperatura de un año específico que seleccione el ususario. El usuario puede comparar cualquier año de preferencia con los años que poseen mayores aumentos; en esta caso, corresponden a 2016, 2019 y 2020.</p></li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dash</span>
<span class="kn">from</span> <span class="nn">dash</span> <span class="kn">import</span> <span class="n">dcc</span><span class="p">,</span> <span class="n">html</span>
<span class="kn">from</span> <span class="nn">dash.dependencies</span> <span class="kn">import</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Output</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objs</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="c1"># Carga tu dataframe</span>
<span class="n">df_tseries</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./df_timeseries.csv&#39;</span><span class="p">)</span>

<span class="c1"># Asegúrate de que los datos estén en el formato correcto</span>
<span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>
<span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
<span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>

<span class="c1"># Encuentra los tres años más cálidos, excluyendo el año actual</span>
<span class="n">current_year</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span>
<span class="n">top_years</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[</span><span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">current_year</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>

<span class="c1"># Encuentra los valores máximos para cada mes</span>
<span class="n">max_values</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">)[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">dash</span><span class="o">.</span><span class="n">Dash</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">app</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
    <span class="n">dcc</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
        <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;year-picker&#39;</span><span class="p">,</span>
        <span class="n">options</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()],</span>
        <span class="n">value</span><span class="o">=</span><span class="p">[</span><span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span>
        <span class="n">multi</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">),</span>
    <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;temperature-graph&#39;</span><span class="p">)</span>
<span class="p">])</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;temperature-graph&#39;</span><span class="p">,</span> <span class="s1">&#39;figure&#39;</span><span class="p">),</span>
    <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s1">&#39;year-picker&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)]</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">update_figure</span><span class="p">(</span><span class="n">selected_years</span><span class="p">):</span>
    <span class="n">traces</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">markers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;circle&#39;</span><span class="p">,</span> <span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="s1">&#39;diamond&#39;</span><span class="p">,</span> <span class="s1">&#39;cross&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">]</span>

    <span class="c1"># Añade las líneas para los años más cálidos</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">top_years</span><span class="p">):</span>
        <span class="n">df_year</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[</span><span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">year</span><span class="p">]</span>
        <span class="n">traces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">df_year</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">],</span>
            <span class="n">y</span><span class="o">=</span><span class="n">df_year</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines+markers&#39;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">),</span>
            <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">symbol</span><span class="o">=</span><span class="n">markers</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">markers</span><span class="p">)],</span>
                <span class="n">size</span><span class="o">=</span><span class="mi">10</span>
            <span class="p">)</span>
        <span class="p">))</span>

    <span class="c1"># Añade las líneas para los años seleccionados</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">selected_year</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">selected_years</span><span class="p">):</span>
        <span class="n">df_selected</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[</span><span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">selected_year</span><span class="p">]</span>
        <span class="n">traces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">df_selected</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">],</span>
            <span class="n">y</span><span class="o">=</span><span class="n">df_selected</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines+markers&#39;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">selected_year</span><span class="p">),</span>
            <span class="n">line</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
            <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">symbol</span><span class="o">=</span><span class="n">markers</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">top_years</span><span class="p">))</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">markers</span><span class="p">)],</span>
                <span class="n">size</span><span class="o">=</span><span class="mi">10</span>
            <span class="p">)</span>
        <span class="p">))</span>

    <span class="c1"># Añade la línea para los valores máximos</span>
    <span class="n">traces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">max_values</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Máximo histórico&#39;</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;darkgrey&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">}</span>
    <span class="p">))</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">traces</span><span class="p">,</span>
        <span class="s1">&#39;layout&#39;</span><span class="p">:</span> <span class="n">go</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
            <span class="n">xaxis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Mes&#39;</span><span class="p">,</span> <span class="s1">&#39;tickvals&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">)),</span> <span class="s1">&#39;ticktext&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Enero&#39;</span><span class="p">,</span> <span class="s1">&#39;Febrero&#39;</span><span class="p">,</span> <span class="s1">&#39;Marzo&#39;</span><span class="p">,</span> <span class="s1">&#39;Abril&#39;</span><span class="p">,</span> <span class="s1">&#39;Mayo&#39;</span><span class="p">,</span> <span class="s1">&#39;Junio&#39;</span><span class="p">,</span> <span class="s1">&#39;Julio&#39;</span><span class="p">,</span> <span class="s1">&#39;Agosto&#39;</span><span class="p">,</span> <span class="s1">&#39;Septiembre&#39;</span><span class="p">,</span> <span class="s1">&#39;Octubre&#39;</span><span class="p">,</span> <span class="s1">&#39;Noviembre&#39;</span><span class="p">,</span> <span class="s1">&#39;Diciembre&#39;</span><span class="p">]},</span>
            <span class="n">yaxis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Anomalía de temperatura (°C)&#39;</span><span class="p">},</span>
            <span class="n">hovermode</span><span class="o">=</span><span class="s1">&#39;closest&#39;</span>
        <span class="p">)</span>
    <span class="p">}</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run_server</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="verificacion-de-la-estacionariedad-de-la-serie">
<h2>Verificación de la estacionariedad de la serie<a class="headerlink" href="#verificacion-de-la-estacionariedad-de-la-serie" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Se utiliza la prueba estadística Dickey-Fuller y los plots ACF y PACF para verificar si la serie es estacionaria. Esto es indispensable para construir modelos de series temporales, como los modelos ARIMA, ya que la estacionariedad es un supuesto fundamental. Si las propiedades estadísticas de la serie no cambian a lo largo del tiempo, se pueden obtener predicciones más precisas.</p></li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dash</span>
<span class="kn">import</span> <span class="nn">dash_bootstrap_components</span> <span class="k">as</span> <span class="nn">dbc</span>
<span class="kn">from</span> <span class="nn">dash</span> <span class="kn">import</span> <span class="n">html</span><span class="p">,</span> <span class="n">dcc</span>
<span class="kn">from</span> <span class="nn">dash.dependencies</span> <span class="kn">import</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Output</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">adfuller</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objs</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">acf</span>
<span class="kn">from</span> <span class="nn">plotly.subplots</span> <span class="kn">import</span> <span class="n">make_subplots</span>


<span class="c1">#____ Cargue de datos______________________________________________________________________________________________________</span>

<span class="n">timeseries_URL</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/SandraMaldonado19/Dash_PF_Dataviz/main/df_timeseries.csv&quot;</span>
<span class="n">df_tseries</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">timeseries_URL</span><span class="p">)</span>

<span class="c1">#____ Cálculos y funciones_________________________________________________________________________________________________</span>
<span class="c1">#---- Estadístico ADF------------------------------------------------------------------------------------------------------</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="n">adf_statistic</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">p_value</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1">#---- Conjuntos de entrenamiento y prueba----------------------------------------------------------------------------------</span>

<span class="n">n_temp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="p">);</span> <span class="n">n_test</span> <span class="o">=</span> <span class="mi">21</span> 
<span class="n">train_size</span> <span class="o">=</span> <span class="n">n_temp</span> <span class="o">-</span> <span class="n">n_test</span>

<span class="n">train</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">dates_train</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">test_21month</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span> 
<span class="n">dates_21month</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span> 


<span class="c1"># ____Gráficas________________________________________________________________________________________________________________</span>

<span class="c1">#----- Autocorrelación--------------------------------------------------------------------------------------------------------</span>

<span class="c1"># Crear una figura con subplots</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Agregar los gráficos a los subplots correspondientes</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">),</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hovertemplate</span><span class="o">=</span><span class="s1">&#39;Value: %</span><span class="si">{y}</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">diff</span><span class="p">(),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">),</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hovertemplate</span><span class="o">=</span><span class="s1">&#39;Diff: %</span><span class="si">{y}</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">(),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">),</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hovertemplate</span><span class="o">=</span><span class="s1">&#39;Diff Diff: %</span><span class="si">{y}</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Para agregar los gráficos de autocorrelación, se necesita calcular los valores de autocorrelación</span>
<span class="n">acf_values</span> <span class="o">=</span> <span class="n">acf</span><span class="p">(</span><span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">nlags</span><span class="o">=</span><span class="mi">2080</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">acf_values</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;tozeroy&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">),</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hovertemplate</span><span class="o">=</span><span class="s1">&#39;ACF: %</span><span class="si">{y}</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">diff1_values</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
<span class="n">acf_diff1_values</span> <span class="o">=</span> <span class="n">acf</span><span class="p">(</span><span class="n">diff1_values</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">nlags</span><span class="o">=</span><span class="mi">2080</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">acf_diff1_values</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;tozeroy&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">),</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hovertemplate</span><span class="o">=</span><span class="s1">&#39;ACF Diff: %</span><span class="si">{y}</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">diff2_values</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
<span class="n">acf_diff2_values</span> <span class="o">=</span> <span class="n">acf</span><span class="p">(</span><span class="n">diff2_values</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">nlags</span><span class="o">=</span><span class="mi">2080</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">acf_diff2_values</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;tozeroy&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">),</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hovertemplate</span><span class="o">=</span><span class="s1">&#39;ACF Diff Diff: %</span><span class="si">{y}</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>


<span class="c1"># Agregar títulos a las gráficas</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_annotation</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;Serie original&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.20</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">xref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span> <span class="n">yref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span> <span class="n">showarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_annotation</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;1er Orden de diferenciación&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.66</span><span class="p">,</span> <span class="n">xref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span> <span class="n">yref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span> <span class="n">showarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_annotation</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;2do Orden de diferenciación&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">xref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span> <span class="n">yref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span> <span class="n">showarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)))</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_annotation</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;ACF de la Serie original&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">xref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span> <span class="n">yref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span> <span class="n">showarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_annotation</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;ACF del 1er Orden de diferenciación&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.88</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.66</span><span class="p">,</span> <span class="n">xref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span> <span class="n">yref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span> <span class="n">showarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_annotation</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;ACF del 2do Orden de diferenciación&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.88</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">xref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span> <span class="n">yref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span> <span class="n">showarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)))</span>


<span class="c1">#____ Configuración de la aplicación__________________________________________________________________________________________</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">dash</span><span class="o">.</span><span class="n">Dash</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">external_stylesheets</span><span class="o">=</span><span class="p">[</span><span class="n">dbc</span><span class="o">.</span><span class="n">themes</span><span class="o">.</span><span class="n">BOOTSTRAP</span><span class="p">])</span>

<span class="n">app</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
    <span class="n">dbc</span><span class="o">.</span><span class="n">Row</span><span class="p">([</span>
        <span class="n">dbc</span><span class="o">.</span><span class="n">Col</span><span class="p">([</span>
            <span class="n">dcc</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;mi-dropdown&#39;</span><span class="p">,</span>
                <span class="n">options</span><span class="o">=</span><span class="p">[</span>
                    <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;ARIMA&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">},</span>
                    <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Suavización exponencial&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;2&#39;</span><span class="p">},</span>
                    <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Regresión polinomial&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;3&#39;</span><span class="p">}</span>
                <span class="p">],</span>
                <span class="n">value</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;70%&#39;</span><span class="p">,</span> <span class="s1">&#39;marginLeft&#39;</span><span class="p">:</span> <span class="s1">&#39;15%&#39;</span><span class="p">}</span>
            <span class="p">)</span>
        <span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">className</span><span class="o">=</span><span class="s1">&#39;my-4&#39;</span><span class="p">)</span>
    <span class="p">]),</span>
    <span class="n">html</span><span class="o">.</span><span class="n">H1</span><span class="p">(</span><span class="s2">&quot;Serie de tiempo: Anomalía de temperatura (°C)&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">}),</span>
    <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;output-container&#39;</span><span class="p">)</span>
<span class="p">])</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;output-container&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s1">&#39;mi-dropdown&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)]</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">update_output</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dbc</span><span class="o">.</span><span class="n">Container</span><span class="p">([</span>
            <span class="n">dbc</span><span class="o">.</span><span class="n">Row</span><span class="p">([</span>
                <span class="n">dbc</span><span class="o">.</span><span class="n">Col</span><span class="p">([</span>
                    <span class="n">dbc</span><span class="o">.</span><span class="n">Card</span><span class="p">([</span>
                        <span class="n">dbc</span><span class="o">.</span><span class="n">CardBody</span><span class="p">([</span>
                            <span class="n">html</span><span class="o">.</span><span class="n">H3</span><span class="p">(</span><span class="s2">&quot;ADF test&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;font-family&#39;</span><span class="p">:</span> <span class="s1">&#39;Arial&#39;</span><span class="p">}),</span>
                            <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estadística ADF: </span><span class="si">{</span><span class="nb">format</span><span class="p">(</span><span class="n">adf_statistic</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.3f&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> &gt; -3.4&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;font-family&#39;</span><span class="p">:</span> <span class="s1">&#39;Arial&#39;</span><span class="p">}),</span>
                            <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Valor p: </span><span class="si">{</span><span class="nb">format</span><span class="p">(</span><span class="n">p_value</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.3f&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> &gt; 0.05&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;font-family&#39;</span><span class="p">:</span> <span class="s1">&#39;Arial&#39;</span><span class="p">}),</span>
                            <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="s1">&#39;Se acepta de hipótesis nula&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;font-family&#39;</span><span class="p">:</span> <span class="s1">&#39;Arial&#39;</span><span class="p">})</span>
                        <span class="p">])</span>
                    <span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;light&#39;</span><span class="p">,</span> <span class="n">className</span><span class="o">=</span><span class="s1">&#39;mx-auto my-4&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;80%&#39;</span><span class="p">})</span>
                <span class="p">],</span> <span class="n">className</span><span class="o">=</span><span class="s1">&#39;my-4&#39;</span><span class="p">),</span>
                <span class="n">dbc</span><span class="o">.</span><span class="n">Col</span><span class="p">([</span>
                    <span class="n">dbc</span><span class="o">.</span><span class="n">Card</span><span class="p">([</span>
                        <span class="n">dbc</span><span class="o">.</span><span class="n">CardBody</span><span class="p">([</span>
                            <span class="n">html</span><span class="o">.</span><span class="n">H3</span><span class="p">(</span><span class="s2">&quot;Estacionariedad&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;font-family&#39;</span><span class="p">:</span> <span class="s1">&#39;Arial&#39;</span><span class="p">}),</span>
                            <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="s2">&quot;La serie de tiempo original no es estacionaria&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;font-family&#39;</span><span class="p">:</span> <span class="s1">&#39;Arial&#39;</span><span class="p">})</span>
                        <span class="p">])</span>
                    <span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;light&#39;</span><span class="p">,</span> <span class="n">className</span><span class="o">=</span><span class="s1">&#39;mx-auto my-4&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;80%&#39;</span><span class="p">})</span>
                <span class="p">],</span> <span class="n">className</span><span class="o">=</span><span class="s1">&#39;my-4&#39;</span><span class="p">)</span>
            <span class="p">]),</span>
                <span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="s2">&quot;Diferenciación y Autocorrelación&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">}),</span>
                <span class="n">dbc</span><span class="o">.</span><span class="n">Row</span><span class="p">([</span>
                    <span class="n">dbc</span><span class="o">.</span><span class="n">Col</span><span class="p">([</span>
                        <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>
            <span class="p">])</span>
        <span class="p">]),</span>


    <span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">()</span> 

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run_server</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Las tendencias en la serie muestran que la series no es estacionaria. Por lo tanto, debe aplicarse diferenciación para convertir la serie en estacionaria.</p></li>
</ul>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="modelos-predictivos">
<h1>Modelos predictivos<a class="headerlink" href="#modelos-predictivos" title="Permalink to this heading">#</a></h1>
<section id="modelo-arima">
<h2>Modelo ARIMA<a class="headerlink" href="#modelo-arima" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Iniciamos la construcción del modelo ARIMA con la división de los datos en conjuntos de entrenamiento y prueba. Después, utilizando un ciclo for busca el mejor modelo ARIMA para los datos de entrenamiento, probando diferentes combinaciones de parámetros. Una vez que encuentra el mejor modelo, lo ajusta a los datos de entrenamiento y realiza predicciones. La aplicación Dash representan muestra varios gráficos con los datos de entrenamiento, las predicciones del modelo y los límites de confianza de las predicciones.</p></li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dash</span>
<span class="kn">from</span> <span class="nn">dash</span> <span class="kn">import</span> <span class="n">html</span><span class="p">,</span> <span class="n">dcc</span>
<span class="kn">from</span> <span class="nn">dash</span> <span class="kn">import</span> <span class="n">dash_table</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objs</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.arima.model</span> <span class="kn">import</span> <span class="n">ARIMA</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">process_time</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>

<span class="c1"># ____ Cargue de datos___________________________________________________________________________________________________________</span>

<span class="n">timeseries_URL</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/SandraMaldonado19/Dash_PF_Dataviz/main/df_timeseries.csv&quot;</span>
<span class="n">df_tseries</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">timeseries_URL</span><span class="p">)</span>

<span class="c1"># ____ Cálculos y funciones________________________________________________________________________________________________________</span>

<span class="c1"># ---- Definimos el conjunto de prueba y de entrenamiento--------------------------------------------------------------------------</span>
<span class="n">n_temp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="n">n_test</span> <span class="o">=</span> <span class="mi">21</span>
<span class="n">train_size</span> <span class="o">=</span> <span class="n">n_temp</span> <span class="o">-</span> <span class="n">n_test</span>

<span class="n">train</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">dates_train</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">test_21month</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span>
<span class="n">dates_21month</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span>

<span class="n">train_df</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[[</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">test_21month_df</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[[</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span>

<span class="c1"># ---- Función para seleccionar el mejor modelo------------------------------------------------------------------------------------</span>

<span class="n">best_order</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">grid</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;grid_ARIMA.pkl&quot;</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">grid</span><span class="p">,</span> <span class="n">best_order</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;grid_ARIMA.pkl&#39;</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">))</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="n">time_start</span> <span class="o">=</span> <span class="n">process_time</span><span class="p">()</span>

        <span class="n">best_aic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">best_bic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">best_mdl</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">pq_rng</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">d_rng</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pq_rng</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">d_rng</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">pq_rng</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">tmp_mdl</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
                        <span class="n">tmp_aic</span> <span class="o">=</span> <span class="n">tmp_mdl</span><span class="o">.</span><span class="n">aic</span>
                        <span class="k">if</span> <span class="n">tmp_aic</span> <span class="o">&lt;</span> <span class="n">best_aic</span><span class="p">:</span>
                            <span class="n">best_aic</span> <span class="o">=</span> <span class="n">tmp_aic</span>
                            <span class="n">best_order</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                            <span class="n">best_mdl</span> <span class="o">=</span> <span class="n">tmp_mdl</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">continue</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">best_order</span><span class="p">)</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="n">time_stop</span> <span class="o">=</span> <span class="n">process_time</span><span class="p">()</span>

        <span class="n">str_cpu_time</span> <span class="o">=</span> <span class="s2">&quot;ARIMA CPU time: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">((</span><span class="n">time_stop</span> <span class="o">-</span> <span class="n">time_start</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; minutes&quot;</span>
        <span class="c1"># print(str_cpu_time)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;cpu_time.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">str_cpu_time</span><span class="p">)</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">((</span><span class="n">grid</span><span class="p">,</span> <span class="n">best_order</span><span class="p">),</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;grid_ARIMA.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">))</span>

    <span class="c1"># # ---- Predicciones del modelo-------------------------------------------------------------------------------------------------------</span>
    <span class="c1"># predictions = grid.get_prediction(start=1, end=len(train), dynamic=False)</span>
    <span class="c1"># pred_conf = predictions.conf_int()</span>

    <span class="c1"># # Extraer los valores predichos</span>
    <span class="c1"># predicted_values = predictions.predicted_mean</span>

    <span class="c1"># # Convertir pred_conf a un array de NumPy</span>
    <span class="c1"># pred_conf_np = pred_conf.values</span>

    <span class="n">summary_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_html</span><span class="p">(),</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># ---- Pronósticos ARIMA Rolling-----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">arima_rolling</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">best_order</span><span class="p">):</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)):</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">best_order</span><span class="p">)</span>
            <span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">()</span>
            <span class="n">yhat</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yhat</span><span class="p">)</span>
            <span class="n">obs</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
            <span class="c1">#print(&#39;predicted=%f, expected=%f&#39; % (yhat, obs))</span>
        <span class="k">return</span> <span class="n">predictions</span>

    <span class="c1"># Calcular los pronósticos con arima_rolling</span>
    <span class="n">test_21</span> <span class="o">=</span> <span class="n">test_21month</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">yhat_21</span> <span class="o">=</span> <span class="n">arima_rolling</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">test_21</span><span class="p">,</span> <span class="n">best_order</span><span class="p">)</span>

    <span class="c1"># ---- Cálculo del error de predicción -----------------------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">forecast_accuracy</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span> <span class="n">str_name</span><span class="p">):</span>
        <span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">actual</span><span class="p">))</span>  <span class="c1"># MAPE</span>
        <span class="n">mae</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">))</span>  <span class="c1"># MAE</span>
        <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>  <span class="c1"># RMSE</span>
        <span class="n">mse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># MSE</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">actual</span><span class="p">)</span>

        <span class="n">df_acc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mae</span><span class="p">],</span>
                               <span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mse</span><span class="p">],</span>
                               <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mape</span><span class="p">],</span>
                               <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmse</span><span class="p">],</span>
                               <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">r2</span><span class="p">]},</span>
                              <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">str_name</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">df_acc</span>

    <span class="n">accuracy_df</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yhat_21</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">test_21</span><span class="p">),</span> <span class="s2">&quot;21 meses&quot;</span><span class="p">)</span>

    <span class="c1"># ----Figuras pronóstico ARIMA -------------------------------------------------------------------------------------------------------</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">line</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dates_train</span><span class="p">[</span><span class="o">-</span><span class="mi">120</span><span class="p">:],</span> <span class="n">y</span><span class="o">=</span><span class="n">train</span><span class="p">[</span><span class="o">-</span><span class="mi">120</span><span class="p">:],</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Entrenamiento&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dates_21month</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">test_21</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Prueba&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dates_21month</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">yhat_21</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Pronóstico&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">))</span>

    <span class="c1"># Configuración adicional del diseño</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">tickmode</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">dtick</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">4</span><span class="p">)),</span>  <span class="c1"># Ajuste del eje x</span>
        <span class="n">xaxis_title</span><span class="o">=</span><span class="s1">&#39;Fecha&#39;</span><span class="p">,</span>  <span class="c1"># Título del eje x</span>
        <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;Anomalía de temperatura (°C)&#39;</span><span class="p">,</span>  <span class="c1"># Título del eje y</span>
        <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Gráfico de entrenamiento, prueba y pronóstico&#39;</span><span class="p">,</span>  <span class="c1"># Título general</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Mostrar leyenda</span>
        <span class="n">legend</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>  <span class="c1"># Posición de la leyenda</span>
    <span class="p">)</span>

    <span class="c1"># ____ Configuramos la aplicación__________________________________________________________________________________________________</span>

    <span class="n">app</span> <span class="o">=</span> <span class="n">dash</span><span class="o">.</span><span class="n">Dash</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">app</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
        <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">),</span>
        <span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="s1">&#39;Resumen del modelo ARIMA&#39;</span><span class="p">),</span>
        <span class="n">dash_table</span><span class="o">.</span><span class="n">DataTable</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;table&#39;</span><span class="p">,</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">summary_df</span><span class="o">.</span><span class="n">columns</span><span class="p">],</span>
            <span class="n">data</span><span class="o">=</span><span class="n">summary_df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;records&#39;</span><span class="p">),</span>
            <span class="n">style_table</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;80%&#39;</span><span class="p">,</span> <span class="s1">&#39;margin&#39;</span><span class="p">:</span> <span class="s1">&#39;auto&#39;</span><span class="p">},</span>
            <span class="n">page_size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">summary_df</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="s1">&#39;Precisión de los Pronósticos&#39;</span><span class="p">),</span>
        <span class="n">dash_table</span><span class="o">.</span><span class="n">DataTable</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;accuracy-table&#39;</span><span class="p">,</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">accuracy_df</span><span class="o">.</span><span class="n">columns</span><span class="p">],</span>
            <span class="n">data</span><span class="o">=</span><span class="n">accuracy_df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;records&#39;</span><span class="p">),</span>
            <span class="n">style_table</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;80%&#39;</span><span class="p">,</span> <span class="s1">&#39;margin&#39;</span><span class="p">:</span> <span class="s1">&#39;auto&#39;</span><span class="p">},</span>
            <span class="n">page_size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">accuracy_df</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">])</span>

    <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
        <span class="n">app</span><span class="o">.</span><span class="n">run_server</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="suavizacion-exponencial">
<h1>Suavización exponencial<a class="headerlink" href="#suavizacion-exponencial" title="Permalink to this heading">#</a></h1>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dash</span>
<span class="kn">from</span> <span class="nn">dash</span> <span class="kn">import</span> <span class="n">html</span><span class="p">,</span> <span class="n">dcc</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objs</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.holtwinters</span> <span class="kn">import</span> <span class="n">ExponentialSmoothing</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="c1"># Cargue de datos</span>
<span class="n">timeseries_URL</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/SandraMaldonado19/Dash_PF_Dataviz/main/df_timeseries.csv&quot;</span>
<span class="n">df_tseries</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">timeseries_URL</span><span class="p">)</span>

<span class="c1"># Definimos el conjunto de prueba y de entrenamiento</span>
<span class="n">n_temp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="p">);</span> <span class="n">n_test</span> <span class="o">=</span> <span class="mi">21</span> 
<span class="n">train_size</span> <span class="o">=</span> <span class="n">n_temp</span> <span class="o">-</span> <span class="n">n_test</span>

<span class="n">train</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">dates_train</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">test_21month</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span> 
<span class="n">dates_21month</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span> 

<span class="c1"># Ajustar el modelo de suavización exponencial y obtener el pronóstico</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ExponentialSmoothing</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">trend</span><span class="o">=</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="n">seasonal</span><span class="o">=</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="n">seasonal_periods</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">predicted_values</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">fittedvalues</span>
<span class="n">pred_conf</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">get_prediction</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">))</span><span class="o">.</span><span class="n">conf_int</span><span class="p">()</span>

<span class="c1"># Configuramos la aplicación</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">dash</span><span class="o">.</span><span class="n">Dash</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">app</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
    <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span>
        <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;graph-smoothing&#39;</span><span class="p">,</span>
        <span class="n">figure</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">dates_train</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
                    <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Datos de entrenamiento&#39;</span>
                <span class="p">),</span>
                <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">dates_train</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">predicted_values</span><span class="p">,</span>  <span class="c1"># Usar los valores predichos</span>
                    <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Predicciones&#39;</span>
                <span class="p">),</span>
               <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">dates_train</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">pred_conf</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Límite inferior del intervalo de confianza&#39;</span><span class="p">,</span>
                    <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;rgb(255,165,0)&#39;</span><span class="p">)</span>
                <span class="p">),</span>
                <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">dates_train</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">pred_conf</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
                    <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;tonexty&#39;</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Límite superior del intervalo de confianza&#39;</span><span class="p">,</span>
                    <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;rgb(255,165,0)&#39;</span><span class="p">)</span>
                <span class="p">)</span> 
            <span class="p">],</span>
            <span class="s1">&#39;layout&#39;</span><span class="p">:</span> <span class="n">go</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
                <span class="n">xaxis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Año&#39;</span><span class="p">},</span>
                <span class="n">yaxis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Anomalía de temperatura (°C)&#39;</span><span class="p">},</span>
                <span class="n">autosize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">}</span>
    <span class="p">)</span>
<span class="p">])</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run_server</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="regresion-polinomica">
<h1>Regresión polinómica<a class="headerlink" href="#regresion-polinomica" title="Permalink to this heading">#</a></h1>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dash</span>
<span class="kn">from</span> <span class="nn">dash</span> <span class="kn">import</span> <span class="n">html</span><span class="p">,</span> <span class="n">dcc</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objs</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">from</span> <span class="nn">numpy.polynomial.polynomial</span> <span class="kn">import</span> <span class="n">Polynomial</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="c1"># Cargue de datos</span>
<span class="n">timeseries_URL</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/SandraMaldonado19/Dash_PF_Dataviz/main/df_timeseries.csv&quot;</span>
<span class="n">df_tseries</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">timeseries_URL</span><span class="p">)</span>

<span class="c1"># Definimos el conjunto de prueba y de entrenamiento</span>
<span class="n">n_temp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="p">);</span> <span class="n">n_test</span> <span class="o">=</span> <span class="mi">21</span> 
<span class="n">train_size</span> <span class="o">=</span> <span class="n">n_temp</span> <span class="o">-</span> <span class="n">n_test</span>

<span class="n">train</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">dates_train</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">test_21month</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span> 
<span class="n">dates_21month</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span> 

<span class="c1"># Ajustar el modelo de regresión polinómica y obtener el pronóstico</span>
<span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">)))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">values</span>
<span class="n">degree</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># puedes cambiar el grado del polinomio aquí</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Polynomial</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">degree</span><span class="p">)</span>
<span class="n">predicted_values</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># Configuramos la aplicación</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">dash</span><span class="o">.</span><span class="n">Dash</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">app</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
    <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span>
        <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;graph-smoothing&#39;</span><span class="p">,</span>
        <span class="n">figure</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">dates_train</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">train</span><span class="p">,</span>
                    <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Datos de entrenamiento&#39;</span>
                <span class="p">),</span>
                <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">dates_train</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">predicted_values</span><span class="p">,</span>  <span class="c1"># Usar los valores predichos</span>
                    <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Predicciones&#39;</span>
                <span class="p">)</span>
            <span class="p">],</span>
            <span class="s1">&#39;layout&#39;</span><span class="p">:</span> <span class="n">go</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
                <span class="n">xaxis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Año&#39;</span><span class="p">},</span>
                <span class="n">yaxis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Anomalía de temperatura (°C)&#39;</span><span class="p">},</span>
                <span class="n">autosize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">}</span>
    <span class="p">)</span>
<span class="p">])</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run_server</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="codigo-unificado">
<h1>Código unificado<a class="headerlink" href="#codigo-unificado" title="Permalink to this heading">#</a></h1>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dash</span>
<span class="kn">from</span> <span class="nn">dash</span> <span class="kn">import</span> <span class="n">dcc</span>
<span class="kn">from</span> <span class="nn">dash</span> <span class="kn">import</span> <span class="n">html</span>
<span class="kn">from</span> <span class="nn">dash</span> <span class="kn">import</span> <span class="n">dash_table</span>
<span class="kn">import</span> <span class="nn">dash_bootstrap_components</span> <span class="k">as</span> <span class="nn">dbc</span>
<span class="kn">from</span> <span class="nn">dash.dependencies</span> <span class="kn">import</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Output</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">adfuller</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">acf</span>
<span class="kn">from</span> <span class="nn">plotly.subplots</span> <span class="kn">import</span> <span class="n">make_subplots</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.arima.model</span> <span class="kn">import</span> <span class="n">ARIMA</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.holtwinters</span> <span class="kn">import</span> <span class="n">ExponentialSmoothing</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">process_time</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>


<span class="c1">#____ Cargue de datos___________________________________________________________________________________________________________</span>

<span class="n">timeseries_URL</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/SandraMaldonado19/Dash_PF_Dataviz/main/df_timeseries.csv&quot;</span>
<span class="n">df_tseries</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">timeseries_URL</span><span class="p">)</span>

<span class="c1">#____ Cálculos y funciones______________________________________________________________________________________________________</span>

<span class="c1">#---- Estadístico ADF-----------------------------------------------------------------------------------------------------------</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="n">adf_statistic</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">p_value</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1">#---- Conjuntos de entrenamiento y prueba----------------------------------------------------------------------------------------</span>

<span class="n">n_temp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="p">);</span> <span class="n">n_test</span> <span class="o">=</span> <span class="mi">21</span> 
<span class="n">train_size</span> <span class="o">=</span> <span class="n">n_temp</span> <span class="o">-</span> <span class="n">n_test</span>

<span class="n">train</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">dates_train</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">test_21month</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span> 
<span class="n">dates_21month</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span> 

<span class="n">train_df</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[[</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">test_21month_df</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[[</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span> 


<span class="c1">#----Función para seleccionar el mejor modelo------------------------------------------------------------------------------------</span>
<span class="n">best_aic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
<span class="n">best_bic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

<span class="n">best_order</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_mdl</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">pq_rng</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">d_rng</span>  <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pq_rng</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">d_rng</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">pq_rng</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># print(i, d, j)</span>
                <span class="n">tmp_mdl</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">j</span><span class="p">))</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
                <span class="n">tmp_aic</span> <span class="o">=</span> <span class="n">tmp_mdl</span><span class="o">.</span><span class="n">aic</span>
                <span class="k">if</span> <span class="n">tmp_aic</span> <span class="o">&lt;</span> <span class="n">best_aic</span><span class="p">:</span>
                    <span class="n">best_aic</span> <span class="o">=</span> <span class="n">tmp_aic</span>
                    <span class="n">best_order</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                    <span class="n">best_mdl</span> <span class="o">=</span> <span class="n">tmp_mdl</span>
            <span class="k">except</span><span class="p">:</span> <span class="k">continue</span>

<span class="c1">#----Ajustar el modelo ARIMA y obtener el pronóstico------------------------------------------------------------------------------</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">best_order</span><span class="p">)</span>
<span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">get_prediction</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">),</span> <span class="n">dynamic</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">pred_conf</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">conf_int</span><span class="p">()</span>

<span class="c1"># Extraer los valores predichos</span>
<span class="n">predicted_values</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">predicted_mean</span>

<span class="c1"># Convertir pred_conf a un array de NumPy</span>
<span class="n">pred_conf_np</span> <span class="o">=</span> <span class="n">pred_conf</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># ____Gráficas___________________________________________________________________________________________________________________</span>
<span class="c1">####ARIMA MODEL PREDICTIVE</span>
<span class="c1">###########################</span>
<span class="c1">###########################</span>

<span class="n">grid</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;grid_ARIMA.pkl&quot;</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">grid</span><span class="p">,</span> <span class="n">best_order</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;grid_ARIMA.pkl&#39;</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">))</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="n">time_start</span> <span class="o">=</span> <span class="n">process_time</span><span class="p">()</span>

        <span class="n">best_aic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">best_bic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">best_mdl</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">pq_rng</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">d_rng</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pq_rng</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">d_rng</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">pq_rng</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">tmp_mdl</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
                        <span class="n">tmp_aic</span> <span class="o">=</span> <span class="n">tmp_mdl</span><span class="o">.</span><span class="n">aic</span>
                        <span class="k">if</span> <span class="n">tmp_aic</span> <span class="o">&lt;</span> <span class="n">best_aic</span><span class="p">:</span>
                            <span class="n">best_aic</span> <span class="o">=</span> <span class="n">tmp_aic</span>
                            <span class="n">best_order</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                            <span class="n">best_mdl</span> <span class="o">=</span> <span class="n">tmp_mdl</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">continue</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">best_order</span><span class="p">)</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="n">time_stop</span> <span class="o">=</span> <span class="n">process_time</span><span class="p">()</span>

        <span class="n">str_cpu_time</span> <span class="o">=</span> <span class="s2">&quot;ARIMA CPU time: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">((</span><span class="n">time_stop</span> <span class="o">-</span> <span class="n">time_start</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; minutes&quot;</span>
        <span class="c1"># print(str_cpu_time)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;cpu_time.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">str_cpu_time</span><span class="p">)</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">((</span><span class="n">grid</span><span class="p">,</span> <span class="n">best_order</span><span class="p">),</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;grid_ARIMA.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">))</span>

    <span class="c1"># # ---- Predicciones del modelo-------------------------------------------------------------------------------------------------------</span>
    <span class="c1"># predictions = grid.get_prediction(start=1, end=len(train), dynamic=False)</span>
    <span class="c1"># pred_conf = predictions.conf_int()</span>

    <span class="c1"># # Extraer los valores predichos</span>
    <span class="c1"># predicted_values = predictions.predicted_mean</span>

    <span class="c1"># # Convertir pred_conf a un array de NumPy</span>
    <span class="c1"># pred_conf_np = pred_conf.values</span>

    <span class="n">summary_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_html</span><span class="p">(),</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># ---- Pronósticos ARIMA Rolling-----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">arima_rolling</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">best_order</span><span class="p">):</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)):</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">best_order</span><span class="p">)</span>
            <span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">()</span>
            <span class="n">yhat</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yhat</span><span class="p">)</span>
            <span class="n">obs</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
            <span class="c1">#print(&#39;predicted=%f, expected=%f&#39; % (yhat, obs))</span>
        <span class="k">return</span> <span class="n">predictions</span>

    <span class="c1"># Calcular los pronósticos con arima_rolling</span>
    <span class="n">test_21</span> <span class="o">=</span> <span class="n">test_21month</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">yhat_21</span> <span class="o">=</span> <span class="n">arima_rolling</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">test_21</span><span class="p">,</span> <span class="n">best_order</span><span class="p">)</span>

    <span class="c1"># ---- Cálculo del error de predicción -----------------------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">forecast_accuracy</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span> <span class="n">str_name</span><span class="p">):</span>
        <span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">actual</span><span class="p">))</span>  <span class="c1"># MAPE</span>
        <span class="n">mae</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">))</span>  <span class="c1"># MAE</span>
        <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>  <span class="c1"># RMSE</span>
        <span class="n">mse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># MSE</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">actual</span><span class="p">)</span>

        <span class="n">df_acc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mae</span><span class="p">],</span>
                               <span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mse</span><span class="p">],</span>
                               <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mape</span><span class="p">],</span>
                               <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmse</span><span class="p">],</span>
                               <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">r2</span><span class="p">]},</span>
                              <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">str_name</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">df_acc</span>

    <span class="n">accuracy_df</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yhat_21</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">test_21</span><span class="p">),</span> <span class="s2">&quot;21 meses&quot;</span><span class="p">)</span>

    <span class="c1"># ----Figuras pronóstico ARIMA -------------------------------------------------------------------------------------------------------</span>

    <span class="n">fig1</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">line</span><span class="p">()</span>
    <span class="n">fig1</span><span class="o">.</span><span class="n">add_scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dates_train</span><span class="p">[</span><span class="o">-</span><span class="mi">120</span><span class="p">:],</span> <span class="n">y</span><span class="o">=</span><span class="n">train</span><span class="p">[</span><span class="o">-</span><span class="mi">120</span><span class="p">:],</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Entrenamiento&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">))</span>
    <span class="n">fig1</span><span class="o">.</span><span class="n">add_scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dates_21month</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">test_21</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Prueba&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">))</span>
    <span class="n">fig1</span><span class="o">.</span><span class="n">add_scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dates_21month</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">yhat_21</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Pronóstico&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">))</span>

    <span class="c1"># Configuración adicional del diseño</span>
    <span class="n">fig1</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">tickmode</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">dtick</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">4</span><span class="p">)),</span>  <span class="c1"># Ajuste del eje x</span>
        <span class="n">xaxis_title</span><span class="o">=</span><span class="s1">&#39;Fecha&#39;</span><span class="p">,</span>  <span class="c1"># Título del eje x</span>
        <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;Anomalía de temperatura (°C)&#39;</span><span class="p">,</span>  <span class="c1"># Título del eje y</span>
        <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Gráfico de entrenamiento, prueba y pronóstico&#39;</span><span class="p">,</span>  <span class="c1"># Título general</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Mostrar leyenda</span>
        <span class="n">legend</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>  <span class="c1"># Posición de la leyenda</span>
    <span class="p">)</span>

<span class="c1">####### END ARIMA MODEL PREDICTIVE#########</span>




<span class="c1">#----- Autocorrelación-----------------------------------------------------------------------------------------------------------</span>

<span class="c1"># Crear una figura con subplots</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Agregar los gráficos a los subplots correspondientes</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">),</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hovertemplate</span><span class="o">=</span><span class="s1">&#39;Value: %</span><span class="si">{y}</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">diff</span><span class="p">(),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">),</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hovertemplate</span><span class="o">=</span><span class="s1">&#39;Diff: %</span><span class="si">{y}</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">(),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">),</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hovertemplate</span><span class="o">=</span><span class="s1">&#39;Diff Diff: %</span><span class="si">{y}</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Para agregar los gráficos de autocorrelación, se necesita calcular los valores de autocorrelación</span>
<span class="n">acf_values</span> <span class="o">=</span> <span class="n">acf</span><span class="p">(</span><span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">nlags</span><span class="o">=</span><span class="mi">2080</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">acf_values</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;tozeroy&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">),</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hovertemplate</span><span class="o">=</span><span class="s1">&#39;ACF: %</span><span class="si">{y}</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">diff1_values</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
<span class="n">acf_diff1_values</span> <span class="o">=</span> <span class="n">acf</span><span class="p">(</span><span class="n">diff1_values</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">nlags</span><span class="o">=</span><span class="mi">2080</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">acf_diff1_values</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;tozeroy&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">),</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hovertemplate</span><span class="o">=</span><span class="s1">&#39;ACF Diff: %</span><span class="si">{y}</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">diff2_values</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
<span class="n">acf_diff2_values</span> <span class="o">=</span> <span class="n">acf</span><span class="p">(</span><span class="n">diff2_values</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">nlags</span><span class="o">=</span><span class="mi">2080</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">acf_diff2_values</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;tozeroy&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">),</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hovertemplate</span><span class="o">=</span><span class="s1">&#39;ACF Diff Diff: %</span><span class="si">{y}</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>


<span class="c1"># Agregar títulos a las gráficas</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_annotation</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;Serie original&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.20</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">xref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span> <span class="n">yref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span> <span class="n">showarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_annotation</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;1er Orden de diferenciación&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.66</span><span class="p">,</span> <span class="n">xref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span> <span class="n">yref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span> <span class="n">showarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_annotation</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;2do Orden de diferenciación&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">xref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span> <span class="n">yref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span> <span class="n">showarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)))</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_annotation</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;ACF de la Serie original&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">xref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span> <span class="n">yref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span> <span class="n">showarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_annotation</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;ACF del 1er Orden de diferenciación&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.88</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.66</span><span class="p">,</span> <span class="n">xref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span> <span class="n">yref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span> <span class="n">showarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_annotation</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;ACF del 2do Orden de diferenciación&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.88</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">xref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span> <span class="n">yref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span> <span class="n">showarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)))</span>


<span class="c1">#-----Media móvil-----------------------------------------------------------------------------------------------------------</span>

<span class="c1">## En este código &#39;1.96&#39; es el valor z para un intervalo de confianza del 95%.</span>

<span class="c1"># Función para calcular la media móvil y el intervalo de confianza</span>
<span class="k">def</span> <span class="nf">calculate_rolling_mean</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">num_of_std</span><span class="o">=</span><span class="mf">1.96</span><span class="p">):</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rolling_mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window_size</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rolling_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window_size</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;upper_band&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rolling_mean&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rolling_std&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_of_std</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;lower_band&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rolling_mean&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rolling_std&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_of_std</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="c1"># Orden de los meses</span>
<span class="n">month_order</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;january&#39;</span><span class="p">,</span> <span class="s1">&#39;february&#39;</span><span class="p">,</span> <span class="s1">&#39;march&#39;</span><span class="p">,</span> <span class="s1">&#39;april&#39;</span><span class="p">,</span> <span class="s1">&#39;may&#39;</span><span class="p">,</span> <span class="s1">&#39;june&#39;</span><span class="p">,</span> <span class="s1">&#39;july&#39;</span><span class="p">,</span> <span class="s1">&#39;august&#39;</span><span class="p">,</span> <span class="s1">&#39;september&#39;</span><span class="p">,</span> <span class="s1">&#39;october&#39;</span><span class="p">,</span> <span class="s1">&#39;november&#39;</span><span class="p">,</span> <span class="s1">&#39;december&#39;</span><span class="p">]</span>
<span class="c1"># Pivotar los datos para tener años en el eje x, meses en el eje y</span>
<span class="n">heatmap_data</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
<span class="c1"># Configurar el orden de los meses en el eje y</span>
<span class="n">heatmap_data</span> <span class="o">=</span> <span class="n">heatmap_data</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">month_order</span><span class="p">)</span>


<span class="c1"># Convertir la columna &#39;date&#39; a tipo datetime si aún no lo está</span>
<span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>
<span class="c1"># Agregar una columna &#39;decade&#39; para agrupar por década</span>
<span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;decade&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">//</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span>
<span class="c1"># Agregar una columna &#39;color&#39; basada en la condición de la anomalía</span>
<span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>

<span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
<span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>
<span class="c1"># Encuentra los tres años más cálidos, excluyendo el año actual</span>
<span class="n">current_year</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span>
<span class="n">top_years</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[</span><span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">current_year</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>
<span class="c1"># Encuentra los valores máximos para cada mes</span>
<span class="n">max_values</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">)[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>


<span class="c1">#____Configuración de la aplicación_____________________________________________________________________________________________</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">dash</span><span class="o">.</span><span class="n">Dash</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">suppress_callback_exceptions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">app</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
    <span class="n">dcc</span><span class="o">.</span><span class="n">Location</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">html</span><span class="o">.</span><span class="n">Main</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;display&#39;</span><span class="p">:</span><span class="s1">&#39;grid&#39;</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">:</span><span class="s1">&#39;100%&#39;</span><span class="p">,</span><span class="s1">&#39;minHeight&#39;</span><span class="p">:</span><span class="s1">&#39;100vh&#39;</span><span class="p">,</span><span class="s1">&#39;gridTemplateColumns&#39;</span><span class="p">:</span> <span class="s1">&#39;50vh 1fr&#39;</span><span class="p">,</span> <span class="s1">&#39;gridTemplateRows&#39;</span><span class="p">:</span> <span class="s1">&#39;50px 1fr 30px&#39;</span><span class="p">,</span> <span class="p">},</span> <span class="n">children</span><span class="o">=</span><span class="p">[</span>
       
        <span class="n">html</span><span class="o">.</span><span class="n">Nav</span><span class="p">(</span><span class="n">className</span><span class="o">=</span><span class="s1">&#39;nav&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;display&#39;</span><span class="p">:</span><span class="s1">&#39;fixed&#39;</span><span class="p">,</span><span class="s1">&#39;gridArea&#39;</span><span class="p">:</span><span class="s1">&#39;nav&#39;</span><span class="p">,</span> <span class="s1">&#39;gridColumnStart&#39;</span><span class="p">:</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;gridColumnEnd&#39;</span><span class="p">:</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;gridRowStart&#39;</span><span class="p">:</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;gridRowEnd&#39;</span><span class="p">:</span><span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="s1">&#39;border&#39;</span><span class="p">:</span><span class="s1">&#39;1px solid #cbc4ad&#39;</span><span class="p">,</span> <span class="s1">&#39;borderRadius&#39;</span><span class="p">:</span><span class="s1">&#39;5px&#39;</span><span class="p">,</span> <span class="s1">&#39;padding&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">},</span> <span class="n">children</span><span class="o">=</span><span class="p">[</span>
            <span class="n">html</span><span class="o">.</span><span class="n">H1</span><span class="p">(</span><span class="s1">&#39;Anomalia de Temperatura de Superficie Global&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;marginBottom&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span> <span class="s1">&#39;fontSize&#39;</span><span class="p">:</span><span class="s1">&#39;1.5rem&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span><span class="s1">&#39;center&#39;</span><span class="p">}),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="s1">&#39;¿Cuáles han sido las variaciones más significativas de la temperatura de la superficie global a lo largo del tiempo?&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;marginBottom&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span> <span class="s1">&#39;fontSize&#39;</span><span class="p">:</span><span class="s1">&#39;1rem&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span><span class="s1">&#39;left&#39;</span><span class="p">}),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">H3</span><span class="p">(</span><span class="s1">&#39;¿Aumentará la temperatura los próximos meses?&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#de3100&#39;</span><span class="p">,</span> <span class="s1">&#39;marginBottom&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span> <span class="s1">&#39;fontSize&#39;</span><span class="p">:</span><span class="s1">&#39;1rem&#39;</span><span class="p">,</span><span class="s1">&#39;fontWeight&#39;</span><span class="p">:</span><span class="s1">&#39;900&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span><span class="s1">&#39;left&#39;</span><span class="p">}),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">Ul</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;display&#39;</span><span class="p">:</span> <span class="s1">&#39;flex&#39;</span><span class="p">,</span> <span class="s1">&#39;justifyContent&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="s1">&#39;flexDirection&#39;</span><span class="p">:</span><span class="s1">&#39;column&#39;</span><span class="p">,</span> <span class="s1">&#39;alignItems&#39;</span><span class="p">:</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span><span class="s1">&#39;100%&#39;</span><span class="p">,</span><span class="s1">&#39;margin&#39;</span><span class="p">:</span><span class="s1">&#39;10px 0&#39;</span><span class="p">,</span><span class="s1">&#39;padding&#39;</span><span class="p">:</span><span class="s1">&#39;0&#39;</span><span class="p">},</span><span class="n">children</span> <span class="o">=</span><span class="p">[</span>
                <span class="n">dcc</span><span class="o">.</span><span class="n">Link</span><span class="p">(</span><span class="s1">&#39;Inicio&#39;</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="s1">&#39;fontSize&#39;</span><span class="p">:</span> <span class="s1">&#39;15px&#39;</span><span class="p">,</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;80%&#39;</span><span class="p">,</span><span class="s1">&#39;marginBottom&#39;</span><span class="p">:</span><span class="s1">&#39;8px&#39;</span><span class="p">,</span> <span class="s1">&#39;textDecoration&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;padding&#39;</span><span class="p">:</span> <span class="s1">&#39;10px&#39;</span><span class="p">,</span> <span class="s1">&#39;borderRadius&#39;</span><span class="p">:</span> <span class="s1">&#39;5px&#39;</span><span class="p">,</span> <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;#ffa888&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">}),</span>
                <span class="n">dcc</span><span class="o">.</span><span class="n">Link</span><span class="p">(</span><span class="s1">&#39;Serie de tiempo&#39;</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="s1">&#39;/time-series&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;80%&#39;</span><span class="p">,</span><span class="s1">&#39;marginBottom&#39;</span><span class="p">:</span><span class="s1">&#39;8px&#39;</span><span class="p">,</span>  <span class="s1">&#39;fontSize&#39;</span><span class="p">:</span> <span class="s1">&#39;15px&#39;</span><span class="p">,</span> <span class="s1">&#39;textDecoration&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;padding&#39;</span><span class="p">:</span> <span class="s1">&#39;10px&#39;</span><span class="p">,</span> <span class="s1">&#39;borderRadius&#39;</span><span class="p">:</span> <span class="s1">&#39;5px&#39;</span><span class="p">,</span> <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;#ffa888&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">}),</span>
                <span class="n">dcc</span><span class="o">.</span><span class="n">Link</span><span class="p">(</span><span class="s1">&#39;Modelo Predictivo&#39;</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="s1">&#39;/predictive-model&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;80%&#39;</span><span class="p">,</span><span class="s1">&#39;marginBottom&#39;</span><span class="p">:</span><span class="s1">&#39;8px&#39;</span><span class="p">,</span>  <span class="s1">&#39;fontSize&#39;</span><span class="p">:</span> <span class="s1">&#39;15px&#39;</span><span class="p">,</span> <span class="s1">&#39;textDecoration&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;padding&#39;</span><span class="p">:</span> <span class="s1">&#39;10px&#39;</span><span class="p">,</span> <span class="s1">&#39;borderRadius&#39;</span><span class="p">:</span> <span class="s1">&#39;5px&#39;</span><span class="p">,</span> <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;#ffa888&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">}),</span>

            <span class="p">]),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;explain-content&#39;</span><span class="p">)</span>
        <span class="p">]),</span>

        <span class="n">html</span><span class="o">.</span><span class="n">Section</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;page-content&#39;</span><span class="p">,</span> <span class="n">className</span><span class="o">=</span><span class="s1">&#39;section&#39;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;gridArea&#39;</span><span class="p">:</span><span class="s1">&#39;section&#39;</span><span class="p">,</span> <span class="s1">&#39;gridColumnStart&#39;</span><span class="p">:</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;gridColumnEnd&#39;</span><span class="p">:</span><span class="s1">&#39;4&#39;</span><span class="p">,</span><span class="s1">&#39;gridRowStart&#39;</span><span class="p">:</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;gridRowEnd&#39;</span><span class="p">:</span><span class="s1">&#39;5&#39;</span><span class="p">,</span><span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="s1">&#39;border&#39;</span><span class="p">:</span><span class="s1">&#39;1px solid #cbc4ad&#39;</span><span class="p">,</span> <span class="s1">&#39;borderRadius&#39;</span><span class="p">:</span><span class="s1">&#39;5px&#39;</span><span class="p">,</span> <span class="s1">&#39;padding&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">}),</span>
    <span class="p">]),</span>
<span class="p">])</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="s1">&#39;explain-content&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
              <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="s1">&#39;pathname&#39;</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">display_page</span><span class="p">(</span><span class="n">pathname</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">pathname</span> <span class="o">==</span> <span class="s1">&#39;/time-series&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">()</span> 
    <span class="k">elif</span> <span class="n">pathname</span> <span class="o">==</span> <span class="s1">&#39;/predictive-model&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">)</span>
      
<span class="c1"># Update the index</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="s1">&#39;page-content&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
              <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="s1">&#39;pathname&#39;</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">display_page</span><span class="p">(</span><span class="n">pathname</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">pathname</span> <span class="o">==</span> <span class="s1">&#39;/time-series&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
                 <span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="s1">&#39;Serie de tiempo - Anomalía de Temperatura Global (1850 - 2023)&#39;</span><span class="p">),</span>
                <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;timeseries-graph&#39;</span><span class="p">),</span>
                <span class="p">]),</span>
                <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
                    <span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="s2">&quot; Boxplot - Variación mensual multianual (1850 - 2023)&quot;</span><span class="p">,),</span>
                    <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;boxplot&#39;</span><span class="p">)]),</span>
                <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
                    <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
                        <span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="s2">&quot;Heatmap- Exploración de patrones y tendencias&quot;</span><span class="p">),</span>
                        <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;heatmap&#39;</span><span class="p">),]),</span>
                    <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
                        <span class="n">html</span><span class="o">.</span><span class="n">H1</span><span class="p">(</span><span class="s2">&quot;Barplot - Promedios Decenales de Anomalías de Temperatura&quot;</span><span class="p">),</span>
                        <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;bar-chart&#39;</span><span class="p">),</span>
                    <span class="p">])</span>
                <span class="p">]),</span>
                <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
                    <span class="n">dcc</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
                        <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;year-picker&#39;</span><span class="p">,</span>
                        <span class="n">options</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()],</span>
                        <span class="n">value</span><span class="o">=</span><span class="p">[</span><span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span>
                        <span class="n">multi</span><span class="o">=</span><span class="kc">True</span>
                    <span class="p">),</span>
                     <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;temperature-graph&#39;</span><span class="p">)</span>
                <span class="p">]),</span> 
                    <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
                        <span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="s2">&quot;Análisis de estacionariedad&quot;</span><span class="p">,),</span>
                        <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;output-container&#39;</span><span class="p">,</span> <span class="n">children</span><span class="o">=</span><span class="p">[</span>

                        <span class="p">]),</span>
                <span class="p">]),</span>
            <span class="p">)</span>
    <span class="k">elif</span> <span class="n">pathname</span> <span class="o">==</span> <span class="s1">&#39;/predictive-model&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
                <span class="n">dbc</span><span class="o">.</span><span class="n">Row</span><span class="p">([</span>
                    <span class="n">dbc</span><span class="o">.</span><span class="n">Col</span><span class="p">([</span>
                        <span class="n">dcc</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
                            <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;mi-dropdown&#39;</span><span class="p">,</span>
                            <span class="n">options</span><span class="o">=</span><span class="p">[</span>
                                <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;ARIMA&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">},</span>
                                <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Suavización exponencial&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;2&#39;</span><span class="p">},</span>
                                <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Regresión polinomial&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;3&#39;</span><span class="p">}</span>
                            <span class="p">],</span>
                            <span class="n">value</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                            <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;70%&#39;</span><span class="p">,</span> <span class="s1">&#39;marginLeft&#39;</span><span class="p">:</span> <span class="s1">&#39;15%&#39;</span><span class="p">}</span>
                        <span class="p">)</span>
                    <span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">className</span><span class="o">=</span><span class="s1">&#39;my-4&#39;</span><span class="p">)</span>
                <span class="p">]),</span>
                <span class="n">html</span><span class="o">.</span><span class="n">H1</span><span class="p">(</span><span class="s2">&quot;Serie de tiempo: Anomalía de temperatura (°C)&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">}),</span>
            <span class="p">]),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;graph&#39;</span><span class="p">,</span> <span class="n">children</span><span class="o">=</span><span class="p">[</span>
               
            <span class="p">]),</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">html</span><span class="o">.</span><span class="n">H4</span><span class="p">(</span><span class="s1">&#39;Sobre el conjunto de datos&#39;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontSize&#39;</span><span class="p">:</span><span class="s1">&#39;1rem&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span><span class="s1">&#39;left&#39;</span><span class="p">}),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="s1">&#39;Presentamos el análisis de un conjunto de datos llamado HadCRUT5, que mide los cambios de temperatura cercana a la superficie en todo el mundo, entre 1850 a 2018. HadCRUT5 presenta anomalías mensuales promedio de temperatura cercana a la superficie, en relación con el período 1961–1990.&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontSize&#39;</span><span class="p">:</span><span class="s1">&#39;0.8rem&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="s1">&#39;lineHeight&#39;</span><span class="p">:</span><span class="s1">&#39;150%&#39;</span><span class="p">}),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="s1">&#39;En general, este conjunto de datos muestra un aumento del calentamiento promedio global desde mediados del siglo 19 y en los últimos años, en consonancia con otros análisis. Este fenómeno se debe a múltiples factores, incluidos una mejor representación del calentamiento del Ártico y una mejor comprensión de los sesgos en evolución en las mediciones sobre la superficie del mar y la tierra.&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontSize&#39;</span><span class="p">:</span><span class="s1">&#39;0.8rem&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="s1">&#39;lineHeight&#39;</span><span class="p">:</span><span class="s1">&#39;150%&#39;</span><span class="p">}),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="s1">&#39;Para revisar a detalle el proceso de obtención y procesamiento de los datos, visite la información de referencia. &#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontSize&#39;</span><span class="p">:</span><span class="s1">&#39;0.8rem&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="s1">&#39;lineHeight&#39;</span><span class="p">:</span><span class="s1">&#39;150%&#39;</span><span class="p">}),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="s1">&#39;Morice, C. P., Kennedy, J. J., Rayner, N. A., Winn, J. P., Hogan, E., Killick, R. E., Dunn, R. J. H., Osborn, T. J., Jones, P. D., &amp; Simpson, I. R. (2021). An Updated Assessment of Near-Surface Temperature Change From 1850: The HadCRUT5 Data Set. Journal of Geophysical Research: Atmospheres, 126(3), e2019JD032361. https://doi.org/10.1029/2019JD032361&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontSize&#39;</span><span class="p">:</span><span class="s1">&#39;0.8rem&#39;</span><span class="p">,</span> <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="s1">&#39;lineHeight&#39;</span><span class="p">:</span><span class="s1">&#39;150%&#39;</span><span class="p">}),</span>
        <span class="p">)</span>


<span class="c1"># Definir serie de tiempo</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="s1">&#39;timeseries-graph&#39;</span><span class="p">,</span> <span class="s1">&#39;figure&#39;</span><span class="p">),</span>
              <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s1">&#39;timeseries-graph&#39;</span><span class="p">,</span> <span class="s1">&#39;hoverData&#39;</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">update_graph</span><span class="p">(</span><span class="n">hoverData</span><span class="p">):</span>
    <span class="c1"># Calcular la media móvil y el intervalo de confianza</span>
    <span class="n">df_timeseries</span> <span class="o">=</span> <span class="n">calculate_rolling_mean</span><span class="p">(</span><span class="n">df_tseries</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>  <span class="c1"># Asegúrate de tener una copia del DataFrame original</span>
    <span class="n">trace_data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Agregar la serie temporal original</span>
    <span class="n">trace_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span>
        <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;line&#39;</span><span class="p">,</span>
        <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;lines&#39;</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Serie de tiempo&#39;</span><span class="p">,</span>
        <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">}</span>
    <span class="p">})</span>

    <span class="c1"># Agregar la media móvil</span>
    <span class="n">trace_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span>
        <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;rolling_mean&#39;</span><span class="p">],</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;line&#39;</span><span class="p">,</span>
        <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;lines&#39;</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Media móvil de 12 meses&#39;</span><span class="p">,</span>
        <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">}</span>
    <span class="p">})</span>

    <span class="c1"># Agregar el intervalo de confianza</span>
    <span class="n">trace_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span>
        <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;upper_band&#39;</span><span class="p">],</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;line&#39;</span><span class="p">,</span>
        <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;lines&#39;</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;IC - 95%&#39;</span><span class="p">,</span>
        <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;dash&#39;</span><span class="p">:</span> <span class="s1">&#39;dash&#39;</span><span class="p">}</span>
    <span class="p">})</span>

    <span class="n">trace_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span>
        <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;lower_band&#39;</span><span class="p">],</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;line&#39;</span><span class="p">,</span>
        <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;lines&#39;</span><span class="p">,</span>
        <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;dash&#39;</span><span class="p">:</span> <span class="s1">&#39;dash&#39;</span><span class="p">}</span>
    <span class="p">})</span>

    <span class="c1"># Marcar la media correspondiente al año cuando se pasa el ratón sobre la gráfica</span>
    <span class="k">if</span> <span class="n">hoverData</span><span class="p">:</span>
        <span class="n">year_hovered</span> <span class="o">=</span> <span class="n">hoverData</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">mean_value</span> <span class="o">=</span> <span class="n">df_timeseries</span><span class="p">[</span><span class="n">df_timeseries</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">year_hovered</span><span class="p">)][</span><span class="s1">&#39;rolling_mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">trace_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">hoverData</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mean_value</span><span class="p">],</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;scatter&#39;</span><span class="p">,</span>
            <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;markers&#39;</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Mean </span><span class="si">{</span><span class="n">year_hovered</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
            <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Mean </span><span class="si">{</span><span class="n">year_hovered</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="p">})</span>

    <span class="n">figure</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">trace_data</span><span class="p">,</span>
        <span class="s1">&#39;layout&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;xaxis&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Fecha&#39;</span><span class="p">},</span>
            <span class="s1">&#39;yaxis&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Anomalía de temperatura (°C)&#39;</span><span class="p">},</span>
            <span class="s1">&#39;margin&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">},</span>
            <span class="s1">&#39;legend&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">figure</span>

<span class="c1"># Callback boxplot</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="s1">&#39;boxplot&#39;</span><span class="p">,</span> <span class="s1">&#39;figure&#39;</span><span class="p">),</span>
              <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s1">&#39;boxplot&#39;</span><span class="p">,</span> <span class="s1">&#39;hoverData&#39;</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">update_boxplot</span><span class="p">(</span><span class="n">hoverData</span><span class="p">):</span>
    <span class="c1"># Crear el boxplot con Plotly Graph Objects</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

    <span class="c1"># Agregar boxplots para cada mes</span>
    <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[</span><span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">month</span><span class="p">]</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">month</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

    <span class="c1"># Agregar la línea de tendencia (media multianual)</span>
    <span class="n">trend_line</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">)[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    
    <span class="c1"># Ordenar los datos por el orden de los meses</span>
    <span class="n">ordered_months</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;january&#39;</span><span class="p">,</span> <span class="s1">&#39;february&#39;</span><span class="p">,</span> <span class="s1">&#39;march&#39;</span><span class="p">,</span> <span class="s1">&#39;april&#39;</span><span class="p">,</span> <span class="s1">&#39;may&#39;</span><span class="p">,</span> <span class="s1">&#39;june&#39;</span><span class="p">,</span> <span class="s1">&#39;july&#39;</span><span class="p">,</span> <span class="s1">&#39;august&#39;</span><span class="p">,</span> <span class="s1">&#39;september&#39;</span><span class="p">,</span> <span class="s1">&#39;october&#39;</span><span class="p">,</span> <span class="s1">&#39;november&#39;</span><span class="p">,</span> <span class="s1">&#39;december&#39;</span><span class="p">]</span>
    <span class="n">trend_line</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">trend_line</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">],</span> <span class="n">categories</span><span class="o">=</span><span class="n">ordered_months</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">trend_line</span> <span class="o">=</span> <span class="n">trend_line</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">trend_line</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">trend_line</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
                             <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">dash</span><span class="o">=</span><span class="s1">&#39;dash&#39;</span><span class="p">),</span>
                             <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Media Multianual&#39;</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

    <span class="c1"># Ajustar el diseño del gráfico</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">xaxis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Mes&#39;</span><span class="p">,</span> <span class="s1">&#39;tickmode&#39;</span><span class="p">:</span> <span class="s1">&#39;array&#39;</span><span class="p">,</span> <span class="s1">&#39;tickvals&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">)),</span> <span class="s1">&#39;ticktext&#39;</span><span class="p">:</span> <span class="n">ordered_months</span><span class="p">},</span> <span class="n">yaxis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Anomalía de Temperatura (°C)&#39;</span><span class="p">},</span>
                      <span class="n">boxmode</span><span class="o">=</span><span class="s1">&#39;group&#39;</span><span class="p">)</span>  <span class="c1"># Para agrupar los boxplots en el eje x</span>

    <span class="k">return</span> <span class="n">fig</span>

<span class="c1"># Callback heatmap</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="s1">&#39;heatmap&#39;</span><span class="p">,</span> <span class="s1">&#39;figure&#39;</span><span class="p">),</span>
              <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s1">&#39;heatmap&#39;</span><span class="p">,</span> <span class="s1">&#39;hoverData&#39;</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">update_heatmap</span><span class="p">(</span><span class="n">hoverData</span><span class="p">):</span>
    <span class="c1"># Crear el mapa de calor con Plotly Graph Objects</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

    <span class="c1"># Añadir el mapa de calor</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">heatmap_data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">heatmap_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">heatmap_data</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                             <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Anomalía de Temperatura&#39;</span><span class="p">),</span> <span class="n">reversescale</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="c1"># Ajustar el diseño del gráfico</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">xaxis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Año&#39;</span><span class="p">},</span> <span class="n">yaxis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Mes&#39;</span><span class="p">,</span> <span class="s1">&#39;categoryorder&#39;</span><span class="p">:</span> <span class="s1">&#39;array&#39;</span><span class="p">,</span> <span class="s1">&#39;categoryarray&#39;</span><span class="p">:</span> <span class="n">month_order</span><span class="p">})</span>

    <span class="k">return</span> <span class="n">fig</span>

<span class="c1"># Callback bar-chart</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="s1">&#39;bar-chart&#39;</span><span class="p">,</span> <span class="s1">&#39;figure&#39;</span><span class="p">),</span>
              <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s1">&#39;bar-chart&#39;</span><span class="p">,</span> <span class="s1">&#39;hoverData&#39;</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">update_bar_chart</span><span class="p">(</span><span class="n">hoverData</span><span class="p">):</span>
    <span class="c1"># Calcular los promedios decenales</span>
    <span class="n">decade_means</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;decade&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;first&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

    <span class="c1"># Crear el gráfico de barras con Plotly Express</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">decade_means</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;decade&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;color&#39;</span><span class="p">,</span>
                 <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;Anomalía de Temperatura (°C)&#39;</span><span class="p">},</span> 
                 <span class="n">color_discrete_map</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;red&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">})</span>

    <span class="c1"># Modificar las etiquetas de los ticks en el eje x</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">tickmode</span><span class="o">=</span><span class="s1">&#39;array&#39;</span><span class="p">,</span>
            <span class="n">tickvals</span><span class="o">=</span><span class="n">decade_means</span><span class="p">[</span><span class="s1">&#39;decade&#39;</span><span class="p">],</span>
            <span class="n">ticktext</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">decade</span><span class="si">}</span><span class="s2">s&quot;</span> <span class="k">for</span> <span class="n">decade</span> <span class="ow">in</span> <span class="n">decade_means</span><span class="p">[</span><span class="s1">&#39;decade&#39;</span><span class="p">]]</span>
        <span class="p">),</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span>

<span class="c1"># Callback año máximo</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;temperature-graph&#39;</span><span class="p">,</span> <span class="s1">&#39;figure&#39;</span><span class="p">),</span>
    <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s1">&#39;year-picker&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)]</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">update_figure</span><span class="p">(</span><span class="n">selected_years</span><span class="p">):</span>
    <span class="n">traces</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">markers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;circle&#39;</span><span class="p">,</span> <span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="s1">&#39;diamond&#39;</span><span class="p">,</span> <span class="s1">&#39;cross&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">]</span>

    <span class="c1"># Añade las líneas para los años más cálidos</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">top_years</span><span class="p">):</span>
        <span class="n">df_year</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[</span><span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">year</span><span class="p">]</span>
        <span class="n">traces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">df_year</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">],</span>
            <span class="n">y</span><span class="o">=</span><span class="n">df_year</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines+markers&#39;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">),</span>
            <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">symbol</span><span class="o">=</span><span class="n">markers</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">markers</span><span class="p">)],</span>
                <span class="n">size</span><span class="o">=</span><span class="mi">10</span>
            <span class="p">)</span>
        <span class="p">))</span>

    <span class="c1"># Añade las líneas para los años seleccionados</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">selected_year</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">selected_years</span><span class="p">):</span>
        <span class="n">df_selected</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[</span><span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">selected_year</span><span class="p">]</span>
        <span class="n">traces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">df_selected</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">],</span>
            <span class="n">y</span><span class="o">=</span><span class="n">df_selected</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines+markers&#39;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">selected_year</span><span class="p">),</span>
            <span class="n">line</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
            <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">symbol</span><span class="o">=</span><span class="n">markers</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">top_years</span><span class="p">))</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">markers</span><span class="p">)],</span>
                <span class="n">size</span><span class="o">=</span><span class="mi">10</span>
            <span class="p">)</span>
        <span class="p">))</span>

    <span class="c1"># Añade la línea para los valores máximos</span>
    <span class="n">traces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">max_values</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Máximo histórico (1850 - 2022)&#39;</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;darkgrey&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">}</span>
    <span class="p">))</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">traces</span><span class="p">,</span>
        <span class="s1">&#39;layout&#39;</span><span class="p">:</span> <span class="n">go</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
            <span class="n">xaxis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Mes&#39;</span><span class="p">,</span> <span class="s1">&#39;tickvals&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">)),</span> <span class="s1">&#39;ticktext&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Enero&#39;</span><span class="p">,</span> <span class="s1">&#39;Febrero&#39;</span><span class="p">,</span> <span class="s1">&#39;Marzo&#39;</span><span class="p">,</span> <span class="s1">&#39;Abril&#39;</span><span class="p">,</span> <span class="s1">&#39;Mayo&#39;</span><span class="p">,</span> <span class="s1">&#39;Junio&#39;</span><span class="p">,</span> <span class="s1">&#39;Julio&#39;</span><span class="p">,</span> <span class="s1">&#39;Agosto&#39;</span><span class="p">,</span> <span class="s1">&#39;Septiembre&#39;</span><span class="p">,</span> <span class="s1">&#39;Octubre&#39;</span><span class="p">,</span> <span class="s1">&#39;Noviembre&#39;</span><span class="p">,</span> <span class="s1">&#39;Diciembre&#39;</span><span class="p">]},</span>
            <span class="n">yaxis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Anomalía de temperatura (°C)&#39;</span><span class="p">},</span>
            <span class="n">hovermode</span><span class="o">=</span><span class="s1">&#39;closest&#39;</span>
        <span class="p">)</span>
    <span class="p">}</span>

<span class="c1">#Callback verificación de estacionariedad</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;output-container&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s1">&#39;output-container&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)]</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">update_output</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    
        <span class="k">return</span> <span class="p">(</span><span class="n">dbc</span><span class="o">.</span><span class="n">Container</span><span class="p">([</span>
            <span class="n">dbc</span><span class="o">.</span><span class="n">Row</span><span class="p">([</span>
                <span class="n">dbc</span><span class="o">.</span><span class="n">Col</span><span class="p">([</span>
                    <span class="n">dbc</span><span class="o">.</span><span class="n">Card</span><span class="p">([</span>
                        <span class="n">dbc</span><span class="o">.</span><span class="n">CardBody</span><span class="p">([</span>
                            <span class="n">html</span><span class="o">.</span><span class="n">H3</span><span class="p">(</span><span class="s2">&quot;ADF test&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;font-family&#39;</span><span class="p">:</span> <span class="s1">&#39;Arial&#39;</span><span class="p">}),</span>
                            <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estadística ADF: </span><span class="si">{</span><span class="nb">format</span><span class="p">(</span><span class="n">adf_statistic</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.3f&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> &gt; -3.4&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;font-family&#39;</span><span class="p">:</span> <span class="s1">&#39;Arial&#39;</span><span class="p">}),</span>
                            <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Valor p: </span><span class="si">{</span><span class="nb">format</span><span class="p">(</span><span class="n">p_value</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.3f&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> &gt; 0.05&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;font-family&#39;</span><span class="p">:</span> <span class="s1">&#39;Arial&#39;</span><span class="p">}),</span>
                            <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="s1">&#39;Se acepta de hipótesis nula&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;font-family&#39;</span><span class="p">:</span> <span class="s1">&#39;Arial&#39;</span><span class="p">})</span>
                        <span class="p">])</span>
                    <span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;light&#39;</span><span class="p">,</span> <span class="n">className</span><span class="o">=</span><span class="s1">&#39;mx-auto my-4&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;80%&#39;</span><span class="p">})</span>
                <span class="p">],</span> <span class="n">className</span><span class="o">=</span><span class="s1">&#39;my-4&#39;</span><span class="p">),</span>
                <span class="n">dbc</span><span class="o">.</span><span class="n">Col</span><span class="p">([</span>
                    <span class="n">dbc</span><span class="o">.</span><span class="n">Card</span><span class="p">([</span>
                        <span class="n">dbc</span><span class="o">.</span><span class="n">CardBody</span><span class="p">([</span>
                            <span class="n">html</span><span class="o">.</span><span class="n">H3</span><span class="p">(</span><span class="s2">&quot;Estacionariedad&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;font-family&#39;</span><span class="p">:</span> <span class="s1">&#39;Arial&#39;</span><span class="p">}),</span>
                            <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="s2">&quot;La serie de tiempo original no es estacionaria&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;font-family&#39;</span><span class="p">:</span> <span class="s1">&#39;Arial&#39;</span><span class="p">})</span>
                        <span class="p">])</span>
                    <span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;light&#39;</span><span class="p">,</span> <span class="n">className</span><span class="o">=</span><span class="s1">&#39;mx-auto my-4&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;80%&#39;</span><span class="p">})</span>
                <span class="p">],</span> <span class="n">className</span><span class="o">=</span><span class="s1">&#39;my-4&#39;</span><span class="p">)</span>
            <span class="p">]),</span>
                <span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="s2">&quot;Diferenciación y Autocorrelación&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">}),</span>
                <span class="n">dbc</span><span class="o">.</span><span class="n">Row</span><span class="p">([</span>
                    <span class="n">dbc</span><span class="o">.</span><span class="n">Col</span><span class="p">([</span>
                        <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>
            <span class="p">])</span>
        <span class="p">]),</span>


    <span class="p">]))</span>

<span class="c1"># Callback gráfico datos de entrenamiento</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="s1">&#39;traindata-graph&#39;</span><span class="p">,</span> <span class="s1">&#39;figure&#39;</span><span class="p">),</span>
              <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s1">&#39;traindata-graph&#39;</span><span class="p">,</span> <span class="s1">&#39;hoverData&#39;</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">update_graph</span><span class="p">(</span><span class="n">hoverData</span><span class="p">):</span>
    <span class="n">trace_data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Agregar la serie de entrenamiento</span>
    <span class="n">trace_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">dates_train</span><span class="p">,</span>
        <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">train</span><span class="p">,</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;line&#39;</span><span class="p">,</span>
        <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;lines&#39;</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Entrenamiento&#39;</span><span class="p">,</span>
        <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;purple&#39;</span><span class="p">}</span>
    <span class="p">})</span>

    <span class="c1"># Agregar la serie de prueba</span>
    <span class="n">trace_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">dates_21month</span><span class="p">,</span>
        <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">test_21month</span><span class="p">,</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;line&#39;</span><span class="p">,</span>
        <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;lines&#39;</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Prueba&#39;</span><span class="p">,</span>
        <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;orange&#39;</span><span class="p">}</span>
    <span class="p">})</span>

    <span class="c1"># Marcar la media correspondiente al año cuando se pasa el ratón sobre la gráfica</span>
    <span class="k">if</span> <span class="n">hoverData</span><span class="p">:</span>
        <span class="n">year_hovered</span> <span class="o">=</span> <span class="n">hoverData</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">mean_value</span> <span class="o">=</span> <span class="n">df_tseries</span><span class="p">[</span><span class="n">df_tseries</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">year_hovered</span><span class="p">)][</span><span class="s1">&#39;rolling_mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">trace_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">hoverData</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mean_value</span><span class="p">],</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;scatter&#39;</span><span class="p">,</span>
            <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;markers&#39;</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Media </span><span class="si">{</span><span class="n">year_hovered</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
            <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Media </span><span class="si">{</span><span class="n">year_hovered</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="p">})</span>

    <span class="n">figure</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">trace_data</span><span class="p">,</span>
        <span class="s1">&#39;layout&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;xaxis&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Fecha&#39;</span><span class="p">},</span>
            <span class="s1">&#39;yaxis&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Anomalía de temperatura (°C)&#39;</span><span class="p">},</span>
            <span class="s1">&#39;margin&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">},</span>
            <span class="s1">&#39;legend&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">figure</span>


<span class="c1">#CallBack que renderiza dependiendo del id del dropdown</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;graph&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s1">&#39;mi-dropdown&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)]</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">update_graph</span><span class="p">(</span><span class="n">selected_value</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">selected_value</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
        <span class="c1"># Genera la gráfica para ARIMA</span>
        <span class="k">return</span><span class="p">(</span>
            <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
                <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="n">fig1</span><span class="p">),</span>
                <span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="s1">&#39;Resumen del modelo ARIMA&#39;</span><span class="p">),</span>
                <span class="n">dash_table</span><span class="o">.</span><span class="n">DataTable</span><span class="p">(</span>
                    <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;table&#39;</span><span class="p">,</span>
                    <span class="n">columns</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">summary_df</span><span class="o">.</span><span class="n">columns</span><span class="p">],</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">summary_df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;records&#39;</span><span class="p">),</span>
                    <span class="n">style_table</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;80%&#39;</span><span class="p">,</span> <span class="s1">&#39;margin&#39;</span><span class="p">:</span> <span class="s1">&#39;auto&#39;</span><span class="p">},</span>
                    <span class="n">page_size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">summary_df</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="s1">&#39;Precisión de los Pronósticos&#39;</span><span class="p">),</span>
                <span class="n">dash_table</span><span class="o">.</span><span class="n">DataTable</span><span class="p">(</span>
                    <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;accuracy-table&#39;</span><span class="p">,</span>
                    <span class="n">columns</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">accuracy_df</span><span class="o">.</span><span class="n">columns</span><span class="p">],</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">accuracy_df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;records&#39;</span><span class="p">),</span>
                    <span class="n">style_table</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;80%&#39;</span><span class="p">,</span> <span class="s1">&#39;margin&#39;</span><span class="p">:</span> <span class="s1">&#39;auto&#39;</span><span class="p">},</span>
                    <span class="n">page_size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">accuracy_df</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">])</span>
  <span class="p">)</span>  
    <span class="k">elif</span> <span class="n">selected_value</span> <span class="o">==</span> <span class="s1">&#39;2&#39;</span><span class="p">:</span>
        <span class="c1"># Genera la gráfica para Suavización exponencial</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="s2">&quot;Suavización exponencial&quot;</span><span class="p">))</span>
           
        
    <span class="k">elif</span> <span class="n">selected_value</span> <span class="o">==</span> <span class="s1">&#39;3&#39;</span><span class="p">:</span>
        <span class="c1"># Genera la gráfica para Regresión polinomial</span>
       <span class="k">return</span> <span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="s2">&quot;Regresión polinomial&quot;</span><span class="p">))</span>

    



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run_server</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># &lt;- For testing purposes</span>
    <span class="c1"># app.run_server(debug=True, host=&#39;0.0.0.0&#39;, port=9000) # &lt;- To Dockerize the Dash</span>
    
</pre></div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Análisis de Anomlaías de Temperatura en la Superficie Global</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Dash Anomalías de temperatura</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#manejo-de-la-base-de-datos">Manejo de la base de datos</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#construccion-del-dash">Construcción del dash</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#media-movil-de-12-meses">Media móvil de 12 meses</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#media-mensual-multianual-y-distribucion-de-datos-boxplot">Media mensual multianual y distribución de datos: Boxplot</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#anomalias-mensual-anual-mapa-de-calor">Anomalías mensual-anual: mapa de calor</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#promedio-decenal">Promedio decenal</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#este-ano-hasta-ahora">Este año hasta ahora</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#verificacion-de-la-estacionariedad-de-la-serie">Verificación de la estacionariedad de la serie</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelos-predictivos">Modelos predictivos</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-arima">Modelo ARIMA</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#suavizacion-exponencial">Suavización exponencial</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#regresion-polinomica">Regresión polinómica</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#codigo-unificado">Código unificado</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Sandra Maldonado - Sherine Menco
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>